#!/bin/bash

# Universal Medical Residency Scheduler Launcher
# This script launches the complete medical scheduling system

# Get the directory where this script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
APP_DIR="$( cd "$SCRIPT_DIR/../../../" && pwd )"

# Change to the application directory
cd "$APP_DIR"

echo "ğŸ¥ Universal Medical Residency Scheduler"
echo "================================================="
echo "Application Directory: $APP_DIR"
echo ""

# Check if Python 3 is available
if ! command -v python3 &> /dev/null; then
    echo "âŒ Python 3 is required but not found."
    echo "Please install Python 3 from https://python.org"
    read -p "Press Enter to exit..."
    exit 1
fi

# Check if virtual environment exists, if not create it
if [ ! -d "venv" ]; then
    echo "ğŸ“¦ Creating virtual environment..."
    python3 -m venv venv
    if [ $? -ne 0 ]; then
        echo "âŒ Failed to create virtual environment"
        read -p "Press Enter to exit..."
        exit 1
    fi
fi

# Activate virtual environment
echo "ğŸ”§ Activating virtual environment..."
source venv/bin/activate

# Upgrade pip and install requirements
echo "ğŸ“¦ Installing/updating dependencies..."
pip install --upgrade pip > /dev/null 2>&1

# Install essential packages
pip install streamlit fastapi uvicorn sqlalchemy pydantic python-dotenv email-validator > /dev/null 2>&1

echo "ğŸš€ Starting Universal Medical Residency Scheduler..."
echo ""

# Run the Python launcher
python3 launch_scheduler.py

# Keep terminal open if there was an error
if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Application exited with error"
    read -p "Press Enter to close..."
fi