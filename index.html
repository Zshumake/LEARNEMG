<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧠 Nerve/MuscleTool - Medical Education Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #1f2937;
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(107, 159, 120, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            background: #fefcf3;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 
                0 20px 60px rgba(107, 159, 120, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            position: relative;
            overflow: hidden;
            animation: fadeInUp 1s ease-out;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header h1 {
            color: #4a6d52;
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: none;
            position: relative;
            z-index: 2;
        }
        
        .header p {
            color: #6b9f78;
            font-size: 1.3em;
            margin-bottom: 25px;
            font-weight: 500;
            text-shadow: none;
            position: relative;
            z-index: 2;
        }
        
        .main-content {
            background: #fefcf3;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            box-shadow: 
                0 20px 60px rgba(107, 159, 120, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            overflow: hidden;
            position: relative;
            animation: fadeInUp 1.2s ease-out 0.3s both;
        }

        .main-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(245, 158, 11, 0.6), transparent);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .tab-navigation {
            display: flex;
            flex-wrap: wrap;
            background: rgba(254, 252, 243, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            box-shadow: 
                0 10px 30px rgba(107, 159, 120, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.6);
            position: relative;
            padding: 8px;
            gap: 5px;
            justify-content: center;
        }

        
        .tab-button {
            background: transparent;
            border: none;
            color: #6b9f78;
            padding: 12px 16px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            white-space: nowrap;
            border-radius: 15px;
            flex-shrink: 0;
            position: relative;
        }
        
        .tab-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(107, 159, 120, 0.1), rgba(245, 158, 11, 0.05));
            border-radius: 15px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .tab-button:hover {
            transform: translateY(-2px);
            color: #4a6d52;
            background: rgba(107, 159, 120, 0.1);
        }

        .tab-button:hover::before {
            opacity: 1;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #6b9f78, #4a6d52);
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(107, 159, 120, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab-button.active::before {
            opacity: 0;
        }
        
        .tab-content {
            display: none;
            padding: 40px;
            min-height: 600px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin: 20px;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .section-title {
            color: #4a6d52;
            font-size: 2.2em;
            margin-bottom: 30px;
            font-weight: 800;
            text-align: center;
            position: relative;
            padding-bottom: 20px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            border-radius: 2px;
            box-shadow: 0 2px 10px rgba(245, 158, 11, 0.4);
        }
        
        .card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .differential-builder {
            background: #fff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .complaint-selector {
            margin-bottom: 20px;
        }
        
        .complaint-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        
        .complaint-button:hover {
            background: #2980b9;
        }
        
        .complaint-button.selected {
            background: #e74c3c;
        }
        
        .differential-list {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .differential-category {
            margin-bottom: 20px;
        }
        
        .differential-category h4 {
            color: #e74c3c;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .differential-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }

        .complaint-group {
            margin-bottom: 20px;
        }

        .complaint-group h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .central-warning {
            background: #fff5f5;
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .central-button {
            background: #e74c3c !important;
        }

        .central-button:hover {
            background: #c0392b !important;
        }

        .quiz-container {
            display: none;
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
        }

        .quiz-step {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .quiz-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .step-header {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .physical-exam {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .exam-category {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .exam-category h5 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .differential-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }

        .ncs-study {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #27ae60;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .abnormal-finding {
            background: #fff5f5;
            border: 1px solid #e74c3c;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #c0392b;
            font-weight: 500;
        }

        .normal-finding {
            background: #f0fff4;
            border: 1px solid #27ae60;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            color: #27ae60;
        }

        /* Enhanced Quiz Buttons */
        .quiz-button {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 8px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quiz-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .quiz-button:hover::before {
            left: 100%;
        }

        .quiz-button:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.4);
        }

        .quiz-button:active {
            transform: translateY(-1px) scale(0.98);
        }

        .quiz-button:disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 10px rgba(156, 163, 175, 0.2);
        }

        .quiz-button:disabled::before {
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #27ae60);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .start-case-button {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .start-case-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
        }

        .case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }

        .case-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: #3498db;
        }

        .case-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .case-card p {
            color: #7f8c8d;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .difficulty {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .difficulty {
            background: #27ae60;
            color: white;
        }

        .difficulty.educational {
            background: #e74c3c;
            color: white;
        }

        /* Enhanced Case Interface */
        .case-interface {
            display: none;
            margin-top: 40px;
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            border-radius: 25px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(107, 159, 120, 0.4);
        }

        .case-interface::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: caseShimmer 4s infinite;
        }

        @keyframes caseShimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        /* Enhanced Progress Bar */
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            margin-bottom: 30px;
            overflow: hidden;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 2;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4ade80, #22c55e, #16a34a);
            border-radius: 20px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.6);
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            animation: progressGlow 2s infinite;
        }

        @keyframes progressGlow {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .case-step {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2;
        }

        .case-step::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(107, 159, 120, 0.1), transparent);
            transition: left 0.6s;
        }

        .case-step:hover::before {
            left: 100%;
        }

        .case-step:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        .case-step h3 {
            color: #1e293b;
            margin-bottom: 25px;
            padding: 20px 0;
            font-size: 28px;
            font-weight: 700;
            text-align: center;
            color: white;
            background-clip: text;
            position: relative;
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .case-step h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            border-radius: 2px;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.4);
        }

        .emg-section {
            background: #fff9e6;
            border: 2px solid #f39c12;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .emg-section h4 {
            color: #f39c12;
            margin-bottom: 15px;
        }
        
        .study-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }
        
        .study-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            backdrop-filter: blur(10px);
            border-left: 5px solid #3498db;
        }

        .study-card.essential {
            background: linear-gradient(135deg, rgba(107, 159, 120, 0.15), rgba(245, 158, 11, 0.05));
            border: 2px solid rgba(107, 159, 120, 0.4);
            border-left: 5px solid #6b9f78;
            box-shadow: 
                0 10px 30px rgba(107, 159, 120, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .study-card.essential::before {
            content: '⭐ ESSENTIAL';
            position: absolute;
            top: -10px;
            right: 15px;
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }

        .study-card.advanced {
            border-left: 5px solid #e67e22;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(254, 248, 243, 0.9));
        }

        .study-card.advanced h4 {
            color: #d35400;
        }
        
        .study-card h4 {
            color: #4a6d52;
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .study-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .study-card.essential:hover {
            box-shadow: 0 20px 40px rgba(107, 159, 120, 0.3);
        }
        
        .technique-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .alert-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .term-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .term-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: transform 0.2s ease;
        }
        
        .term-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .term-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .term-description {
            color: #555;
            line-height: 1.5;
        }
        
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .video-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .video-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .video-info {
            font-size: 14px;
        }
        
        .video-info p {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .video-info strong {
            color: #2c3e50;
        }

        /* Enhanced Difficulty Selection Styles */
        .difficulty-selector {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            padding: 40px;
            border-radius: 20px;
            margin: 30px 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .difficulty-selector::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .selector-title {
            text-align: center;
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }

        .selector-subtitle {
            text-align: center;
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 40px;
            position: relative;
            z-index: 2;
        }

        .difficulty-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
            position: relative;
            z-index: 2;
        }

        .difficulty-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            text-align: center;
        }

        .difficulty-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .difficulty-card:hover::before {
            opacity: 1;
        }

        .difficulty-card.active {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .difficulty-card.inactive {
            opacity: 0.4;
            transform: scale(0.95);
            filter: grayscale(100%);
        }

        .beginner-card.active {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            box-shadow: 0 20px 40px rgba(34, 197, 94, 0.4);
        }

        .intermediate-card.active {
            background: linear-gradient(135deg, #fb923c, #f97316);
            box-shadow: 0 20px 40px rgba(249, 115, 22, 0.4);
        }

        .difficult-card.active {
            background: linear-gradient(135deg, #f87171, #ef4444);
            box-shadow: 0 20px 40px rgba(239, 68, 68, 0.4);
        }

        .difficulty-card input {
            display: none;
        }

        .card-icon {
            font-size: 48px;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .card-subtitle {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 600;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .status-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4ade80;
            box-shadow: 0 0 15px #4ade80;
            animation: pulse 2s infinite;
        }

        .difficulty-card.inactive .status-light {
            background: #6b7280;
            box-shadow: 0 0 5px #6b7280;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-text {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .difficulty-card.inactive .status-text {
            color: #9ca3af;
        }

        .card-description {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }

        .primary-action-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(5, 150, 105, 0.3);
            position: relative;
            overflow: hidden;
        }

        .primary-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .primary-action-btn:hover::before {
            left: 100%;
        }

        .primary-action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(5, 150, 105, 0.4);
        }

        .secondary-action-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .secondary-action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Case Selection Section */
        .case-selection-section {
            background: linear-gradient(135deg, #1e293b, #334155);
            padding: 40px;
            border-radius: 20px;
            margin: 30px 0;
            color: white;
        }

        .section-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-header h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #f1f5f9;
        }

        .section-header p {
            font-size: 16px;
            opacity: 0.8;
            color: #cbd5e1;
        }

        .case-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .control-btn.primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-color: #3b82f6;
        }

        .control-btn.secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            border-color: #6b7280;
        }

        /* Enhanced Case Cards */
        .case-card {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            color: #1e293b;
        }

        .case-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.5s;
        }

        .case-card:hover::before {
            left: 100%;
        }

        .case-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border-color: #3b82f6;
        }

        .case-card.selected {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
            transform: translateY(-3px);
        }

        .case-card input[type="checkbox"] {
            position: absolute;
            top: 15px;
            right: 15px;
            transform: scale(1.4);
            cursor: pointer;
            z-index: 2;
            accent-color: #f59e0b;
        }

        .case-card h4 {
            color: #1e293b;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: 700;
        }

        .case-card.selected h4 {
            color: #92400e;
        }

        .difficulty.beginner {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .difficulty.intermediate {
            background: linear-gradient(135deg, #fb923c, #f97316);
            color: white;
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .difficulty.difficult {
            background: linear-gradient(135deg, #f87171, #ef4444);
            color: white;
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Enhanced Feedback System */
        .analysis-header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #6b9f78, #4a6d52);
            border-radius: 15px;
            color: white;
        }

        .analysis-header h3 {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: 700;
        }

        .analysis-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }

        .feedback-card {
            margin: 20px 0;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feedback-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .feedback-card:hover::before {
            left: 100%;
        }

        .feedback-card.success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-left: 5px solid #28a745;
            color: #155724;
        }

        .feedback-card.suggestion {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 5px solid #ffc107;
            color: #856404;
        }

        .feedback-card.error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-left: 5px solid #dc3545;
            color: #721c24;
        }

        .feedback-card.warning {
            background: linear-gradient(135deg, #e2e3e5, #d6d8db);
            border-left: 5px solid #6c757d;
            color: #383d41;
        }

        .feedback-card h4 {
            margin: 0 0 15px 0;
            font-size: 18px;
            font-weight: 700;
        }

        .diagnosis-list {
            margin: 15px 0;
            padding-left: 0;
            list-style: none;
        }

        .diagnosis-list li {
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            font-weight: 600;
            position: relative;
            transition: all 0.3s ease;
        }

        .matched-diagnosis {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .missed-diagnosis {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
            color: #856404;
        }

        .expected-diagnosis {
            background: rgba(0, 123, 255, 0.1);
            border-left: 4px solid #007bff;
            color: #004085;
            font-weight: 700;
        }

        .feedback-note {
            font-style: italic;
            opacity: 0.8;
            margin: 15px 0 0 0;
            font-size: 14px;
        }

        /* Enhanced Form Elements */
        textarea, input[type="text"] {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: rgba(107, 159, 120, 0.8);
            box-shadow: 0 8px 25px rgba(107, 159, 120, 0.2);
            transform: translateY(-2px);
        }

        /* Enhanced Card Elements */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(107, 159, 120, 0.1), transparent);
            transition: left 0.6s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }

        /* Enhanced Alert Styling */
        .alert-info {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #1e40af;
            position: relative;
            overflow: hidden;
        }

        .alert-info::before {
            content: '💡';
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            opacity: 0.7;
        }

        .alert-warning {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 2px solid rgba(245, 158, 11, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #92400e;
            position: relative;
            overflow: hidden;
        }

        .alert-warning::before {
            content: '⚠️';
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            opacity: 0.7;
        }

        /* Senior Level Styling */
        .senior-tab {
            border: 2px solid #f59e0b !important;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%) !important;
            color: #b45309 !important;
        }

        .senior-tab:hover {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%) !important;
            border-color: #d97706 !important;
        }

        .senior-level-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }

        /* Senior Navigation Styling */
        .senior-navigation {
            margin-top: 15px;
            flex-direction: column;
            padding: 15px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(217, 119, 6, 0.05) 100%);
            border: 2px solid rgba(245, 158, 11, 0.3);
        }

        .senior-navigation-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 12px;
            gap: 5px;
        }

        .senior-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.7em;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.3);
        }

        .senior-warning {
            color: #b45309;
            font-size: 0.75em;
            font-weight: 500;
            font-style: italic;
            text-align: center;
        }

        .senior-tabs-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Advanced Muscle Anatomy Styling */
        .anatomy-controls-advanced {
            background: rgba(254, 252, 243, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 15px 35px rgba(107, 159, 120, 0.2);
        }

        .control-buttons-advanced {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .anatomy-btn-advanced {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(107, 159, 120, 0.3);
            position: relative;
            overflow: hidden;
        }

        .anatomy-btn-advanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .anatomy-btn-advanced:hover::before {
            left: 100%;
        }

        .anatomy-btn-advanced:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(107, 159, 120, 0.4);
        }

        .anatomy-btn-advanced.active {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .anatomy-btn-advanced.test-btn {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        }

        .anatomy-actions-advanced {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .study-mode-label {
            font-weight: 700;
            color: #4a6d52;
            font-size: 16px;
        }

        .btn-advanced {
            background: rgba(107, 159, 120, 0.1);
            border: 2px solid #6b9f78;
            color: #4a6d52;
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-advanced:hover {
            background: #6b9f78;
            color: white;
            transform: translateY(-2px);
        }

        .btn-advanced.show-all {
            border-color: #28a745;
            color: #155724;
        }

        .btn-advanced.show-all:hover {
            background: #28a745;
            color: white;
        }

        .btn-advanced.hide-all {
            border-color: #dc3545;
            color: #721c24;
        }

        .btn-advanced.hide-all:hover {
            background: #dc3545;
            color: white;
        }

        .toggle-group-advanced {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .muscle-anatomy-display {
            background: rgba(254, 252, 243, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            min-height: 400px;
            box-shadow: 0 15px 35px rgba(107, 159, 120, 0.2);
        }

        .muscle-region {
            margin-bottom: 30px;
        }

        .muscle-region h3 {
            color: #4a6d52;
            font-size: 1.5em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(107, 159, 120, 0.3);
        }

        .muscle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .muscle-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #6b9f78;
        }

        .muscle-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
        }

        .muscle-name {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .muscle-detail {
            margin: 10px 0;
            padding: 12px 16px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-left: 4px solid #dee2e6;
            font-size: 14px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
            opacity: 0;
            transform: translateY(-10px);
        }

        .muscle-detail[style*="display: block"] {
            opacity: 1;
            transform: translateY(0);
        }

        .muscle-detail.nerve {
            border-left-color: #6b9f78;
            background: rgba(107, 159, 120, 0.1);
        }

        .muscle-detail.roots {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .muscle-detail.actions {
            border-left-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        /* Quiz Toggle Options Styles */
        .quiz-type-selector {
            background: rgba(107, 159, 120, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(107, 159, 120, 0.2);
        }

        .quiz-type-selector h4 {
            color: #4a6d52;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .quiz-type-selector p {
            color: #6b9f78;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .quiz-toggle-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
        }

        .quiz-toggle-option {
            background: rgba(254, 252, 243, 0.9);
            border: 2px solid rgba(107, 159, 120, 0.2);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quiz-toggle-option:hover {
            border-color: #6b9f78;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 159, 120, 0.2);
        }

        .quiz-toggle-option.active {
            border-color: #4a6d52;
            background: rgba(107, 159, 120, 0.15);
            box-shadow: 0 4px 12px rgba(107, 159, 120, 0.3);
        }

        .quiz-toggle-option .toggle-icon {
            font-size: 1.5em;
            min-width: 30px;
            text-align: center;
        }

        .quiz-toggle-option .toggle-content {
            flex: 1;
        }

        .quiz-toggle-option .toggle-content h5 {
            margin: 0 0 4px 0;
            color: #4a6d52;
            font-size: 0.95em;
        }

        .quiz-toggle-option .toggle-content p {
            margin: 0;
            color: #6b9f78;
            font-size: 0.8em;
        }

        .quiz-toggle-option .toggle-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .quiz-toggle-option .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #ddd;
            transition: all 0.3s ease;
        }

        .quiz-toggle-option .status-indicator.active {
            background: #4a6d52;
            border-color: #4a6d52;
        }

        .quiz-toggle-option .status-text {
            font-size: 0.75em;
            color: #6b9f78;
            font-weight: 500;
        }

        /* Anatomy Display Controls Styles */
        .anatomy-display-controls {
            background: rgba(254, 252, 243, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 25px rgba(107, 159, 120, 0.15);
        }

        .anatomy-display-controls h4 {
            color: #4a6d52;
            margin-bottom: 8px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .anatomy-display-controls p {
            color: #6b9f78;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .muscle-detail-label {
            font-weight: 700;
            color: #2c3e50;
            margin-right: 8px;
        }

        .muscle-controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .muscle-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .muscle-btn.nerve {
            background: rgba(107, 159, 120, 0.2);
            color: #4a6d52;
        }

        .muscle-btn.nerve:hover {
            background: #6b9f78;
            color: white;
        }

        .muscle-btn.roots {
            background: rgba(245, 158, 11, 0.2);
            color: #b45309;
        }

        .muscle-btn.roots:hover {
            background: #f59e0b;
            color: white;
        }

        .muscle-btn.actions {
            background: rgba(139, 92, 246, 0.2);
            color: #6d28d9;
        }

        .muscle-btn.actions:hover {
            background: #8b5cf6;
            color: white;
        }

        .muscle-btn.peripheral {
            background: rgba(59, 130, 246, 0.2);
            color: #1d4ed8;
        }

        .muscle-btn.peripheral:hover {
            background: #3b82f6;
            color: white;
        }

        .muscle-btn.show-all {
            background: rgba(168, 85, 247, 0.2);
            color: #7c3aed;
            font-weight: 700;
        }

        .muscle-btn.show-all:hover {
            background: #8b5cf6;
            color: white;
        }

        /* Active button states */
        .muscle-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-weight: 700;
        }

        .muscle-btn.nerve.active {
            background: #6b9f78;
            color: white;
        }

        .muscle-btn.roots.active {
            background: #f59e0b;
            color: white;
        }

        .muscle-btn.actions.active {
            background: #8b5cf6;
            color: white;
        }

        .muscle-btn.peripheral.active {
            background: #3b82f6;
            color: white;
        }

        .muscle-btn.cord {
            background: rgba(59, 130, 246, 0.2);
            color: #1d4ed8;
        }

        .muscle-btn.cord:hover {
            background: #3b82f6;
            color: white;
        }

        .muscle-btn.cord.active {
            background: #3b82f6;
            color: white;
        }

        .muscle-btn.show-all.active {
            background: #8b5cf6;
            color: white;
        }

        /* New Interactive Muscle Card System */
        .muscle-card-interactive {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(107, 159, 120, 0.2);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
            border-left: 6px solid #6b9f78;
            position: relative;
            overflow: hidden;
            cursor: default;
            min-height: 120px;
            width: 100%; /* Ensure cards take full grid cell width */
            box-sizing: border-box;
        }

        /* Expanded state for cards with lots of content */
        .muscle-card-interactive.expanded {
            min-height: auto;
            max-height: none;
            padding: 30px;
            transform: scale(1.02);
            z-index: 10;
            margin-bottom: 20px; /* Add space below expanded card instead of affecting layout */
            box-shadow: 0 25px 60px rgba(107, 159, 120, 0.2);
        }

        .muscle-card-interactive::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(107, 159, 120, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .muscle-card-interactive:hover::before {
            left: 100%;
        }

        .muscle-card-interactive:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 50px rgba(107, 159, 120, 0.15);
            border-color: rgba(107, 159, 120, 0.4);
        }

        .muscle-card-interactive.flashcard-mode {
            cursor: pointer;
            perspective: 1200px;
            transform-style: preserve-3d;
        }

        .muscle-card-interactive.flashcard-mode:hover {
            transform: translateY(-3px) rotateX(2deg);
            box-shadow: 0 25px 60px rgba(107, 159, 120, 0.2);
        }

        .card-front, .card-back {
            transition: transform 0.8s cubic-bezier(0.23, 1, 0.320, 1);
            backface-visibility: hidden;
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 20px;
        }

        .card-front {
            transform: rotateY(0deg);
            z-index: 2;
        }

        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, rgba(107, 159, 120, 0.95), rgba(75, 139, 190, 0.9));
            color: white;
            padding: 25px;
            min-height: 200px;
            display: flex;
            align-items: center;
        }

        .muscle-card-interactive.flipped .card-front {
            transform: rotateY(-180deg);
        }

        .muscle-card-interactive.flipped .card-back {
            transform: rotateY(0deg);
        }

        /* Smooth expanding animation for explorer mode */
        .muscle-card-interactive.explorer-mode {
            transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
        }

        .muscle-card-interactive.explorer-mode.has-content {
            min-height: 200px;
            transform: scale(1.02);
        }

        .muscle-header {
            position: relative;
            z-index: 2;
        }

        .muscle-name {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .flip-indicator {
            font-size: 12px;
            color: #6b9f78;
            font-weight: 500;
            opacity: 0.8;
            animation: pulse 2s infinite;
        }

        .hover-hint {
            font-size: 12px;
            color: #8b5cf6;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .muscle-card-interactive:hover .hover-hint {
            opacity: 1;
            animation: sparkle 1s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        @keyframes sparkle {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(2deg); }
            75% { transform: scale(1.1) rotate(-2deg); }
        }

        .muscle-details-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .muscle-detail-item {
            padding: 15px 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-left: 4px solid #dee2e6;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .muscle-detail-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            transition: width 0.3s ease;
        }

        .muscle-detail-item.nerve {
            border-left-color: #6b9f78;
            background: rgba(107, 159, 120, 0.08);
        }

        .muscle-detail-item.nerve::before {
            background: #6b9f78;
        }

        .muscle-detail-item.roots {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.08);
        }

        .muscle-detail-item.roots::before {
            background: #f59e0b;
        }

        .muscle-detail-item.peripheral {
            border-left-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.08);
        }

        .muscle-detail-item.peripheral::before {
            background: #8b5cf6;
        }

        .muscle-detail-item.actions {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.08);
        }

        .muscle-detail-item.actions::before {
            background: #ef4444;
        }

        .muscle-detail-item:hover::before {
            width: 8px;
        }

        .muscle-detail-label {
            font-weight: 700;
            color: #2c3e50;
            margin-right: 8px;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        .card-hover-reveal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(107, 159, 120, 0.95), rgba(75, 139, 190, 0.9));
            color: white;
            padding: 25px;
            border-radius: 20px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            backdrop-filter: blur(10px);
        }

        .muscle-card-interactive:hover .card-hover-reveal {
            opacity: 1;
            transform: translateY(0);
        }

        .reveal-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .reveal-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .reveal-details {
            display: grid;
            gap: 12px;
        }

        .reveal-item {
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .reveal-item-label {
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        /* Study Mode Controls */
        .study-mode-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .study-mode-btn {
            padding: 10px 20px;
            border: 2px solid #6b9f78;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #6b9f78;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .study-mode-btn:hover {
            background: #6b9f78;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 159, 120, 0.3);
        }

        .study-mode-btn.active {
            background: #6b9f78;
            color: white;
            box-shadow: 0 5px 15px rgba(107, 159, 120, 0.3);
        }

        /* Flashcard Content Styling */
        .flashcard-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .flashcard-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .flashcard-header h4 {
            color: white;
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .flashcard-details {
            display: grid;
            gap: 15px;
        }

        .flashcard-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .flashcard-item:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(5px);
        }

        .fc-icon {
            font-size: 16px;
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        .fc-label {
            font-weight: 600;
            margin-right: 10px;
            min-width: 80px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .fc-value {
            flex: 1;
            font-weight: 500;
        }

        /* Detail Items for Explorer Mode */
        .detail-item {
            padding: 15px 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-left: 4px solid #dee2e6;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .detail-item:hover {
            transform: translateX(3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .detail-icon {
            font-size: 16px;
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .detail-label {
            font-weight: 700;
            color: #2c3e50;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-content {
            font-weight: 500;
            color: #374151;
            padding-left: 30px;
        }

        .nerve-detail {
            border-left-color: #6b9f78;
            background: rgba(107, 159, 120, 0.08);
        }

        .roots-detail {
            border-left-color: #f59e0b;
            background: rgba(245, 158, 11, 0.08);
        }

        .peripheral-detail {
            border-left-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.08);
        }

        .actions-detail {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.08);
        }

        /* Hover Reveal Content */
        .reveal-icon {
            font-size: 14px;
            margin-right: 8px;
            width: 18px;
            text-align: center;
        }

        .reveal-text {
            font-weight: 500;
        }

        /* Study Controls Bar */
        .study-controls-bar {
            display: flex;
            gap: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(107, 159, 120, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .control-section h4 {
            color: #2c3e50;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .region-selector, .anatomy-selector {
            display: flex;
            gap: 10px;
        }

        .region-btn, .anatomy-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .region-btn:hover, .anatomy-btn:hover {
            border-color: #6b9f78;
            background: rgba(107, 159, 120, 0.05);
            color: #6b9f78;
        }

        .region-btn.active, .anatomy-btn.active {
            border-color: #6b9f78;
            background: #6b9f78;
            color: white;
            font-weight: 600;
        }

        /* Quiz Section */
        .quiz-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .quiz-header h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .quiz-header p {
            color: #6b7280;
            margin-bottom: 20px;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .quiz-mode-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quiz-mode-toggle label {
            font-weight: 600;
            color: #374151;
        }

        .mode-toggle-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .mode-toggle-btn:hover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.05);
            color: #8b5cf6;
        }

        .mode-toggle-btn.active {
            border-color: #8b5cf6;
            background: #8b5cf6;
            color: white;
        }

        .quiz-action-btns {
            display: flex;
            gap: 15px;
        }

        .quiz-start-btn, .quiz-stop-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-start-btn {
            background: #8b5cf6;
            color: white;
        }

        .quiz-start-btn:hover {
            background: #7c3aed;
            transform: translateY(-2px);
        }

        .quiz-stop-btn {
            background: #ef4444;
            color: white;
        }

        .quiz-stop-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .inline-quiz-area {
            border-top: 1px solid #e5e7eb;
            padding-top: 20px;
        }

        /* Simple Muscle Cards */
        .simple-muscle-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(107, 159, 120, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            border-left: 4px solid #6b9f78;
        }

        .simple-muscle-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 159, 120, 0.12);
        }

        .simple-muscle-card .muscle-name {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .anatomy-display {
            font-size: 14px;
        }

        .anatomy-label {
            font-weight: 600;
            color: #6b7280;
            margin-right: 8px;
        }

        .anatomy-content {
            color: #374151;
            font-weight: 500;
        }

        /* Quiz styling */
        .quiz-question h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .quiz-answer-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .quiz-answer-input input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
        }

        .quiz-answer-input input:focus {
            border-color: #8b5cf6;
            outline: none;
        }

        .check-answer-btn, .next-question-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: #8b5cf6;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .check-answer-btn:hover, .next-question-btn:hover {
            background: #7c3aed;
            transform: translateY(-1px);
        }

        .feedback-result {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .feedback-result.correct {
            background: rgba(5, 150, 105, 0.1);
            border-left: 4px solid #059669;
        }

        .feedback-result.incorrect {
            background: rgba(220, 38, 38, 0.1);
            border-left: 4px solid #dc2626;
        }

        .feedback-result h5 {
            margin-bottom: 10px;
        }

        .feedback-result p {
            margin: 5px 0;
            font-size: 14px;
        }

        /* Quiz Options */
        .quiz-options {
            margin-bottom: 15px;
        }

        .quiz-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin: 8px 0;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .quiz-option:hover {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.05);
            transform: translateX(3px);
        }

        .quiz-option.selected {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
            font-weight: 600;
        }

        .quiz-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .quiz-option label {
            cursor: pointer;
            flex: 1;
            font-size: 14px;
        }

        /* Muscle Test Modal Styling */
        .muscle-test-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .muscle-test-content {
            background: rgba(254, 252, 243, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
        }

        .muscle-test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border-radius: 25px 25px 0 0;
        }

        .test-title h3 {
            margin: 0;
            font-size: 1.4em;
        }

        .test-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .close-test-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .close-test-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .muscle-test-body {
            padding: 30px;
        }

        .test-question h4 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 25px;
            text-align: center;
        }

        .answer-choices {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .answer-choice {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 600;
            color: #2c3e50;
        }

        .answer-choice:hover {
            border-color: #6b9f78;
            background: rgba(107, 159, 120, 0.1);
            transform: translateY(-2px);
        }

        .answer-choice.selected {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.2);
        }

        .answer-choice.correct {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.2);
        }

        .answer-choice.incorrect {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.2);
        }

        .answer-feedback {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #6b9f78;
        }

        .next-question-btn {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .next-question-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 159, 120, 0.3);
        }

        .test-results {
            text-align: center;
            padding: 30px;
        }

        .stats-container {
            display: grid;
            gap: 25px;
        }

        .score-display {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #6b9f78;
        }

        .score-percentage {
            font-size: 3em;
            font-weight: bold;
            color: #4a6d52;
            margin-bottom: 10px;
        }

        .score-details {
            font-size: 1.2em;
            color: #6b7280;
        }

        .missed-questions {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #f59e0b;
        }

        .test-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        /* Enhanced Muscle Lab Styling */
        .muscle-lab-hero {
            background: linear-gradient(135deg, rgba(107, 159, 120, 0.15) 0%, rgba(74, 109, 82, 0.15) 100%);
            border-radius: 25px;
            padding: 40px;
            margin: 20px 0;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
        }
        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4a6d52;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .hero-subtitle {
            font-size: 1.2rem;
            color: #6b7280;
            margin-bottom: 30px;
            font-weight: 500;
        }
        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        .stat-card {
            background: rgba(254, 252, 243, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px 30px;
            border: 1px solid rgba(107, 159, 120, 0.2);
            min-width: 120px;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: #4a6d52;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .learning-modes-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 30px 0;
        }
        @media (max-width: 768px) {
            .learning-modes-dashboard {
                grid-template-columns: 1fr;
            }
        }
        .mode-card {
            background: rgba(254, 252, 243, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(107, 159, 120, 0.15);
            transition: all 0.3s ease;
        }
        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(107, 159, 120, 0.2);
        }
        .mode-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .mode-icon {
            font-size: 2rem;
        }
        .mode-info h3 {
            color: #4a6d52;
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
        }
        .mode-info p {
            color: #6b7280;
            margin: 0;
            font-size: 0.95rem;
        }
        
        .region-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .region-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .region-btn:hover {
            background: rgba(107, 159, 120, 0.1);
            border-color: #6b9f78;
            transform: translateY(-2px);
        }
        .region-btn.active {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border-color: #4a6d52;
        }
        .region-icon {
            font-size: 1.5rem;
        }
        .muscle-count {
            font-size: 0.8rem;
            opacity: 0.8;
            font-weight: 500;
        }
        
        .study-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .control-btn {
            flex: 1;
            background: linear-gradient(135deg, rgba(107, 159, 120, 0.1) 0%, rgba(74, 109, 82, 0.1) 100%);
            border: 1px solid rgba(107, 159, 120, 0.3);
            border-radius: 12px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #4a6d52;
        }
        .control-btn:hover {
            background: linear-gradient(135deg, rgba(107, 159, 120, 0.2) 0%, rgba(74, 109, 82, 0.2) 100%);
            transform: translateY(-1px);
        }
        .control-btn.primary {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border-color: #4a6d52;
        }
        
        .filter-toggles {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .toggle-chip {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(107, 159, 120, 0.3);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            color: #4a6d52;
        }
        .toggle-chip:hover {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            transform: scale(1.05);
        }
        .chip-icon {
            font-size: 0.9rem;
        }
        
        .quiz-launch-area {
            text-align: center;
        }
        .quiz-features {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 25px;
        }
        .feature {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 10px;
            padding: 10px;
            font-size: 0.85rem;
            color: #92400e;
            font-weight: 500;
        }
        .launch-quiz-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0 auto;
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
        }
        .launch-quiz-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(245, 158, 11, 0.4);
        }
        .launch-icon {
            font-size: 1.2rem;
        }
        
        .prerequisites-alert {
            background: rgba(239, 246, 255, 0.95);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .alert-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .alert-icon {
            font-size: 1.3rem;
        }
        .alert-header h4 {
            color: #1e40af;
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
        }
        .prerequisites-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        @media (max-width: 768px) {
            .prerequisites-grid {
                grid-template-columns: 1fr;
            }
        }
        .prereq-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: #1e40af;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .prereq-icon {
            font-size: 1.1rem;
        }
        
        .muscle-anatomy-display-enhanced {
            background: rgba(254, 252, 243, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start; /* Prevents cards from stretching to match tallest */
            margin: 20px 0;
            box-shadow: 0 15px 35px rgba(107, 159, 120, 0.2);
            min-height: 400px;
        }
        
        /* Interactive Study System */
        .interactive-study-system {
            margin: 20px 0;
        }
        .study-method-selector, .information-toggles {
            margin-bottom: 25px;
        }
        .study-method-selector h5, .information-toggles h5 {
            color: #4a6d52;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 15px 0;
        }
        .method-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .method-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-align: center;
        }
        .method-btn:hover {
            background: rgba(107, 159, 120, 0.1);
            border-color: #6b9f78;
            transform: translateY(-2px);
        }
        .method-btn.active {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border-color: #4a6d52;
        }
        .method-icon {
            font-size: 1.5rem;
        }
        .method-name {
            font-weight: 600;
            font-size: 0.95rem;
        }
        .method-desc {
            font-size: 0.8rem;
            opacity: 0.8;
            line-height: 1.2;
        }
        
        .info-toggle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }
        .info-toggle {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        .info-toggle:hover {
            background: rgba(107, 159, 120, 0.1);
            border-color: #6b9f78;
        }
        .info-toggle.active {
            background: rgba(107, 159, 120, 0.15);
            border-color: #6b9f78;
        }
        .toggle-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #d1d5db;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        .info-toggle.active .toggle-indicator {
            background: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }
        .toggle-icon {
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        .toggle-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #4a6d52;
        }
        
        /* EMG Challenge Styling */
        .emg-answer-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(5px);
        }

        .emg-answer-option:hover {
            border-color: #6b9f78;
            background: rgba(107, 159, 120, 0.08);
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(107, 159, 120, 0.15);
        }

        .emg-answer-option.selected {
            border-color: #6b9f78;
            background: rgba(107, 159, 120, 0.12);
            font-weight: 600;
            box-shadow: 0 8px 20px rgba(107, 159, 120, 0.2);
        }

        .option-content {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .option-indicator {
            font-size: 18px;
            color: #6b9f78;
            font-weight: bold;
            margin-left: 15px;
        }

        .answer-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin: 8px 0;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .answer-option:hover {
            border-color: #6b9f78;
            background: rgba(107, 159, 120, 0.05);
            transform: translateX(3px);
        }

        .answer-option.selected {
            border-color: #6b9f78;
            background: rgba(107, 159, 120, 0.1);
            font-weight: 600;
        }

        .answer-option input[type="radio"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .answer-option label {
            cursor: pointer;
            flex: 1;
            font-size: 14px;
        }

        .challenge-feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid;
        }

        .feedback-header.correct {
            color: #059669;
        }

        .feedback-header.incorrect {
            color: #dc2626;
        }

        .feedback-header.correct + .challenge-feedback {
            border-left-color: #059669;
            background: rgba(5, 150, 105, 0.05);
        }

        .feedback-header.incorrect + .challenge-feedback {
            border-left-color: #dc2626;
            background: rgba(220, 38, 38, 0.05);
        }

        .feedback-content p {
            margin: 8px 0;
            font-size: 14px;
        }

        .feedback-content strong {
            font-weight: 700;
        }

        .emg-challenge-container {
            background: rgba(254, 252, 243, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 15px 35px rgba(107, 159, 120, 0.2);
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #6b9f78;
        }

        .challenge-header h3 {
            color: #4a6d52;
            margin-bottom: 15px;
        }

        .challenge-launch {
            text-align: center;
            margin-top: 20px;
        }

        .launch-challenge-btn {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0 auto;
        }

        .launch-challenge-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(107, 159, 120, 0.4);
        }
        
        /* Question Type Toggle System */
        .question-type-selector {
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 15px;
            border: 1px solid rgba(107, 159, 120, 0.2);
        }
        .selector-title {
            color: #4a6d52;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .selector-description {
            color: #6b7280;
            margin: 0 0 20px 0;
            font-size: 0.95rem;
        }
        .toggle-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .toggle-option {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }
        .toggle-option:hover {
            background: rgba(107, 159, 120, 0.05);
            border-color: #6b9f78;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(107, 159, 120, 0.2);
        }
        .toggle-option.active {
            background: rgba(107, 159, 120, 0.1);
            border-color: #6b9f78;
            box-shadow: 0 4px 15px rgba(107, 159, 120, 0.15);
        }
        .toggle-option.disabled {
            background: rgba(248, 250, 252, 0.8);
            border-color: rgba(148, 163, 184, 0.3);
            opacity: 0.6;
            cursor: not-allowed;
        }
        .toggle-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }
        .toggle-content {
            flex: 1;
        }
        .toggle-content h5 {
            color: #4a6d52;
            font-size: 1.1rem;
            font-weight: 700;
            margin: 0 0 5px 0;
        }
        .toggle-content p {
            color: #6b7280;
            margin: 0 0 8px 0;
            font-size: 0.9rem;
        }
        .toggle-examples {
            font-size: 0.8rem;
            color: #9ca3af;
            font-style: italic;
        }
        .toggle-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #d1d5db;
            transition: all 0.3s ease;
        }
        .status-indicator.active {
            background: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }
        .status-text {
            font-size: 0.75rem;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .toggle-option.active .status-text {
            color: #065f46;
        }
        .launch-note {
            margin-top: 10px;
            font-size: 0.85rem;
            color: #6b7280;
            font-style: italic;
        }

        .clinical-scenario {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #8b5cf6;
        }

        .scenario-header h4 {
            color: #6d28d9;
            margin-bottom: 10px;
        }

        .scenario-content {
            font-size: 16px;
            line-height: 1.6;
            color: #2c3e50;
        }

        .emg-findings {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #f59e0b;
        }

        .findings-header h4 {
            color: #b45309;
            margin-bottom: 15px;
        }

        .findings-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .findings-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            padding: 8px 12px;
            border-radius: 8px;
        }

        .findings-title.abnormal {
            background: rgba(220, 53, 69, 0.1);
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .findings-title.normal {
            background: rgba(40, 167, 69, 0.1);
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .muscle-findings-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .muscle-findings-list li {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 6px;
            font-weight: 500;
        }

        .muscle-findings-list.abnormal li {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .muscle-findings-list.normal li {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .challenge-question {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #6b9f78;
        }

        .question-header h4 {
            color: #4a6d52;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .answer-options-challenge {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .answer-option-challenge {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .answer-option-challenge:hover {
            border-color: #6b9f78;
            background: rgba(107, 159, 120, 0.1);
            transform: translateY(-2px);
        }

        .answer-option-challenge.selected {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.2);
        }

        .answer-option-challenge.correct {
            border-color: #28a745;
            background: rgba(40, 167, 69, 0.2);
        }

        .answer-option-challenge.incorrect {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.2);
        }

        .challenge-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .challenge-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .challenge-btn.primary {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
        }

        .challenge-btn.primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(107, 159, 120, 0.3);
        }

        .challenge-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .challenge-feedback {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #6b9f78;
        }

        .challenge-feedback-card {
            padding: 20px;
            border-radius: 12px;
        }

        .challenge-feedback-card.correct {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid #28a745;
        }

        .challenge-feedback-card.incorrect {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid #dc3545;
        }

        .challenge-feedback-card h4 {
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .feedback-content p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .feedback-explanation {
            background: rgba(255, 255, 255, 0.7);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .findings-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .answer-options-challenge {
                grid-template-columns: 1fr;
            }
            
            .challenge-controls {
                flex-direction: column;
                align-items: center;
            }
        }

        .senior-level-warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
        }

        .warning-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .warning-icon {
            font-size: 1.5em;
        }

        .warning-header h3 {
            color: #b45309;
            margin: 0;
        }

        .senior-level-warning p {
            color: #92400e;
            margin-bottom: 12px;
        }

        .senior-level-warning ul {
            color: #92400e;
            margin-left: 20px;
        }

        /* Video Grid Styling */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .video-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .video-card:hover {
            transform: translateY(-5px);
            border-color: #6b9f78;
            box-shadow: 0 12px 35px rgba(107, 159, 120, 0.2);
        }

        .video-header {
            padding: 20px 25px 15px 25px;
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
        }

        .video-header h3 {
            margin: 0;
            font-size: 1.2em;
            font-weight: bold;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 250px;
            background: #f8f9fa;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-info {
            padding: 20px 25px;
        }

        .video-info p {
            margin: 8px 0;
            color: #374151;
            line-height: 1.5;
            font-size: 0.95em;
        }

        .video-info strong {
            color: #6b9f78;
            font-weight: 600;
        }

        /* Cardinal Rules Styling */
        .cardinal-rules-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .rule-section {
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(107, 159, 120, 0.2);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .section-header h3 {
            color: #6b9f78;
            font-size: 1.4em;
            margin: 0 0 8px 0;
        }

        .section-subtitle {
            color: #6b7280;
            font-style: italic;
            margin: 0;
        }

        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .rule-card {
            display: flex;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.8) 100%);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .rule-card:hover {
            transform: translateY(-3px);
            border-color: #6b9f78;
            box-shadow: 0 8px 25px rgba(107, 159, 120, 0.2);
        }

        .rule-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.2em;
            flex-shrink: 0;
        }

        .rule-content h4 {
            color: #6b9f78;
            margin: 0 0 8px 0;
            font-size: 1.1em;
        }

        .rule-content p {
            margin: 0;
            color: #374151;
            line-height: 1.6;
        }

        /* Timeline Styling */
        .timeline-container {
            position: relative;
            max-width: 800px;
            margin: 0 auto;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            position: relative;
        }

        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 75px;
            top: 60px;
            width: 2px;
            height: 25px;
            background: linear-gradient(to bottom, #6b9f78, #4a6d52);
        }

        .timeline-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 120px;
            height: 50px;
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 20px;
            flex-shrink: 0;
            box-shadow: 0 4px 15px rgba(107, 159, 120, 0.3);
        }

        .timeline-content {
            flex: 1;
            padding: 15px 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.8) 100%);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .timeline-content h4 {
            color: #6b9f78;
            margin: 0 0 5px 0;
        }

        .timeline-content p {
            color: #374151;
            margin: 0;
            line-height: 1.4;
        }

        .clinical-implication {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            text-align: center;
        }

        .implication-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .implication-header h4 {
            color: #dc2626;
            margin: 0;
        }

        .clinical-implication p {
            color: #991b1b;
            margin: 0;
            font-weight: 600;
            font-size: 1.1em;
        }

        /* Advanced Tools Styling */
        .advanced-anatomy-controls {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin: 25px 0;
        }

        .control-section h3 {
            color: #6b9f78;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .training-mode-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .mode-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(107, 159, 120, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .mode-card:hover {
            transform: translateY(-5px);
            border-color: #6b9f78;
            box-shadow: 0 8px 25px rgba(107, 159, 120, 0.2);
        }

        .mode-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .mode-card h4 {
            color: #6b9f78;
            margin: 10px 0 8px 0;
        }

        .mode-difficulty {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .action-buttons-advanced {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .action-btn-advanced {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .action-btn-advanced.primary {
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(107, 159, 120, 0.3);
        }

        .action-btn-advanced.secondary {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            color: #6b9f78;
            border: 2px solid #6b9f78;
        }

        .action-btn-advanced:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        /* Test Modal */
        .advanced-test-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .advanced-test-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .advanced-test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 30px;
            border-bottom: 2px solid rgba(107, 159, 120, 0.2);
        }

        .test-title h3 {
            color: #6b9f78;
            margin: 0;
        }

        .close-advanced-test-btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .advanced-test-body {
            padding: 30px;
        }

        /* Challenge Styling */
        .emg-challenge-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .challenge-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(107, 159, 120, 0.2);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .launch-challenge-btn {
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, #6b9f78 0%, #4a6d52 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto;
            transition: all 0.3s ease;
        }

        .launch-challenge-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(107, 159, 120, 0.3);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .tab-navigation {
                padding: 5px;
                gap: 3px;
            }
            
            .senior-navigation {
                margin-top: 10px;
                padding: 10px;
            }
            
            .senior-navigation-header {
                margin-bottom: 8px;
            }
            
            .senior-badge {
                font-size: 0.65em;
                padding: 4px 8px;
            }
            
            .senior-warning {
                font-size: 0.7em;
            }
            
            .senior-tabs-container {
                gap: 5px;
            }
            
            .tab-button {
                padding: 10px 12px;
                font-size: 12px;
                min-width: auto;
            }
            
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            .video-card {
                padding: 15px;
            }

            .rules-grid {
                grid-template-columns: 1fr;
            }

            .training-mode-cards {
                grid-template-columns: 1fr;
            }

            .timeline-item {
                flex-direction: column;
                text-align: center;
            }

            .timeline-item:not(:last-child)::after {
                display: none;
            }

            .timeline-marker {
                margin-right: 0;
                margin-bottom: 10px;
            }

            .advanced-test-content {
                margin: 10px;
                max-width: calc(100vw - 20px);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧠 Nerve/MuscleTool</h1>
            <p>Interactive medical education platform for nerve anatomy and muscle innervation</p>
            <div class="alert-info">
                <strong>Learning Approach:</strong> Start with clinical presentation → Build differential → Select appropriate studies → Interpret findings
            </div>
        </div>
        
        <div class="main-content">
            <!-- Main Navigation Row -->
            <nav class="tab-navigation">
                <button class="tab-button active" onclick="showTab(0)">Interactive Case Studies</button>
                <button class="tab-button" onclick="showTab(1)">Nerve Conduction Studies</button>
                <button class="tab-button" onclick="showTab(6)">📹 NCS Videos</button>
                <button class="tab-button" onclick="showTab(7)">📖 Cardinal Rules of NCS</button>
                <button class="tab-button" onclick="showTab(2)">EMG Instruments</button>
                <button class="tab-button" onclick="showTab(3)">EMG Terms</button>
                <button class="tab-button" onclick="showTab(4)">Nerve Classifications</button>
                <button class="tab-button" onclick="showTab(5)">Quick Reference</button>
            </nav>
            
            <!-- Senior Resident Navigation Row -->
            <nav class="tab-navigation senior-navigation">
                <div class="senior-navigation-header">
                    <span class="senior-badge">🎓 SENIOR RESIDENT LEVEL</span>
                    <span class="senior-warning">Advanced tools requiring clinical experience</span>
                </div>
                <div class="senior-tabs-container">
                    <button class="tab-button senior-tab" onclick="showTab(8)">🎓 Advanced Muscle Lab</button>
                    <button class="tab-button senior-tab" onclick="showTab(9)">🧠 EMG Challenge</button>
                </div>
            </nav>
            
            <!-- Clinical Differential Tab -->
            <section id="tab-0" class="tab-content active">
                <h2 class="section-title">Interactive EMG/NCS Case Studies</h2>
                
                <div class="alert-warning">
                    <strong>Learning Approach:</strong> Practice clinical reasoning with realistic cases. Each case follows the workflow: Patient Presentation → Physical Exam → Differential Building → NCS/EMG Results → Final Diagnosis.
                </div>
                
                <!-- Case Selection Interface -->
                <div id="case-selection" class="case-selection" style="display: block;">
                    <div style="text-align: center; margin: 40px 0;">
                        <h3 style="color: #2c3e50; margin-bottom: 30px;">Ready to test your EMG/NCS knowledge?</h3>
                        <button class="start-case-button" onclick="startRandomCase()">🎯 Start Random Case</button>
                        <p style="margin-top: 20px; color: #7f8c8d;">Or customize your practice session below:</p>
                    </div>

                    <!-- Difficulty Level Selection -->
                    <div class="difficulty-selector">
                        <h3 class="selector-title">⚡ Choose Your Challenge Level</h3>
                        <p class="selector-subtitle">Select which difficulty levels you want to practice with</p>
                        
                        <div class="difficulty-cards">
                            <div class="difficulty-card beginner-card active" id="beginner-toggle" onclick="toggleDifficulty('beginner')">
                                <input type="checkbox" id="beginner-checkbox" checked>
                                <div class="card-icon">🌱</div>
                                <div class="card-title">Beginner</div>
                                <div class="card-subtitle">Learning the Basics</div>
                                <div class="status-indicator">
                                    <div class="status-light"></div>
                                    <span class="status-text">ACTIVE</span>
                                </div>
                                <div class="card-description">Perfect for residents starting their EMG/NCS journey</div>
                            </div>
                            
                            <div class="difficulty-card intermediate-card active" id="intermediate-toggle" onclick="toggleDifficulty('intermediate')">
                                <input type="checkbox" id="intermediate-checkbox" checked>
                                <div class="card-icon">🔥</div>
                                <div class="card-title">Intermediate</div>
                                <div class="card-subtitle">Building Skills</div>
                                <div class="status-indicator">
                                    <div class="status-light"></div>
                                    <span class="status-text">ACTIVE</span>
                                </div>
                                <div class="card-description">Ready for more complex diagnostic challenges</div>
                            </div>
                            
                            <div class="difficulty-card difficult-card active" id="difficult-toggle" onclick="toggleDifficulty('difficult')">
                                <input type="checkbox" id="difficult-checkbox" checked>
                                <div class="card-icon">💎</div>
                                <div class="card-title">Expert</div>
                                <div class="card-subtitle">Master Level</div>
                                <div class="status-indicator">
                                    <div class="status-light"></div>
                                    <span class="status-text">ACTIVE</span>
                                </div>
                                <div class="card-description">Advanced cases that challenge even experts</div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="primary-action-btn" onclick="startRandomCaseByDifficulty()">
                                🎲 Start Practice Session
                            </button>
                            <button class="secondary-action-btn" onclick="showCaseSelection()">
                                🎯 Choose Specific Cases
                            </button>
                        </div>
                    </div>

                    <!-- Individual Case Selection (Hidden by default) -->
                    <div class="case-selection-section" id="case-selection-section" style="display: none;">
                        <div class="section-header">
                            <h3>🎯 Select Your Cases</h3>
                            <p>Choose specific scenarios to practice</p>
                        </div>
                        
                        <div class="case-controls">
                            <button class="control-btn" onclick="selectAllCases()">✓ Select All</button>
                            <button class="control-btn" onclick="deselectAllCases()">✗ Clear All</button>
                            <button class="control-btn primary" onclick="startSelectedCases()">▶ Start Selected</button>
                            <button class="control-btn secondary" onclick="hideCaseSelection()">← Back</button>
                        </div>
                        
                        <div id="case-grid" class="case-grid">
                            <!-- Cases will be populated here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Streamlined Case Interface -->
                <div id="case-interface" class="case-interface">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                    </div>

                    <!-- Step 1: Case Presentation -->
                    <div id="case-presentation-step" class="case-step" style="display: block;">
                        <h3>📋 Patient Presentation</h3>
                        <div id="case-details">
                            <!-- Case presentation will be populated here -->
                        </div>
                        <button class="quiz-button" onclick="showPhysicalExam()">View Physical Exam →</button>
                    </div>

                    <!-- Step 2: Physical Examination -->
                    <div id="physical-exam-step" class="case-step" style="display: none;">
                        <h3>🔍 Physical Examination Findings</h3>
                        <div id="physical-exam-details">
                            <!-- Physical exam will be populated here -->
                        </div>
                        <button class="quiz-button" onclick="showCasePresentation()">← Back to Presentation</button>
                        <button class="quiz-button" onclick="showDifferentialBuilder()">Build Differential →</button>
                    </div>

                    <!-- Step 3: Differential Building -->
                    <div id="differential-step" class="case-step" style="display: none;">
                        <h3>🧠 Build Your Differential Diagnosis</h3>
                        <p><strong>Instructions:</strong> Based on the history and physical examination, list your differential diagnoses. Include both peripheral and central causes, ranking from most to least likely.</p>
                        <textarea id="user-differential" class="differential-input" placeholder="Enter your differential diagnosis list here...&#10;Example:&#10;1. Carpal tunnel syndrome&#10;2. Ulnar neuropathy at elbow&#10;3. Cervical radiculopathy&#10;..."></textarea>
                        <div id="differential-feedback" style="margin-top: 15px;"></div>
                        <button class="quiz-button" onclick="showPhysicalExam()">← Back to Exam</button>
                        <button class="quiz-button" onclick="analyzeDifferential()">Analyze Differential</button>
                        <button id="continue-to-studies" class="quiz-button" onclick="showEMGDecision()" style="display: none;">Make Clinical Decision →</button>
                    </div>

                    <!-- Step 4: EMG Indication Decision -->
                    <div id="emg-decision-step" class="case-step" style="display: none;">
                        <h3>⚖️ Clinical Decision: EMG/NCS Indication</h3>
                        <div class="card">
                            <p><strong>Based on the patient's presentation and your differential diagnosis, do the symptoms and findings warrant EMG/NCS studies?</strong></p>
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
                                <p><strong>Consider:</strong></p>
                                <ul>
                                    <li>Does this appear to be a <strong>peripheral nervous system</strong> problem?</li>
                                    <li>Would EMG/NCS help <strong>localize</strong> the lesion?</li>
                                    <li>Would EMG/NCS <strong>change management</strong>?</li>
                                    <li>Are there <strong>upper motor neuron signs</strong> suggesting central pathology?</li>
                                </ul>
                            </div>
                            <div style="text-align: center; margin: 30px 0;">
                                <button class="quiz-button" onclick="makeEMGDecision(true)" style="background: #27ae60; margin-right: 20px;">
                                    ✅ YES - EMG/NCS is indicated
                                </button>
                                <button class="quiz-button" onclick="makeEMGDecision(false)" style="background: #e74c3c;">
                                    ❌ NO - EMG/NCS is not indicated
                                </button>
                            </div>
                            <div id="emg-decision-feedback" style="margin-top: 20px;"></div>
                        </div>
                        <button class="quiz-button" onclick="showDifferentialBuilder()">← Back to Differential</button>
                        <button id="continue-after-decision" class="quiz-button" onclick="proceedAfterDecision()" style="display: none;">Continue →</button>
                    </div>

                    <!-- Step 5: NCS/EMG Results -->
                    <div id="results-step" class="case-step" style="display: none;">
                        <h3>⚡ Nerve Conduction Study Results</h3>
                        <div id="ncs-results">
                            <!-- NCS results will be populated here -->
                        </div>
                        
                        <div id="emg-results" class="emg-section" style="display: none;">
                            <h4>🔬 EMG Results (when required for diagnosis)</h4>
                            <div id="emg-details">
                                <!-- EMG results will be populated here -->
                            </div>
                        </div>
                        
                        <button class="quiz-button" onclick="showDifferentialBuilder()">← Back to Differential</button>
                        <button class="quiz-button" onclick="showFinalDiagnosis()">Make Final Diagnosis →</button>
                    </div>

                    <!-- Step 5: Final Diagnosis -->
                    <div id="diagnosis-step" class="case-step" style="display: none;">
                        <h3>🎯 Final Diagnosis</h3>
                        <p><strong>Based on the clinical presentation and test results, what is your final diagnosis?</strong></p>
                        <textarea id="final-diagnosis" class="differential-input" style="min-height: 80px;" placeholder="Enter your final diagnosis and reasoning..."></textarea>
                        <div id="diagnosis-feedback" style="margin-top: 15px;"></div>
                        <button class="quiz-button" onclick="showNCSResults()">← Back to Results</button>
                        <button class="quiz-button" onclick="checkFinalDiagnosis()">Check Diagnosis</button>
                        <button class="quiz-button" onclick="startNewCase()" style="background: #95a5a6;">Start New Case</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Key Principles for Differential Building</h3>
                    <ul>
                        <li><strong>Location, Location, Location:</strong> Anatomical distribution is key</li>
                        <li><strong>Time Course:</strong> Acute vs. chronic, progressive vs. stable</li>
                        <li><strong>Associated Symptoms:</strong> Pain, sensory loss, weakness pattern</li>
                        <li><strong>Pattern Recognition:</strong> Mononeuropathy, polyneuropathy, radiculopathy, myopathy</li>
                        <li><strong>Risk Factors:</strong> Diabetes, trauma, repetitive motion, family history</li>
                    </ul>
                </div>
            </section>
            
            <!-- NCS Reference Tab -->
            <section id="tab-1" class="tab-content">
                <h2 class="section-title">Nerve Conduction Studies</h2>
                
                <div class="alert-info">
                    <strong>Complete NCS Reference:</strong> Essential studies are highlighted with ⭐ ESSENTIAL badges - master these first. Advanced studies follow for complex cases. All studies from Preston & Shapiro included.
                </div>
                
                <div class="study-grid">
                    <div class="study-card essential">
                        <h4>Median Sensory</h4>
                        <p><strong>Recording:</strong> Index finger (digit 2) or middle finger (digit 3)</p>
                        <p><strong>Stimulation:</strong> Wrist - between FCR tendon and palmaris longus tendon, 14 cm proximal to recording electrode</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Wrist: Between flexor carpi radialis (FCR) and palmaris longus tendons<br>
                            • Feel for FCR tendon with wrist flexion and radial deviation<br>
                            • Palmaris longus absent in ~15% of population<br><br>
                            <strong>Normal Values:</strong><br>
                            • Amplitude: >15 μV<br>
                            • Velocity: >50 m/s<br>
                            • Peak Latency: <3.5 ms
                        </div>
                    </div>
                    
                    <div class="study-card essential">
                        <h4>Ulnar Sensory</h4>
                        <p><strong>Recording:</strong> Fifth digit</p>
                        <p><strong>Stimulation:</strong> Wrist - just radial to FCU tendon, 14 cm proximal to recording electrode</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Wrist: Just radial (lateral) to flexor carpi ulnaris (FCU) tendon<br>
                            • FCU tendon easily palpated with wrist flexion and ulnar deviation<br>
                            • Nerve lies between FCU tendon and ulnar artery<br><br>
                            <strong>Normal Values:</strong><br>
                            • Amplitude: >10 μV<br>
                            • Velocity: >50 m/s<br>
                            • Peak Latency: <3.5 ms
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Dorsal Ulnar Cutaneous (DUC)</h4>
                        <p><strong>Recording:</strong> Dorsal hand between 4th and 5th metacarpals</p>
                        <p><strong>Stimulation:</strong> Medial forearm, 10 cm proximal to ulnar styloid</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Stimulation: 10 cm proximal to ulnar styloid along medial forearm<br>
                            • Between FCU and ulnar shaft<br>
                            • DUC branches from main ulnar nerve ~5-8 cm proximal to wrist<br><br>
                            <strong>Clinical Use:</strong><br>
                            • Differentiates ulnar neuropathy at wrist vs. elbow<br>
                            • Normal in ulnar neuropathy at wrist
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Radial Sensory</h4>
                        <p><strong>Recording:</strong> Dorsal web space between thumb and index finger</p>
                        <p><strong>Stimulation:</strong> Lateral forearm between brachioradialis and ECRL tendons</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Stimulation: Between brachioradialis and extensor carpi radialis longus (ECRL)<br>
                            • ~10 cm proximal to radial styloid<br>
                            • Nerve becomes superficial at junction of middle and distal third of forearm<br><br>
                            <strong>Normal Values:</strong><br>
                            • Amplitude: >15 μV<br>
                            • Velocity: >50 m/s
                        </div>
                    </div>
                    
                    <div class="study-card essential">
                        <h4>Median Motor</h4>
                        <p><strong>Recording:</strong> Thenar muscles (APB)</p>
                        <p><strong>Stimulation:</strong> Wrist, elbow</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Wrist: Between FCR and palmaris longus tendons<br>
                            • Elbow: Medial to brachial artery, medial edge of biceps tendon<br>
                            • In antecubital fossa, just medial to brachial artery pulsation<br><br>
                            <strong>Normal Values:</strong><br>
                            • Distal Amplitude: >4 mV<br>
                            • Distal Latency: <4.4 ms<br>
                            • Velocity: >50 m/s
                        </div>
                    </div>
                    
                    <div class="study-card essential">
                        <h4>Ulnar Motor</h4>
                        <p><strong>Recording:</strong> Hypothenar muscles (ADM)</p>
                        <p><strong>Stimulation:</strong> Wrist, below elbow, above elbow</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Wrist: Just radial to FCU tendon<br>
                            • Below elbow: In cubital tunnel, between medial epicondyle and olecranon<br>
                            • Above elbow: Medial arm, 10 cm above medial epicondyle<br>
                            • Keep elbow flexed ~90° for below/above elbow stimulation<br><br>
                            <strong>Normal Values:</strong><br>
                            • Distal Amplitude: >6 mV<br>
                            • Distal Latency: <3.3 ms<br>
                            • Velocity: >50 m/s
                        </div>
                    </div>
                    
                    <div class="study-card essential">
                        <h4>Fibular (Peroneal) Motor</h4>
                        <p><strong>Recording:</strong> Extensor digitorum brevis (EDB)</p>
                        <p><strong>Stimulation:</strong> Ankle, fibular head, popliteal fossa</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Ankle: Lateral to extensor hallucis longus tendon, above ankle joint<br>
                            • Fibular head: Just posterior and inferior to fibular head<br>
                            • Popliteal fossa: Lateral edge, follow biceps femoris tendon<br>
                            • Common fibular nerve wraps around fibular neck<br><br>
                            <strong>Normal Values:</strong><br>
                            • Distal Amplitude: >2.5 mV<br>
                            • Distal Latency: <6.5 ms<br>
                            • Velocity: >44 m/s
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Tibial Motor</h4>
                        <p><strong>Recording:</strong> Abductor hallucis</p>
                        <p><strong>Stimulation:</strong> Ankle, popliteal fossa</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Ankle: Posterior to medial malleolus, between malleolus and Achilles tendon<br>
                            • Popliteal fossa: Medial edge, between medial and lateral heads of gastrocnemius<br>
                            • At ankle, nerve lies between flexor digitorum longus and flexor hallucis longus<br><br>
                            <strong>Normal Values:</strong><br>
                            • Distal Amplitude: >4 mV<br>
                            • Distal Latency: <5.8 ms<br>
                            • Velocity: >41 m/s
                        </div>
                    </div>
                    
                    <div class="study-card essential">
                        <h4>Sural Sensory</h4>
                        <p><strong>Recording:</strong> Lateral foot behind lateral malleolus</p>
                        <p><strong>Stimulation:</strong> Mid-calf, lateral to Achilles tendon, 14 cm proximal</p>
                        <div class="technique-details">
                            <strong>Anatomical Landmarks:</strong><br>
                            • Recording: Behind and below lateral malleolus<br>
                            • Stimulation: Mid-calf, lateral border of Achilles tendon<br>
                            • Nerve lies between lateral border of Achilles and lateral malleolus<br><br>
                            <strong>Clinical Use:</strong><br>
                            • Often preserved in L5/S1 radiculopathy<br>
                            • Affected early in polyneuropathy
                        </div>
                    </div>
                    
                    <!-- ADVANCED STUDIES -->
                    <div class="study-card advanced">
                        <h4>Median Sensory - Ring Finger (Mixed)</h4>
                        <p><strong>Recording:</strong> Ring finger (digit 4)</p>
                        <p><strong>Stimulation:</strong> Wrist, 14 cm proximal</p>
                        <div class="technique-details">
                            <strong>Purpose:</strong> Compares median vs ulnar innervation to ring finger<br>
                            <strong>Normal:</strong> Median amplitude usually smaller than ulnar<br>
                            <strong>Pathological significance:</strong> Median > ulnar suggests ulnar neuropathy
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Median Sensory - Thumb</h4>
                        <p><strong>Recording:</strong> Thumb (digit 1)</p>
                        <p><strong>Stimulation:</strong> Wrist, 10 cm proximal</p>
                        <div class="technique-details">
                            <strong>Purpose:</strong> Pure median sensory territory<br>
                            <strong>Technique:</strong> Bar electrodes on thumb<br>
                            <strong>Clinical use:</strong> Carpal tunnel syndrome evaluation
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Median Motor - 2nd Lumbrical</h4>
                        <p><strong>Recording:</strong> 2nd lumbrical muscle</p>
                        <p><strong>Stimulation:</strong> Wrist</p>
                        <div class="technique-details">
                            <strong>Electrode placement:</strong> Between 2nd and 3rd metacarpals<br>
                            <strong>Purpose:</strong> Distal median motor function<br>
                            <strong>Advantage:</strong> No ulnar innervation contamination
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Ulnar Sensory - Little Finger</h4>
                        <p><strong>Recording:</strong> Little finger (digit 5)</p>
                        <p><strong>Stimulation:</strong> Wrist, 14 cm proximal</p>
                        <div class="technique-details">
                            <strong>Landmark:</strong> Just medial to FCU tendon<br>
                            <strong>Purpose:</strong> Pure ulnar sensory territory<br>
                            <strong>Normal values:</strong> Peak latency <3.7 ms, amplitude >6 μV
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Ulnar Motor - First Dorsal Interosseous</h4>
                        <p><strong>Recording:</strong> First dorsal interosseous</p>
                        <p><strong>Stimulation:</strong> Wrist, below elbow, above elbow</p>
                        <div class="technique-details">
                            <strong>Electrode placement:</strong> Between thumb and index metacarpals<br>
                            <strong>Purpose:</strong> Deep branch ulnar motor function<br>
                            <strong>Clinical use:</strong> Ulnar neuropathy at Guyon's canal
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Radial Sensory - Superficial Branch</h4>
                        <p><strong>Recording:</strong> Anatomical snuffbox</p>
                        <p><strong>Stimulation:</strong> Forearm, 10-12 cm proximal</p>
                        <div class="technique-details">
                            <strong>Landmark:</strong> Lateral border of radius<br>
                            <strong>Purpose:</strong> Superficial radial nerve function<br>
                            <strong>Clinical use:</strong> Radial tunnel syndrome, Saturday night palsy
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Radial Motor - Extensor Indicis</h4>
                        <p><strong>Recording:</strong> Extensor indicis muscle</p>
                        <p><strong>Stimulation:</strong> Posterior interosseous nerve at forearm</p>
                        <div class="technique-details">
                            <strong>Electrode placement:</strong> Dorsal forearm, ulnar to EPL tendon<br>
                            <strong>Purpose:</strong> Posterior interosseous nerve function<br>
                            <strong>Clinical use:</strong> Radial tunnel syndrome
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Lateral Antebrachial Cutaneous</h4>
                        <p><strong>Recording:</strong> Lateral forearm</p>
                        <p><strong>Stimulation:</strong> Lateral elbow, 14 cm proximal</p>
                        <div class="technique-details">
                            <strong>Purpose:</strong> Musculocutaneous nerve sensory branch<br>
                            <strong>Clinical use:</strong> Lateral cord plexopathy<br>
                            <strong>Technique:</strong> Patient supination, stimulate lateral to biceps
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Medial Antebrachial Cutaneous</h4>
                        <p><strong>Recording:</strong> Medial forearm</p>
                        <p><strong>Stimulation:</strong> Medial elbow, 14 cm proximal</p>
                        <div class="technique-details">
                            <strong>Purpose:</strong> Medial cord function<br>
                            <strong>Clinical use:</strong> Medial cord plexopathy, thoracic outlet syndrome<br>
                            <strong>Normal:</strong> Often small amplitude, difficult to obtain
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Median-Ulnar Comparison Studies</h4>
                        <p><strong>Multiple comparison techniques</strong></p>
                        <div class="technique-details">
                            <strong>Palmar mixed (palm-wrist):</strong> 8 cm segment<br>
                            <strong>Ring finger comparison:</strong> Median vs ulnar to digit 4<br>
                            <strong>Thumb-little finger:</strong> Median digit 1 vs ulnar digit 5<br>
                            <strong>Purpose:</strong> Increase sensitivity for carpal tunnel syndrome<br>
                            <strong>Normal:</strong> <0.4 ms difference median-ulnar latencies
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Axillary Motor</h4>
                        <p><strong>Recording:</strong> Deltoid muscle (middle portion)</p>
                        <p><strong>Stimulation:</strong> Erb's point</p>
                        <div class="technique-details">
                            <strong>Electrode placement:</strong> Lateral deltoid, 10-12 cm from acromion<br>
                            <strong>Purpose:</strong> Posterior cord/axillary nerve function<br>
                            <strong>Clinical use:</strong> Shoulder trauma, quadrilateral space syndrome
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Suprascapular Motor</h4>
                        <p><strong>Recording:</strong> Supraspinatus or infraspinatus</p>
                        <p><strong>Stimulation:</strong> Suprascapular notch</p>
                        <div class="technique-details">
                            <strong>Purpose:</strong> Upper trunk brachial plexus<br>
                            <strong>Clinical use:</strong> Erb's palsy, suprascapular nerve entrapment<br>
                            <strong>Technique:</strong> Needle electrodes often required
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Long Thoracic Motor</h4>
                        <p><strong>Recording:</strong> Serratus anterior</p>
                        <p><strong>Stimulation:</strong> Erb's point</p>
                        <div class="technique-details">
                            <strong>Purpose:</strong> Long thoracic nerve function<br>
                            <strong>Clinical use:</strong> Winged scapula, neuralgic amyotrophy<br>
                            <strong>Technique:</strong> Patient in lateral position
                        </div>
                    </div>

                    <div class="study-card advanced">
                        <h4>Spinal Accessory Motor</h4>
                        <p><strong>Recording:</strong> Upper trapezius</p>
                        <p><strong>Stimulation:</strong> Posterior border SCM muscle</p>
                        <div class="technique-details">
                            <strong>Purpose:</strong> CN XI function<br>
                            <strong>Clinical use:</strong> Neck surgery complications, trauma<br>
                            <strong>Normal:</strong> Bilateral comparison important
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Cardinal Rules of NCS (Preston & Shapiro)</h3>
                    <div class="alert-warning">
                        <strong>Essential principles that every resident must remember:</strong>
                    </div>
                    <ol>
                        <li><strong>NCS are an extension of the clinical examination</strong> - Always correlate findings with clinical symptoms</li>
                        <li><strong>When in doubt, think technical factors</strong> - Most "abnormalities" are technical errors</li>
                        <li><strong>When in doubt, reexamine the patient</strong> - If findings don't match exam, recheck both</li>
                        <li><strong>Use supramaximal stimulation</strong> - Increase current 20% beyond plateau</li>
                        <li><strong>Optimize stimulator position</strong> - Find lowest threshold, then increase to supramaximal</li>
                        <li><strong>Don't overcall abnormalities</strong> - Minor findings without clinical correlation may be irrelevant</li>
                    </ol>
                </div>

                <div class="card">
                    <h3>Key Technical Points</h3>
                    <ul>
                        <li><strong>Temperature:</strong> Keep limbs warm (>32°C) - cold slows conduction velocity</li>
                        <li><strong>Supramaximal Stimulation:</strong> Increase intensity until no further amplitude increase, then add 20%</li>
                        <li><strong>Electrode Placement:</strong> Precise anatomical landmarks are crucial for reproducible results</li>
                        <li><strong>Distance Measurement:</strong> Use consistent surface measurements with tape measure</li>
                        <li><strong>Artifact Minimization:</strong> Proper grounding and electrode impedance (<5 kΩ)</li>
                        <li><strong>Stimulator Optimization:</strong> Start with low intensity, find optimal position, then increase</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>Volume Conduction Principles</h3>
                    <p><strong>Understanding how electrical signals travel from nerve/muscle to recording electrodes:</strong></p>
                    <ul>
                        <li><strong>Near-field Potentials:</strong> Most NCS record near-field potentials (CMAPs, SNAPs)</li>
                        <li><strong>Triphasic Waveforms:</strong> Advancing action potential creates positive→negative→positive phases</li>
                        <li><strong>Biphasic Waveforms:</strong> Action potential starting under electrode (motor studies)</li>
                        <li><strong>Distance Effects:</strong> Amplitude decreases with distance from source</li>
                        <li><strong>Far-field Potentials:</strong> Stimulus artifact is example - appears instantly at all sites</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>Temporal Dispersion & Phase Cancellation</h3>
                    <p><strong>Why proximal sensory responses are smaller and longer:</strong></p>
                    <ul>
                        <li><strong>Temporal Dispersion:</strong> Fast fibers arrive before slow fibers (more with distance)</li>
                        <li><strong>Phase Cancellation:</strong> Positive phase of fast fibers overlaps negative phase of slow fibers</li>
                        <li><strong>Normal Effect:</strong> Proximal SNAPs have lower amplitude, longer duration</li>
                        <li><strong>Pathological Enhancement:</strong> Demyelination worsens these effects</li>
                        <li><strong>Motor vs Sensory:</strong> Less prominent in motor studies due to longer MUAP duration</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>Orthodromic vs Antidromic Studies</h3>
                    <p><strong>Two methods for sensory conduction studies:</strong></p>
                    <div class="technique-details">
                        <strong>Antidromic (Preferred):</strong><br>
                        • Stimulate nerve, record from digit<br>
                        • Higher amplitude responses<br>
                        • May have volume-conducted motor potential<br>
                        • Better for small/pathologic potentials<br><br>
                        <strong>Orthodromic:</strong><br>
                        • Stimulate digit, record from nerve<br>
                        • Lower amplitude responses<br>
                        • No motor contamination<br>
                        • Useful when antidromic unclear<br>
                        • Same latencies as antidromic
                    </div>
                </div>
                <div class="card">
                    <h3>Basic Nerve Physiology for NCS</h3>
                    <p><strong>Understanding saltatory conduction and myelination:</strong></p>
                    <ul>
                        <li><strong>Myelinated Fibers:</strong> Conduct 35-75 m/s via saltatory conduction</li>
                        <li><strong>Nodes of Ranvier:</strong> Action potential "jumps" between nodes (every ~1mm)</li>
                        <li><strong>Unmyelinated Fibers:</strong> Conduct 0.2-1.5 m/s (pain, temperature, autonomic)</li>
                        <li><strong>Myelin Function:</strong> Insulates internodes, reduces capacitance, speeds conduction</li>
                        <li><strong>NCS Records:</strong> Only largest, fastest myelinated fibers</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>Nerve Fiber Classification (Preston & Shapiro)</h3>
                    <div class="technique-details">
                        <strong>Motor Fibers:</strong><br>
                        • Aα (6-12 μm diameter, 35-75 m/s)<br>
                        • Recorded in routine motor NCS<br><br>
                        <strong>Sensory Fibers:</strong><br>
                        • Aβ (6-12 μm, 35-75 m/s) - Touch, vibration, recorded in routine sensory NCS<br>
                        • Aδ (1-5 μm, 5-30 m/s) - Pain, temperature, NOT recorded in routine NCS<br>
                        • C fibers (0.2-1.5 μm, 1-2 m/s) - Pain, temperature, NOT recorded<br><br>
                        <strong>Muscle Afferents (Ia fibers):</strong><br>
                        • Aα (12-21 μm, 80-120 m/s) - Largest, fastest fibers<br>
                        • Only recorded in mixed nerve studies<br>
                        • Often first affected in demyelinating lesions
                    </div>
                </div>

                <div class="card">
                    <h3>Mixed Nerve Studies</h3>
                    <p><strong>When and why to use mixed nerve studies:</strong></p>
                    <ul>
                        <li><strong>Records All Fibers:</strong> Motor, sensory, AND muscle afferents (Ia fibers)</li>
                        <li><strong>Fastest Velocities:</strong> Include largest Ia fibers (up to 120 m/s)</li>
                        <li><strong>Early Demyelination:</strong> Ia fibers affected first in entrapment neuropathies</li>
                        <li><strong>Common Studies:</strong> Median palm-wrist, ulnar palm-wrist, tibial across tarsal tunnel</li>
                        <li><strong>Technique:</strong> Similar to sensory studies but records all nerve fibers</li>
                    </ul>
                </div>

                <div class="card">
                    <h3>Wallerian Degeneration Timeline</h3>
                    <p><strong>Critical timing for interpreting acute nerve injuries:</strong></p>
                    <div class="technique-details">
                        <strong>Day 0-3:</strong> Normal distal NCS despite proximal nerve injury<br>
                        <strong>Day 3-5:</strong> Motor responses begin to decline<br>
                        <strong>Day 6-10:</strong> Sensory responses begin to decline<br>
                        <strong>Day 7-10:</strong> Distal nerve becomes inexcitable<br>
                        <strong>Weeks 2-3:</strong> Fibrillations appear on needle EMG<br>
                        <strong>Months 3-6:</strong> Reinnervation potentials appear if recovery occurs<br><br>
                        <strong>Clinical Implication:</strong> Normal NCS in first week don't exclude severe nerve injury
                    </div>
                </div>

            </section>
            
            <!-- EMG Instruments Tab -->
            <section id="tab-2" class="tab-content">
                <h2 class="section-title">EMG Machine Components & Needles</h2>
                
                <div class="study-grid">
                    <div class="study-card">
                        <h4>Amplifier</h4>
                        <p>Amplifies the small electrical signals from muscles and nerves (typically 1000-10,000 times amplification).</p>
                        <div class="technique-details">
                            <strong>Key Features:</strong><br>
                            • High input impedance<br>
                            • Low noise<br>
                            • Differential amplification
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Filters</h4>
                        <p>Remove unwanted frequencies and noise from the signal.</p>
                        <div class="technique-details">
                            <strong>Settings:</strong><br>
                            • Low-frequency filter: 2-10 Hz<br>
                            • High-frequency filter: 10-10,000 Hz<br>
                            • Notch filter: 60 Hz (removes power line noise)
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Stimulator</h4>
                        <p>Delivers electrical pulses to stimulate nerves during NCS.</p>
                        <div class="technique-details">
                            <strong>Parameters:</strong><br>
                            • Duration: 0.1-1.0 ms<br>
                            • Intensity: 0-300 mA<br>
                            • Can deliver single or repetitive pulses
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Display Monitor</h4>
                        <p>Shows the amplified and processed electrical signals in real-time.</p>
                        <div class="technique-details">
                            <strong>Display Options:</strong><br>
                            • Waveform visualization<br>
                            • Multiple trace overlay<br>
                            • Measurement cursors<br>
                            • Real-time parameter calculation
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Audio System</h4>
                        <p>Converts electrical signals to sound for EMG needle examination.</p>
                        <div class="technique-details">
                            <strong>Importance:</strong><br>
                            • Helps identify abnormal spontaneous activity<br>
                            • Assists in motor unit analysis<br>
                            • Provides real-time feedback during needle insertion
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Ground Electrode</h4>
                        <p>Provides electrical reference point and reduces artifact.</p>
                        <div class="technique-details">
                            <strong>Placement:</strong><br>
                            • Between stimulator and recording electrodes<br>
                            • Over bony prominence<br>
                            • Must have good skin contact
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>EMG Needle Types</h3>
                    <div class="study-grid">
                        <div class="study-card">
                            <h4>Monopolar Needle</h4>
                            <p>Single recording surface at the tip with reference electrode on the skin.</p>
                            <div class="technique-details">
                                <strong>Characteristics:</strong><br>
                                • Large recording area<br>
                                • Higher amplitude signals<br>
                                • More painful insertion<br>
                                • Better for detecting small potentials
                            </div>
                        </div>
                        
                        <div class="study-card">
                            <h4>Concentric Needle</h4>
                            <p>Central wire surrounded by cannula; most commonly used needle.</p>
                            <div class="technique-details">
                                <strong>Characteristics:</strong><br>
                                • Smaller recording area<br>
                                • Less painful<br>
                                • Better spatial resolution<br>
                                • More selective recording
                            </div>
                        </div>
                        
                        <div class="study-card">
                            <h4>Single Fiber Needle</h4>
                            <p>Extremely small recording surface for specialized studies.</p>
                            <div class="technique-details">
                                <strong>Uses:</strong><br>
                                • Single fiber EMG<br>
                                • Neuromuscular junction disorders<br>
                                • Requires special expertise<br>
                                • Not used in routine EMG
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert-info">
                    <strong>Safety Note:</strong> Always use sterile, disposable needles. Follow universal precautions and proper needle disposal protocols.
                </div>
            </section>
            
            <!-- EMG Terms Tab -->
            <section id="tab-3" class="tab-content">
                <h2 class="section-title">Essential EMG Terminology</h2>
                
                <div class="term-grid">
                    <div class="term-card">
                        <div class="term-name">Insertional Activity</div>
                        <div class="term-description">Brief electrical activity that occurs when the needle is inserted or moved within the muscle. Normal duration is less than 300ms. Increased insertional activity may indicate muscle membrane instability.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Spontaneous Activity</div>
                        <div class="term-description">Electrical activity present in muscle at rest after insertional activity has ceased. Normal muscle is electrically silent at rest. Abnormal spontaneous activity includes fibrillations, positive sharp waves, and fasciculations.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Fibrillation Potentials</div>
                        <div class="term-description">Small amplitude (20-200 μV), short duration (1-5 ms) potentials that fire regularly at 1-50 Hz. Sound like "rain on a tin roof." Indicate denervated muscle fibers, typically appearing 2-3 weeks after nerve injury.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Positive Sharp Waves</div>
                        <div class="term-description">Initially positive, sharp deflection followed by slow negative phase. Similar significance to fibrillation potentials but represent different firing patterns of denervated muscle fibers. Sound like "dull thuds."</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Fasciculations</div>
                        <div class="term-description">Spontaneous firing of an entire motor unit, producing larger amplitude potentials than fibrillations. Can be benign or pathological. Often visible through the skin as muscle twitching.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Motor Unit</div>
                        <div class="term-description">The basic functional unit consisting of an anterior horn cell, its axon, and all muscle fibers it innervates. In EMG, refers to the electrical signal generated by voluntary contraction of this unit.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Recruitment</div>
                        <div class="term-description">The activation of additional motor units as the force of muscle contraction increases. Normal recruitment follows the size principle: small motor units recruited before large ones.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Interference Pattern</div>
                        <div class="term-description">The EMG pattern during maximal voluntary contraction when individual motor units cannot be distinguished. Reduced interference pattern suggests loss of motor units (neurogenic process).</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Polyphasic Potentials</div>
                        <div class="term-description">Motor unit potentials with 5 or more phases (baseline crossings). Up to 15% polyphasic potentials can be normal. Increased polyphasia suggests reinnervation or muscle disease.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">MUAP (Motor Unit Action Potential)</div>
                        <div class="term-description">The electrical signal recorded from a motor unit during voluntary contraction. Analyzed for amplitude, duration, and morphology to assess for neurogenic or myopathic changes.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Neurogenic Changes</div>
                        <div class="term-description">EMG findings suggesting nerve or anterior horn cell pathology: increased MUAP amplitude and duration, reduced recruitment, abnormal spontaneous activity, and increased polyphasia during reinnervation.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Myopathic Changes</div>
                        <div class="term-description">EMG findings suggesting primary muscle disease: decreased MUAP amplitude and duration, early/excessive recruitment, and sometimes abnormal spontaneous activity in inflammatory myopathies.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Conduction Block</div>
                        <div class="term-description">Failure of action potential propagation along a nerve segment, resulting in significant amplitude drop (>50%) without corresponding prolongation of distal latency. Suggests demyelinating neuropathy.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">Temporal Dispersion</div>
                        <div class="term-description">Prolongation and widening of the compound action potential due to variable conduction velocities of individual axons. Often accompanies conduction block in demyelinating neuropathies.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">F-waves</div>
                        <div class="term-description">Late responses resulting from antidromic activation of anterior horn cells. Used to assess proximal nerve conduction and nerve root function. Normal F-wave latency rules out proximal conduction abnormalities.</div>
                    </div>
                    
                    <div class="term-card">
                        <div class="term-name">H-reflex</div>
                        <div class="term-description">Electrically elicited stretch reflex, most commonly tested in the calf muscles via tibial nerve stimulation. Useful for assessing S1 nerve root function and early polyneuropathy detection.</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Pattern Recognition for Residents</h3>
                    <div class="alert-info">
                        <strong>Axonal vs. Demyelinating Patterns:</strong><br><br>
                        <strong>Axonal:</strong> Reduced amplitudes, normal or mildly slow velocities, normal distal latencies<br>
                        <strong>Demyelinating:</strong> Prolonged distal latencies, slow velocities, conduction blocks, temporal dispersion
                    </div>
                </div>
            </section>
            
            <!-- Nerve Classifications Tab -->
            <section id="tab-4" class="tab-content">
                <h2 class="section-title">Nerve Injury Classification</h2>
                
                <div class="alert-info">
                    <strong>Clinical Correlation:</strong> Understanding nerve injury classification helps predict recovery and guide treatment decisions. EMG findings evolve over time based on injury severity.
                </div>
                
                <div class="study-grid">
                    <div class="study-card">
                        <h4>Neurapraxia (Sunderland Grade 1)</h4>
                        <p><strong>Pathology:</strong> Temporary loss of nerve function due to focal demyelination</p>
                        <div class="technique-details">
                            <strong>EMG Findings:</strong><br>
                            • Conduction block across lesion<br>
                            • Normal distal conduction<br>
                            • No denervation changes<br>
                            • Recovery: Days to weeks
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Axonotmesis (Sunderland Grades 2-4)</h4>
                        <p><strong>Pathology:</strong> Axon disruption with intact endoneurium (Grade 2) to perineurium/epineurium damage (Grades 3-4)</p>
                        <div class="technique-details">
                            <strong>EMG Findings:</strong><br>
                            • Loss of voluntary motor units<br>
                            • Fibrillations and positive sharp waves<br>
                            • Reduced/absent compound action potentials<br>
                            • Recovery: Months, may be incomplete
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Neurotmesis (Sunderland Grade 5)</h4>
                        <p><strong>Pathology:</strong> Complete nerve transection with disruption of all neural structures</p>
                        <div class="technique-details">
                            <strong>EMG Findings:</strong><br>
                            • Complete loss of nerve function<br>
                            • Absent compound action potentials<br>
                            • Extensive denervation changes<br>
                            • Recovery: Requires surgical repair
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Seddon Classification (Simplified)</h3>
                    <ul>
                        <li><strong>Neurapraxia:</strong> Temporary loss, full recovery expected</li>
                        <li><strong>Axonotmesis:</strong> Axon damage, variable recovery</li>
                        <li><strong>Neurotmesis:</strong> Complete severance, requires surgery</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>EMG Timing After Nerve Injury</h3>
                    <ul>
                        <li><strong>0-7 days:</strong> Motor units still responsive distal to lesion</li>
                        <li><strong>7-10 days:</strong> Distal motor responses begin to decline</li>
                        <li><strong>2-3 weeks:</strong> Fibrillations and positive sharp waves appear</li>
                        <li><strong>3-6 months:</strong> Reinnervation changes may appear (polyphasic MUAPs)</li>
                        <li><strong>6-12 months:</strong> Chronic changes stabilize</li>
                    </ul>
                </div>
            </section>
            
            <!-- NCS Videos Tab -->
            <!-- Quick Reference Tab -->
            <section id="tab-5" class="tab-content">
                <h2 class="section-title">Quick Reference Guide</h2>
                
                <div class="study-grid">
                    <div class="study-card">
                        <h4>Normal Values Summary</h4>
                        <div class="technique-details">
                            <strong>Sensory NCS:</strong><br>
                            • Amplitude: >10-15 μV<br>
                            • Velocity: >50 m/s<br>
                            • Peak Latency: <3.5 ms<br><br>
                            <strong>Motor NCS:</strong><br>
                            • Amplitude: >4-6 mV (varies by nerve)<br>
                            • Velocity: >50 m/s (arm), >44 m/s (leg)<br>
                            • Distal Latency: <4.4 ms (varies by nerve)
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Axonal vs Demyelinating Criteria</h4>
                        <div class="technique-details">
                            <strong>Axonal Loss Pattern:</strong><br>
                            • Reduced amplitudes (primary finding)<br>
                            • Normal or mildly slow CV (never <75% LLN)<br>
                            • Normal or mildly prolonged DL (never >130% ULN)<br>
                            • No change in waveform morphology<br><br>
                            <strong>Demyelinating Pattern:</strong><br>
                            • Markedly slow CV (<75% LLN or <35 m/s arm/<30 m/s leg)<br>
                            • Markedly prolonged DL (>130% ULN)<br>
                            • May have conduction block/temporal dispersion<br>
                            • Amplitudes may be reduced (especially sensory)
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Conduction Block Criteria</h4>
                        <div class="technique-details">
                            <strong>Motor Conduction Block:</strong><br>
                            • >50% drop in area between distal/proximal sites<br>
                            • >20% drop suggests possible block<br>
                            • Often associated with temporal dispersion<br>
                            • Duration increase >15% = abnormal dispersion<br><br>
                            <strong>Clinical Significance:</strong><br>
                            • Indicates acquired demyelination<br>
                            • Good prognosis (remyelination possible)<br>
                            • Differentiates from axonal loss
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Normal Sensory NCS Patterns</h4>
                        <div class="technique-details">
                            <strong>Root Lesions:</strong><br>
                            • Normal SNAPs (DRG intact)<br>
                            • Abnormal needle EMG in myotome<br>
                            • Motor NCS may be abnormal<br><br>
                            <strong>Peripheral Nerve Lesions:</strong><br>
                            • Abnormal SNAPs in nerve distribution<br>
                            • Abnormal motor NCS in same nerve<br>
                            • Needle EMG abnormal in nerve distribution
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>Common Technical Pitfalls</h4>
                        <div class="technique-details">
                            <strong>Temperature Effects:</strong><br>
                            • Cold limbs (keep >32°C)<br>
                            • 2°C cooling = 5% velocity decrease<br><br>
                            <strong>Stimulation Errors:</strong><br>
                            • Submaximal stimulation<br>
                            • Co-stimulation of adjacent nerves<br>
                            • Poor electrode contact<br><br>
                            <strong>Measurement Errors:</strong><br>
                            • Inaccurate distance measurement<br>
                            • Wrong latency markers<br>
                            • Baseline drift artifacts
                        </div>
                    </div>
                    
                    <div class="study-card">
                        <h4>When to Order EMG/NCS</h4>
                        <div class="technique-details">
                            <strong>Appropriate Indications:</strong><br>
                            • Localize nerve lesions<br>
                            • Differentiate neurogenic vs. myopathic<br>
                            • Assess severity and prognosis<br>
                            • Monitor disease progression<br>
                            • Evaluate weakness of unknown cause<br><br>
                            <strong>Not Indicated For:</strong><br>
                            • Chronic back pain without radiculopathy<br>
                            • Fibromyalgia or chronic pain syndromes<br>
                            • Central nervous system disorders<br>
                            • Pure sensory symptoms with normal exam
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Quick Clinical Decision Tree</h3>
                    <div class="alert-info">
                        <strong>Fast decision making for EMG/NCS clinical scenarios:</strong>
                    </div>
                    <div class="technique-details">
                        <strong>Weakness Pattern Analysis:</strong><br>
                        • Distal symmetrical → Polyneuropathy (NCS first)<br>
                        • Proximal symmetrical → Myopathy (EMG first)<br>
                        • Asymmetrical → Mononeuropathy/radiculopathy (NCS + EMG)<br>
                        • Upper motor neuron signs → EMG/NCS NOT indicated<br><br>
                        <strong>Sensory Loss Patterns:</strong><br>
                        • Glove/stocking → Polyneuropathy<br>
                        • Dermatomal → Radiculopathy<br>
                        • Specific nerve distribution → Mononeuropathy<br><br>
                        <strong>Quick Decision Rules:</strong><br>
                        • Normal SNAPs + clinical sensory loss = Proximal to DRG<br>
                        • Amplitude ↓ = Axonal injury<br>
                        • Velocity/Latency ↓ = Demyelination<br>
                        • Always check temperature (>32°C required)
                    </div>
                </div>
            </section>

            <!-- Tab 6: NCS Videos -->
            <section id="tab-6" class="tab-content">
                <h2 class="section-title">📹 NCS/EMG Video Library</h2>
                <p class="section-description">Curated collection of educational videos covering nerve conduction study techniques, electrode placement, and EMG interpretation methods for comprehensive learning.</p>
                
                <div class="video-grid" id="video-grid">
                    <!-- Video cards will be populated here -->
                </div>
            </section>

            <!-- Tab 7: Cardinal Rules of NCS -->
            <section id="tab-7" class="tab-content">
                <h2 class="section-title">📖 Cardinal Rules of NCS (Preston & Shapiro)</h2>
                <p class="section-description">Essential principles that every resident must master for successful nerve conduction studies. These fundamental rules form the foundation of accurate EMG/NCS practice and interpretation.</p>
                
                <div class="cardinal-rules-container">
                    <!-- Essential Principles -->
                    <div class="rule-section">
                        <div class="section-header">
                            <h3>🎯 Cardinal Rules of NCS</h3>
                            <p class="section-subtitle">Essential principles that every resident must remember</p>
                        </div>
                        
                        <div class="rules-grid">
                            <div class="rule-card rule-1">
                                <div class="rule-number">1</div>
                                <div class="rule-content">
                                    <h4>Clinical Correlation First</h4>
                                    <p><strong>NCS are an extension of the clinical examination</strong> - Always correlate findings with clinical symptoms</p>
                                </div>
                            </div>
                            
                            <div class="rule-card rule-2">
                                <div class="rule-number">2</div>
                                <div class="rule-content">
                                    <h4>Technical Factors Rule</h4>
                                    <p><strong>When in doubt, think technical factors</strong> - Most "abnormalities" are technical errors</p>
                                </div>
                            </div>
                            
                            <div class="rule-card rule-3">
                                <div class="rule-number">3</div>
                                <div class="rule-content">
                                    <h4>Reexamine When Needed</h4>
                                    <p><strong>When in doubt, reexamine the patient</strong> - If findings don't match exam, recheck both</p>
                                </div>
                            </div>
                            
                            <div class="rule-card rule-4">
                                <div class="rule-number">4</div>
                                <div class="rule-content">
                                    <h4>Supramaximal Stimulation</h4>
                                    <p><strong>Use supramaximal stimulation</strong> - Increase current 20% beyond plateau</p>
                                </div>
                            </div>
                            
                            <div class="rule-card rule-5">
                                <div class="rule-number">5</div>
                                <div class="rule-content">
                                    <h4>Optimize Stimulator Position</h4>
                                    <p><strong>Find lowest threshold, then increase to supramaximal</strong></p>
                                </div>
                            </div>
                            
                            <div class="rule-card rule-6">
                                <div class="rule-number">6</div>
                                <div class="rule-content">
                                    <h4>Don't Overcall Abnormalities</h4>
                                    <p><strong>Minor findings without clinical correlation may be irrelevant</strong></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Wallerian Degeneration Timeline -->
                    <div class="rule-section">
                        <div class="section-header">
                            <h3>⏰ Wallerian Degeneration Timeline</h3>
                            <p class="section-subtitle">Critical timing for interpreting acute nerve injuries</p>
                        </div>
                        
                        <div class="timeline-container">
                            <div class="timeline-item">
                                <div class="timeline-marker day-0">Day 0-3</div>
                                <div class="timeline-content">
                                    <h4>Immediate Phase</h4>
                                    <p>Normal distal NCS despite proximal nerve injury</p>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-marker day-3">Day 3-5</div>
                                <div class="timeline-content">
                                    <h4>Motor Decline</h4>
                                    <p>Motor responses begin to decline</p>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-marker day-6">Day 6-10</div>
                                <div class="timeline-content">
                                    <h4>Sensory Decline</h4>
                                    <p>Sensory responses begin to decline</p>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-marker day-7">Day 7-10</div>
                                <div class="timeline-content">
                                    <h4>Complete Loss</h4>
                                    <p>Distal nerve becomes inexcitable</p>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-marker week-2">Week 2-3</div>
                                <div class="timeline-content">
                                    <h4>EMG Changes</h4>
                                    <p>Fibrillations appear on needle EMG</p>
                                </div>
                            </div>
                            
                            <div class="timeline-item">
                                <div class="timeline-marker month-3">Month 3-6</div>
                                <div class="timeline-content">
                                    <h4>Recovery Phase</h4>
                                    <p>Reinnervation potentials appear if recovery occurs</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="clinical-implication">
                            <div class="implication-header">
                                <span class="warning-icon">⚠️</span>
                                <h4>Clinical Implication</h4>
                            </div>
                            <p>Normal NCS in first week don't exclude severe nerve injury</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab 8: Advanced Muscle Anatomy Explorer - Senior Level -->
            <section id="tab-8" class="tab-content">
                <div class="senior-level-badge">
                    <span class="badge-icon">🎓</span>
                    <span class="badge-text">SENIOR RESIDENT LEVEL</span>
                </div>
                
                <div class="muscle-lab-hero">
                    <div class="hero-content">
                        <h2 class="hero-title">🧬 Advanced Muscle Laboratory</h2>
                        <p class="hero-subtitle">Preston & Shapiro Complete Muscle Database</p>
                        <div class="hero-stats">
                            <div class="stat-card">
                                <div class="stat-number">45</div>
                                <div class="stat-label">Muscles</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">∞</div>
                                <div class="stat-label">Questions</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">📈</div>
                                <div class="stat-label">Adaptive</div>
                            </div>
                        </div>
                    </div>
                </div>
                

                <!-- Study Controls Bar -->
                <div class="study-controls-bar">
                    <div class="control-section">
                        <h4>Region</h4>
                        <div class="region-selector">
                            <button class="region-btn active" data-region="lower" onclick="MuscleAnatomy.switchAnatomy('lower')">
                                🦵 Lower Extremity
                            </button>
                            <button class="region-btn" data-region="upper" onclick="MuscleAnatomy.switchAnatomy('upper')">
                                💪 Upper Extremity  
                            </button>
                        </div>
                    </div>
                    
                </div>
                
                <!-- Quiz Section -->
                <div class="quiz-section">
                    <div class="quiz-header">
                        <h3>🧪 Interactive Quiz</h3>
                        
                        <!-- Independent Quiz Type Selector -->
                        <div class="quiz-type-selector">
                            <h4>🎯 Select Quiz Types</h4>
                            <p>Choose which anatomical concepts to test (independent of display mode)</p>
                            
                            <div class="quiz-toggle-options">
                                <div class="quiz-toggle-option active" data-quiz-type="nerve" onclick="MuscleAnatomy.toggleQuizType('nerve')">
                                    <div class="toggle-icon">⚡</div>
                                    <div class="toggle-content">
                                        <h5>Peripheral Nerves</h5>
                                        <p>Test nerve supply knowledge</p>
                                    </div>
                                    <div class="toggle-status">
                                        <span class="status-indicator active"></span>
                                        <span class="status-text">Active</span>
                                    </div>
                                </div>
                                
                                <div class="quiz-toggle-option active" data-quiz-type="roots" onclick="MuscleAnatomy.toggleQuizType('roots')">
                                    <div class="toggle-icon">🌿</div>
                                    <div class="toggle-content">
                                        <h5>Nerve Roots</h5>
                                        <p>Test root level knowledge</p>
                                    </div>
                                    <div class="toggle-status">
                                        <span class="status-indicator active"></span>
                                        <span class="status-text">Active</span>
                                    </div>
                                </div>
                                
                                <div class="quiz-toggle-option active" data-quiz-type="cord" onclick="MuscleAnatomy.toggleQuizType('cord')">
                                    <div class="toggle-icon">🔗</div>
                                    <div class="toggle-content">
                                        <h5>Brachial Plexus Cords</h5>
                                        <p>Test cord level knowledge</p>
                                    </div>
                                    <div class="toggle-status">
                                        <span class="status-indicator active"></span>
                                        <span class="status-text">Active</span>
                                    </div>
                                </div>
                                
                                <div class="quiz-toggle-option active" data-quiz-type="trunk" onclick="MuscleAnatomy.toggleQuizType('trunk')">
                                    <div class="toggle-icon">🌳</div>
                                    <div class="toggle-content">
                                        <h5>Brachial Plexus Trunks</h5>
                                        <p>Test trunk level knowledge</p>
                                    </div>
                                    <div class="toggle-status">
                                        <span class="status-indicator active"></span>
                                        <span class="status-text">Active</span>
                                    </div>
                                </div>
                                
                                <div class="quiz-toggle-option active" data-quiz-type="actions" onclick="MuscleAnatomy.toggleQuizType('actions')">
                                    <div class="toggle-icon">💪</div>
                                    <div class="toggle-content">
                                        <h5>Muscle Actions</h5>
                                        <p>Test functional knowledge</p>
                                    </div>
                                    <div class="toggle-status">
                                        <span class="status-indicator active"></span>
                                        <span class="status-text">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p>Test your knowledge with adaptive questions</p>
                    </div>
                    
                    <div class="quiz-controls">
                        <div class="quiz-mode-toggle">
                            <label>Quiz Mode:</label>
                            <button class="mode-toggle-btn active" data-mode="type" onclick="MuscleAnatomy.setQuizMode('type')">
                                Type Answer
                            </button>
                            <button class="mode-toggle-btn" data-mode="multiple" onclick="MuscleAnatomy.setQuizMode('multiple')">
                                Multiple Choice
                            </button>
                        </div>
                        <div class="quiz-action-btns">
                            <button class="quiz-start-btn" onclick="MuscleAnatomy.startInlineQuiz()">
                                Start Quiz
                            </button>
                            <button class="quiz-stop-btn" onclick="MuscleAnatomy.stopInlineQuiz()" style="display: none;">
                                Stop Quiz
                            </button>
                        </div>
                    </div>
                    
                    <div id="inline-quiz-area" class="inline-quiz-area" style="display: none;">
                        <!-- Quiz content will be populated here -->
                    </div>
                </div>

                <!-- Anatomy Display Controls -->
                <div class="anatomy-display-controls">
                    <div class="control-section">
                        <h4>📋 Anatomy Display Controls</h4>
                        <p>Choose what anatomical information to show on the muscle cards below</p>
                        <div class="anatomy-selector">
                            <button class="anatomy-btn active" data-anatomy="nerve" onclick="MuscleAnatomy.setAnatomyType('nerve')">
                                Nerve
                            </button>
                            <button class="anatomy-btn" data-anatomy="roots" onclick="MuscleAnatomy.setAnatomyType('roots')">
                                Roots
                            </button>
                            <button class="anatomy-btn" data-anatomy="cord" onclick="MuscleAnatomy.setAnatomyType('cord')">
                                Cord
                            </button>
                            <button class="anatomy-btn" data-anatomy="trunk" onclick="MuscleAnatomy.setAnatomyType('trunk')">
                                Trunk
                            </button>
                            <button class="anatomy-btn" data-anatomy="actions" onclick="MuscleAnatomy.setAnatomyType('actions')">
                                Actions
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Muscle Display Area -->
                <div id="muscle-anatomy-display" class="muscle-anatomy-display-enhanced">
                    <!-- Muscles will be displayed here -->
                </div>

                <!-- Muscle Test Modal -->
                <div id="muscle-test-modal" class="muscle-test-modal" style="display: none;">
                    <div class="muscle-test-content">
                        <div class="muscle-test-header">
                            <div class="test-title">
                                <h3>🧪 Continuous Muscle Anatomy Quiz</h3>
                                <div class="test-stats">
                                    <span id="questions-answered">Questions: 0</span>
                                    <span id="current-accuracy">Accuracy: 0%</span>
                                </div>
                            </div>
                            <button class="close-test-btn" onclick="MuscleAnatomy.stopMuscleTest()">✕ Stop Quiz</button>
                        </div>
                        
                        <div class="muscle-test-body" id="muscle-test-body">
                            <div class="test-question">
                                <h4 id="question-text">Loading question...</h4>
                                <div id="answer-choices" class="answer-choices">
                                    <!-- Multiple choice options will be populated here -->
                                </div>
                            </div>
                            
                            <div id="answer-feedback" class="answer-feedback" style="display: none;">
                                <div class="feedback-content">
                                    <div id="feedback-result"></div>
                                    <div id="feedback-explanation"></div>
                                </div>
                                <button id="next-question-btn" class="next-question-btn" onclick="MuscleAnatomy.nextQuestion()">Next Question →</button>
                            </div>
                        </div>
                        
                        <div id="test-results" class="test-results" style="display: none;">
                            <h3>🎯 Quiz Statistics</h3>
                            <div class="stats-container">
                                <div class="score-display">
                                    <div class="score-percentage" id="score-percentage">0%</div>
                                    <div class="score-details">
                                        <span id="correct-count">0</span> correct out of <span id="total-answered">0</span>
                                    </div>
                                </div>
                                <div class="missed-questions">
                                    <h4>📝 Review Missed Questions:</h4>
                                    <div id="missed-list"></div>
                                </div>
                                <div class="test-actions">
                                    <button onclick="MuscleAnatomy.startMuscleTest()" class="action-btn primary">Start New Quiz</button>
                                    <button onclick="MuscleAnatomy.reviewMissedQuestions()" id="review-missed-btn" class="action-btn secondary">📝 Review Missed</button>
                                    <button onclick="MuscleAnatomy.stopMuscleTest()" class="action-btn">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tab 9: EMG Localization Challenge - Senior Level -->
            <section id="tab-9" class="tab-content">
                <div class="senior-level-badge">
                    <span class="badge-icon">🎓</span>
                    <span class="badge-text">SENIOR RESIDENT LEVEL</span>
                </div>
                
                <h2 class="section-title">🧠 EMG Localization Challenge</h2>
                <p class="section-description">Sharpen your advanced muscle localization skills with this expert-level quiz system that presents dynamic, contextual questions about EMG findings and complex muscle anatomy patterns. Perfect for senior residents preparing for board examinations and fellowship training.</p>
                
                <!-- Senior Level Warning -->
                <div class="senior-level-warning">
                    <div class="warning-header">
                        <span class="warning-icon">⚠️</span>
                        <h3>Expert-Level Clinical Tool</h3>
                    </div>
                    <p>This advanced challenge is designed for <strong>senior residents and fellows</strong> with substantial EMG experience. Prerequisites include:</p>
                    <ul>
                        <li>✓ Extensive EMG needle examination experience</li>
                        <li>✓ Advanced understanding of denervation patterns</li>
                        <li>✓ Clinical correlation and localization expertise</li>
                        <li>✓ Familiarity with complex anatomical variations</li>
                    </ul>
                    <p><em>This tool simulates real clinical scenarios with complex denervation patterns requiring expert-level interpretation skills.</em></p>
                </div>

                <!-- EMG Challenge Interface -->
                <div class="emg-challenge-container">
                    <!-- Challenge Setup -->
                    <div id="emg-challenge-setup" class="challenge-section">
                        <div class="challenge-card">
                            <div class="challenge-header">
                                <h3>📋 Challenge Configuration</h3>
                                <p>Configure your advanced EMG localization challenge parameters</p>
                            </div>
                            
                            <!-- Question Type Toggles -->
                            <div class="question-type-selector">
                                <h4 class="selector-title">🎯 Select Question Types</h4>
                                <p class="selector-description">Choose which types of localizations you want to practice</p>
                                
                                <div class="toggle-options">
                                    <div class="toggle-option active" data-type="root" onclick="window.EMGChallenge.toggleQuestionType('root')">
                                        <div class="toggle-icon">🌿</div>
                                        <div class="toggle-content">
                                            <h5>Nerve Root Lesions</h5>
                                            <p>C5-T1, L2-S1 radiculopathies</p>
                                            <div class="toggle-examples">Examples: C6 radiculopathy, L5 radiculopathy</div>
                                        </div>
                                        <div class="toggle-status">
                                            <span class="status-indicator active"></span>
                                            <span class="status-text">Active</span>
                                        </div>
                                    </div>
                                    
                                    <div class="toggle-option active" data-type="trunk" onclick="window.EMGChallenge.toggleQuestionType('trunk')">
                                        <div class="toggle-icon">🌳</div>
                                        <div class="toggle-content">
                                            <h5>Plexus Trunk Lesions</h5>
                                            <p>Upper, middle, lower trunk injuries</p>
                                            <div class="toggle-examples">Examples: Erb's palsy, Klumpke's palsy</div>
                                        </div>
                                        <div class="toggle-status">
                                            <span class="status-indicator active"></span>
                                            <span class="status-text">Active</span>
                                        </div>
                                    </div>
                                    
                                    <div class="toggle-option active" data-type="cord" onclick="window.EMGChallenge.toggleQuestionType('cord')">
                                        <div class="toggle-icon">🔗</div>
                                        <div class="toggle-content">
                                            <h5>Plexus Cord Lesions</h5>
                                            <p>Lateral, posterior, medial cord injuries</p>
                                            <div class="toggle-examples">Examples: Lateral cord palsy, posterior cord injury</div>
                                        </div>
                                        <div class="toggle-status">
                                            <span class="status-indicator active"></span>
                                            <span class="status-text">Active</span>
                                        </div>
                                    </div>
                                    
                                    <div class="toggle-option active" data-type="peripheral" onclick="window.EMGChallenge.toggleQuestionType('peripheral')">
                                        <div class="toggle-icon">⚡</div>
                                        <div class="toggle-content">
                                            <h5>Peripheral Nerve Lesions</h5>
                                            <p>Entrapment neuropathies, focal injuries</p>
                                            <div class="toggle-examples">Examples: Carpal tunnel, peroneal palsy</div>
                                        </div>
                                        <div class="toggle-status">
                                            <span class="status-indicator active"></span>
                                            <span class="status-text">Active</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="challenge-launch">
                                <button class="launch-challenge-btn" onclick="window.EMGChallenge.startChallenge()">
                                    <span class="launch-icon">🚀</span>
                                    <span>Launch EMG Challenge</span>
                                </button>
                                <div class="launch-note">At least one question type must be selected</div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Challenge -->  
                    <div id="emg-challenge-active" class="challenge-section" style="display: none;">
                        <div class="challenge-card">
                            <div class="clinical-scenario">
                                <div class="scenario-header">
                                    <h4>💼 Clinical Scenario</h4>
                                </div>
                                <div class="scenario-content" id="challenge-scenario-text">
                                    Loading clinical scenario...
                                </div>
                            </div>
                            
                            <div class="emg-findings">
                                <div class="findings-header">
                                    <h4>⚡ EMG Needle Examination Results</h4>
                                </div>
                                
                                <div class="findings-layout">
                                    <div class="abnormal-findings">
                                        <h5 class="findings-title abnormal">❌ Abnormal Muscles (Denervation)</h5>
                                        <ul id="challenge-abnormal-muscles" class="muscle-findings-list abnormal">
                                            <!-- Abnormal muscles will be populated here -->
                                        </ul>
                                    </div>
                                    
                                    <div class="normal-findings">
                                        <h5 class="findings-title normal">✅ Normal Muscles</h5>
                                        <ul id="challenge-normal-muscles" class="muscle-findings-list normal">
                                            <!-- Normal muscles will be populated here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="challenge-question">
                                <div class="question-header">
                                    <h4>🧠 Analysis Question</h4>
                                </div>
                                <div class="question-text" id="challenge-question-text">
                                    Where is the most likely location of the lesion?
                                </div>
                                
                                <div class="answer-options-challenge" id="challenge-answer-options">
                                    <!-- Answer options will be populated here -->
                                </div>
                            </div>
                            
                            <div class="challenge-controls">
                                <button id="challenge-back-btn" class="challenge-btn secondary" onclick="window.EMGChallenge.backToSettings()">
                                    ← Back to Settings
                                </button>
                                <button id="challenge-submit-btn" class="challenge-btn primary" onclick="window.EMGChallenge.submitAnswer()" disabled>
                                    Submit Analysis
                                </button>
                                <button id="challenge-next-btn" class="challenge-btn primary" onclick="window.EMGChallenge.nextCase()" style="display: none;">
                                    Next Case →
                                </button>
                            </div>
                            
                            <div class="challenge-feedback" id="challenge-feedback" style="display: none;">
                                <!-- Feedback will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>
    </div>
    
    <script>
        function showTab(tabIndex) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab content
            const targetTab = document.getElementById(`tab-${tabIndex}`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // Find and activate the correct button by matching the onclick attribute
            tabButtons.forEach(button => {
                const onclickAttr = button.getAttribute('onclick');
                if (onclickAttr && onclickAttr.includes(`showTab(${tabIndex})`)) {
                    button.classList.add('active');
                }
            });
            
            // Initialize videos when tab 6 is shown
            if (tabIndex === 6) {
                setTimeout(() => {
                    if (typeof initializeVideos === 'function') {
                        initializeVideos();
                    }
                }, 100);
            }
        }
        
        // Global variables for quiz state
        let currentCase = null;
        let currentStep = 1;
        let userDifferential = '';
        let currentDifficultyFilter = 'all';

        // Comprehensive case database
        const caseDatabase = {
            'hand14': {
                title: "Hand Numbness/Tingling (Digits 1-4)",
                presentation: {
                    age: 45,
                    gender: "Female",
                    occupation: "Administrative Assistant",
                    chiefComplaint: "3-month history of numbness and tingling in thumb, index, and middle fingers, worse at night",
                    history: "Symptoms wake her up at night, shaking hands provides relief. Occasional thenar weakness when gripping objects. No neck pain or trauma. Uses computer 8+ hours daily.",
                    pmh: "Hypothyroidism, well-controlled",
                    medications: "Levothyroxine"
                },
                physicalExam: {
                    inspection: "No visible muscle atrophy. No fasciculations observed.",
                    palpation: "Mild tenderness over carpal tunnel. No cervical spine tenderness.",
                    rom: "Full ROM at neck, shoulder, elbow, and wrist bilaterally",
                    strength: "5/5 strength in all muscle groups except mild thenar weakness (4/5) on right",
                    sensation: "Decreased light touch and pinprick in median nerve distribution (digits 1-3)",
                    reflexes: "2+ and symmetric throughout. No pathological reflexes.",
                    specialTests: "Positive Tinel's sign at wrist. Positive Phalen's test. Negative Hoffmann, no clonus, no spasticity"
                },
                expectedDifferential: [
                    "Carpal tunnel syndrome",
                    "Pronator syndrome", 
                    "C6 radiculopathy",
                    "Cervical myelopathy",
                    "Polyneuropathy"
                ],
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Prolonged distal latency: 5.8 ms (normal <4.2 ms). Reduced CMAP amplitude: 3.2 mV (normal >5.0 mV)",
                        interpretation: "Consistent with moderate carpal tunnel syndrome"
                    },
                    {
                        name: "Median Sensory (Wrist-Digit 3)",
                        result: "abnormal", 
                        findings: "Prolonged peak latency: 4.5 ms (normal <3.4 ms). Reduced amplitude: 8 μV (normal >15 μV)",
                        interpretation: "Confirms median sensory involvement at wrist"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal distal latency: 2.8 ms. Normal CMAP amplitude: 12.5 mV",
                        interpretation: "No evidence of ulnar neuropathy"
                    },
                    {
                        name: "Ulnar Sensory (Wrist-Digit 5)",
                        result: "normal",
                        findings: "Normal peak latency: 2.9 ms. Normal amplitude: 25 μV",
                        interpretation: "Ulnar sensory function preserved"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor pollicis brevis (APB)",
                        findings: "Increased insertional activity, few fibrillation potentials, reduced recruitment with large amplitude, long duration motor unit potentials",
                        interpretation: "Chronic denervation with reinnervation - consistent with carpal tunnel syndrome"
                    },
                    {
                        muscle: "First dorsal interosseous",
                        findings: "Normal insertional activity, no abnormal spontaneous activity, full recruitment with normal motor unit potentials",
                        interpretation: "No evidence of ulnar neuropathy or C8 radiculopathy"
                    }
                ],
                requiresEMG: true,
                correctDiagnosis: "Moderate Carpal Tunnel Syndrome",
                explanation: "Classic presentation with night symptoms, thenar weakness, positive provocative tests, and selective median nerve abnormalities on NCS. EMG shows chronic denervation in median-innervated thenar muscles confirming the diagnosis."
            },
            'footdrop': {
                title: "Foot Drop/Dorsiflexor Weakness", 
                presentation: {
                    age: 28,
                    gender: "Male",
                    occupation: "Construction Worker",
                    chiefComplaint: "2-week history of inability to lift right foot, frequent tripping",
                    history: "Gradual onset after prolonged squatting while laying tile. No back pain. No numbness initially, mild numbness over dorsum of foot developed later.",
                    pmh: "None",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "Right foot in plantar flexed position. No muscle atrophy visible yet.",
                    palpation: "No tenderness over fibular head or spine. Fibular head feels normal.",
                    rom: "Limited active dorsiflexion of right foot. Passive ROM normal.",
                    strength: "Right dorsiflexion 1/5, eversion 2/5. Plantar flexion and inversion normal (5/5). Hip and knee strength normal.",
                    sensation: "Decreased sensation over dorsum of right foot in first web space",
                    reflexes: "Achilles reflex present and symmetric. No pathological reflexes.",
                    specialTests: "Negative straight leg raise. No Hoffmann, clonus, or spasticity"
                },
                expectedDifferential: [
                    "Common fibular (peroneal) neuropathy at fibular head",
                    "Deep fibular (peroneal) neuropathy",
                    "L5 radiculopathy", 
                    "Sciatic neuropathy",
                    "Anterior compartment syndrome"
                ],
                ncsStudies: [
                    {
                        name: "Common Fibular Motor (EDB)",
                        result: "abnormal",
                        findings: "No response obtained from extensor digitorum brevis",
                        interpretation: "Complete conduction block or axonal loss in deep fibular nerve"
                    },
                    {
                        name: "Common Fibular Motor (Tibialis Anterior)",
                        result: "abnormal", 
                        findings: "No motor response from tibialis anterior muscle",
                        interpretation: "Confirms deep fibular nerve involvement"
                    },
                    {
                        name: "Superficial Fibular Sensory",
                        result: "abnormal",
                        findings: "No sensory response obtained",
                        interpretation: "Superficial fibular nerve also affected"
                    },
                    {
                        name: "Tibial Motor (AH)",
                        result: "normal",
                        findings: "Normal distal latency and amplitude",
                        interpretation: "Tibial nerve function preserved"
                    },
                    {
                        name: "Sural Sensory", 
                        result: "normal",
                        findings: "Normal amplitude and latency",
                        interpretation: "Rules out generalized polyneuropathy"
                    }
                ],
                correctDiagnosis: "Common Fibular (Peroneal) Neuropathy at the Fibular Head",
                explanation: "Acute onset foot drop with both motor and sensory involvement in common fibular distribution following prolonged squatting (compression at fibular head) is classic for fibular neuropathy."
            },
            'ulnar': {
                title: "Hand Weakness and Numbness",
                presentation: {
                    age: 52,
                    gender: "Male",
                    occupation: "Carpenter",
                    chiefComplaint: "6-month history of weakness in right hand and numbness in ring and little fingers",
                    history: "Gradual onset of difficulty with fine motor tasks. Notices weakness when trying to grip tools. Numbness in ring and little fingers, worse in the morning. Works long hours using hand tools and machinery. No neck pain or trauma.",
                    pmh: "Diabetes mellitus type 2, hypertension",
                    medications: "Metformin, lisinopril"
                },
                physicalExam: {
                    inspection: "Mild atrophy of hypothenar eminence and first dorsal interosseous space on right",
                    palpation: "No tenderness over ulnar groove at elbow. Ulnar nerve mobile at elbow.",
                    rom: "Full ROM at neck, shoulder, elbow, and wrist bilaterally",
                    strength: "Right hand intrinsics 3/5 (FDI, ADM, interossei). Grip strength reduced. FCU 4/5. All other muscle groups 5/5.",
                    sensation: "Decreased light touch and pinprick in ulnar distribution (ring and little finger)",
                    reflexes: "2+ and symmetric throughout. No pathological reflexes.",
                    specialTests: "Positive Froment's sign on right. Negative Tinel's at wrist. Mild Tinel's at elbow. No Hoffmann, clonus, or spasticity"
                },
                expectedDifferential: [
                    "cubital tunnel syndrome",
                    "ulnar neuropathy at elbow",
                    "guyon's canal syndrome",
                    "c8 radiculopathy",
                    "lower trunk brachial plexopathy",
                    "polyneuropathy"
                ],
                ncsStudies: [
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Across elbow conduction velocity: 32 m/s (normal >50 m/s). Distal latency: 3.8 ms (normal <3.3 ms)",
                        interpretation: "Focal slowing across elbow segment consistent with ulnar neuropathy at elbow"
                    },
                    {
                        name: "Ulnar Sensory (Wrist-Digit 5)",
                        result: "abnormal",
                        findings: "Prolonged peak latency: 4.2 ms (normal <3.4 ms). Reduced amplitude: 6 μV (normal >10 μV)",
                        interpretation: "Ulnar sensory involvement"
                    },
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency: 3.1 ms. Normal CMAP amplitude: 8.2 mV",
                        interpretation: "No evidence of median neuropathy"
                    },
                    {
                        name: "Median Sensory (Wrist-Digit 3)",
                        result: "normal",
                        findings: "Normal peak latency: 2.8 ms. Normal amplitude: 22 μV",
                        interpretation: "Median sensory function preserved"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "First dorsal interosseous",
                        findings: "Increased insertional activity, frequent fibrillation potentials and positive sharp waves, reduced recruitment with large amplitude motor unit potentials",
                        interpretation: "Chronic denervation with reinnervation in ulnar-innervated hand muscles"
                    },
                    {
                        muscle: "Flexor carpi ulnaris",
                        findings: "Normal insertional activity, no abnormal spontaneous activity, full recruitment with normal motor unit potentials",
                        interpretation: "Normal - suggests lesion below elbow (spares FCU branch)"
                    }
                ],
                requiresEMG: true,
                correctDiagnosis: "Cubital Tunnel Syndrome (Ulnar Neuropathy at Elbow)",
                explanation: "Progressive hand weakness with ulnar distribution, positive Froment's sign, focal slowing across elbow on NCS, and EMG showing denervation in distal ulnar muscles while sparing FCU confirms ulnar neuropathy at the elbow."
            },
            'cervical': {
                title: "Neck Pain with Arm Weakness",
                presentation: {
                    age: 45,
                    gender: "Female",
                    occupation: "Office Manager",
                    chiefComplaint: "3-month history of neck pain radiating to left arm with weakness and numbness",
                    history: "Gradual onset of neck pain after minor motor vehicle accident. Pain radiates down left arm to thumb and index finger. Weakness noticed when lifting objects overhead. Numbness in thumb, index, and middle finger. Symptoms worse with neck extension.",
                    pmh: "None",
                    medications: "Ibuprofen PRN"
                },
                physicalExam: {
                    inspection: "No visible muscle atrophy. Patient holds head in slightly flexed position.",
                    palpation: "Tenderness over left cervical paraspinal muscles. No palpable lymphadenopathy.",
                    rom: "Limited neck extension due to pain. Left lateral flexion reproduces arm pain.",
                    strength: "Left biceps 4/5, brachioradialis 4/5, deltoid 4-/5. Grip strength mildly reduced on left. Right side normal.",
                    sensation: "Decreased sensation in left C6 dermatome (thumb, index finger, lateral forearm)",
                    reflexes: "Left biceps reflex diminished (1+). Brachioradialis reflex absent on left. Triceps 2+ bilaterally.",
                    specialTests: "Positive Spurling's test on left. Negative Hoffmann bilaterally. No clonus or spasticity"
                },
                expectedDifferential: [
                    "c6 radiculopathy",
                    "cervical radiculopathy",
                    "cervical disc herniation",
                    "brachial plexopathy",
                    "multiple peripheral neuropathies",
                    "cervical myelopathy"
                ],
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency: 3.2 ms. Normal CMAP amplitude: 9.1 mV",
                        interpretation: "Median nerve function normal"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal distal latency: 2.7 ms. Normal CMAP amplitude: 11.8 mV",
                        interpretation: "Ulnar nerve function normal"
                    },
                    {
                        name: "Radial Motor (EIP)",
                        result: "normal",
                        findings: "Normal distal latency: 3.4 ms. Normal CMAP amplitude: 4.2 mV",
                        interpretation: "Radial nerve function normal"
                    },
                    {
                        name: "Median Sensory (Wrist-Digit 1)",
                        result: "abnormal",
                        findings: "Prolonged peak latency: 4.1 ms (normal <3.4 ms). Reduced amplitude: 12 μV (normal >15 μV)",
                        interpretation: "Mild median sensory abnormality - may be secondary to C6 radiculopathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Biceps",
                        findings: "Increased insertional activity, fibrillation potentials and positive sharp waves, reduced recruitment",
                        interpretation: "Active denervation in C6 innervated muscle"
                    },
                    {
                        muscle: "Deltoid",
                        findings: "Increased insertional activity, few fibrillation potentials, reduced recruitment with large amplitude MUPs",
                        interpretation: "Chronic denervation with reinnervation in C6 innervated muscle"
                    },
                    {
                        muscle: "Triceps",
                        findings: "Normal insertional activity, no spontaneous activity, full recruitment with normal MUPs",
                        interpretation: "Normal C7 innervated muscle"
                    }
                ],
                requiresEMG: true,
                correctDiagnosis: "Left C6 Radiculopathy",
                explanation: "Clinical presentation with neck pain, C6 distribution weakness and numbness, diminished reflexes, positive Spurling's test, and EMG showing active denervation in C6 myotome muscles confirms C6 radiculopathy."
            },
            'polyneuropathy': {
                title: "Progressive Weakness and Numbness",
                presentation: {
                    age: 62,
                    gender: "Male",
                    occupation: "Retired Mechanic",
                    chiefComplaint: "1-year history of progressive numbness in feet and hands with weakness",
                    history: "Gradual onset of numbness that started in toes and has progressed up legs. Now involves fingertips bilaterally. Reports difficulty walking due to imbalance. Denies back pain or trauma. Has had diabetes for 15 years with poor glucose control.",
                    pmh: "Diabetes mellitus type 2, hypertension, hyperlipidemia",
                    medications: "Insulin, metformin, lisinopril, atorvastatin"
                },
                physicalExam: {
                    inspection: "No muscle atrophy visible. Steady gait but decreased arm swing.",
                    palpation: "No tenderness. Decreased muscle bulk in distal legs.",
                    rom: "Full ROM throughout",
                    strength: "Distal lower extremity weakness: dorsiflexion 4/5, plantar flexion 4/5. Intrinsic hand muscles 4/5. Proximal strength normal.",
                    sensation: "Stocking-glove pattern sensory loss. Vibration and proprioception markedly reduced in toes and fingers.",
                    reflexes: "Achilles reflexes absent bilaterally. Knee reflexes 1+ bilaterally. Upper extremity reflexes 2+ but symmetric.",
                    specialTests: "Romberg positive. Unable to heel-to-toe walk. No Hoffmann, clonus, or spasticity"
                },
                expectedDifferential: [
                    "diabetic polyneuropathy",
                    "distal sensorimotor polyneuropathy",
                    "peripheral neuropathy",
                    "chronic inflammatory demyelinating polyneuropathy",
                    "vitamin deficiency neuropathy",
                    "toxic neuropathy"
                ],
                ncsStudies: [
                    {
                        name: "Median Sensory (Wrist-Digit 3)",
                        result: "abnormal",
                        findings: "Prolonged peak latency: 4.8 ms (normal <3.4 ms). Markedly reduced amplitude: 4 μV (normal >15 μV)",
                        interpretation: "Severe median sensory neuropathy"
                    },
                    {
                        name: "Ulnar Sensory (Wrist-Digit 5)",
                        result: "abnormal",
                        findings: "Prolonged peak latency: 4.2 ms (normal <3.4 ms). Reduced amplitude: 6 μV (normal >10 μV)",
                        interpretation: "Severe ulnar sensory neuropathy"
                    },
                    {
                        name: "Sural Sensory",
                        result: "abnormal",
                        findings: "No response obtained",
                        interpretation: "Severe sural sensory neuropathy"
                    },
                    {
                        name: "Fibular Motor (EDB)",
                        result: "abnormal",
                        findings: "Prolonged distal latency: 7.2 ms (normal <6.5 ms). Markedly reduced amplitude: 0.8 mV (normal >2.5 mV)",
                        interpretation: "Severe fibular motor neuropathy"
                    }
                ],
                requiresEMG: false,
                correctDiagnosis: "Diabetic Distal Sensorimotor Polyneuropathy",
                explanation: "Length-dependent sensorimotor polyneuropathy with stocking-glove distribution, absent reflexes, and uniform slowing on NCS studies in a patient with long-standing diabetes confirms diabetic polyneuropathy."
            },
            'myopathy': {
                title: "Progressive Proximal Weakness",
                presentation: {
                    age: 38,
                    gender: "Female",
                    occupation: "Teacher",
                    chiefComplaint: "6-month history of difficulty climbing stairs and lifting objects overhead",
                    history: "Gradual onset of weakness affecting shoulders and hips. Difficulty getting up from chairs and climbing stairs. No pain initially, but now has muscle aches. Denies rash or swallowing difficulties. No family history of muscle disease.",
                    pmh: "Hypothyroidism",
                    medications: "Levothyroxine"
                },
                physicalExam: {
                    inspection: "No obvious muscle atrophy. No rash or skin changes observed.",
                    palpation: "Mild tenderness in proximal muscle groups. No fasciculations palpated.",
                    rom: "Full passive ROM. Limited active ROM due to weakness.",
                    strength: "Proximal weakness: deltoids 3/5, hip flexors 3/5, neck flexors 4/5. Distal strength preserved (5/5).",
                    sensation: "Normal throughout",
                    reflexes: "2+ and symmetric throughout. No pathological reflexes.",
                    specialTests: "Gowers' sign present. No Hoffmann, clonus, or spasticity"
                },
                expectedDifferential: [
                    "inflammatory myopathy",
                    "polymyositis",
                    "dermatomyositis",
                    "inclusion body myositis",
                    "thyroid myopathy",
                    "muscular dystrophy",
                    "metabolic myopathy"
                ],
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency: 3.0 ms. Normal CMAP amplitude: 8.5 mV",
                        interpretation: "Normal median nerve function"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal distal latency: 2.8 ms. Normal CMAP amplitude: 10.2 mV",
                        interpretation: "Normal ulnar nerve function"
                    },
                    {
                        name: "Fibular Motor (EDB)",
                        result: "normal",
                        findings: "Normal distal latency: 4.2 ms. Normal CMAP amplitude: 3.8 mV",
                        interpretation: "Normal fibular nerve function"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Deltoid",
                        findings: "Increased insertional activity, frequent fibrillation potentials, positive sharp waves, and complex repetitive discharges. Early recruitment with small, short-duration, polyphasic motor unit potentials",
                        interpretation: "Myopathic changes with membrane instability"
                    },
                    {
                        muscle: "Biceps",
                        findings: "Increased insertional activity, fibrillation potentials, early recruitment with small amplitude, short duration MUPs",
                        interpretation: "Myopathic changes consistent with inflammatory myopathy"
                    },
                    {
                        muscle: "Iliopsoas",
                        findings: "Increased insertional activity, abnormal spontaneous activity, early recruitment with myopathic MUPs",
                        interpretation: "Proximal myopathic involvement"
                    }
                ],
                requiresEMG: true,
                correctDiagnosis: "Inflammatory Myopathy (likely Polymyositis)",
                explanation: "Proximal muscle weakness, elevated CK (implied), normal NCS with myopathic EMG changes showing membrane instability and small, short-duration motor units in proximal muscles supports inflammatory myopathy."
            },
            'als': {
                title: "Progressive Weakness and Muscle Twitching",
                presentation: {
                    age: 58,
                    gender: "Male",
                    occupation: "Engineer",
                    chiefComplaint: "8-month history of progressive weakness in right hand and visible muscle twitching",
                    history: "Started with weakness in right hand, difficulty with fine motor tasks like writing and buttoning shirts. Recently developed weakness in left hand and noticed muscle twitching in arms. Some difficulty with speech articulation. Denies sensory symptoms or bowel/bladder dysfunction.",
                    pmh: "Hypertension",
                    medications: "Amlodipine"
                },
                physicalExam: {
                    inspection: "Visible fasciculations in bilateral thenar and hypothenar eminences, deltoids, and tongue. Mild atrophy of right first dorsal interosseous.",
                    palpation: "Fasciculations palpable in multiple muscle groups. No tenderness.",
                    rom: "Full ROM throughout",
                    strength: "Right hand intrinsics 3/5, left hand intrinsics 4/5. Grip strength reduced bilaterally. Proximal strength mildly reduced in arms.",
                    sensation: "Normal throughout",
                    reflexes: "Hyperreflexic throughout (3+). Positive Hoffmann sign bilaterally. Jaw jerk present.",
                    specialTests: "Positive Babinski bilaterally. Tongue fasciculations visible. Mild dysarthria. No clonus."
                },
                expectedDifferential: [
                    "amyotrophic lateral sclerosis",
                    "motor neuron disease",
                    "progressive muscular atrophy",
                    "primary lateral sclerosis",
                    "kennedy disease",
                    "multifocal motor neuropathy",
                    "cervical myelopathy"
                ],
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Normal distal latency: 3.4 ms. Reduced CMAP amplitude: 2.1 mV (normal >4.0 mV)",
                        interpretation: "Reduced amplitude suggesting motor axon loss"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Normal distal latency: 3.1 ms. Reduced CMAP amplitude: 3.2 mV (normal >6.0 mV)",
                        interpretation: "Reduced amplitude consistent with motor neuron loss"
                    },
                    {
                        name: "Median Sensory (Wrist-Digit 3)",
                        result: "normal",
                        findings: "Normal peak latency: 2.9 ms. Normal amplitude: 18 μV",
                        interpretation: "Normal sensory function preserved"
                    },
                    {
                        name: "Ulnar Sensory (Wrist-Digit 5)",
                        result: "normal",
                        findings: "Normal peak latency: 3.0 ms. Normal amplitude: 15 μV",
                        interpretation: "Normal sensory function preserved"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "First dorsal interosseous",
                        findings: "Increased insertional activity, frequent fasciculation potentials, fibrillation potentials and positive sharp waves. Reduced recruitment with large amplitude, long duration motor unit potentials",
                        interpretation: "Chronic denervation with reinnervation and ongoing fasciculations"
                    },
                    {
                        muscle: "Deltoid",
                        findings: "Fasciculation potentials, reduced recruitment with giant motor unit potentials",
                        interpretation: "Chronic reinnervation with ongoing denervation"
                    },
                    {
                        muscle: "Tongue",
                        findings: "Frequent fasciculation potentials, fibrillation potentials, reduced recruitment",
                        interpretation: "Bulbar involvement with lower motor neuron signs"
                    }
                ],
                requiresEMG: true,
                correctDiagnosis: "Amyotrophic Lateral Sclerosis (ALS)",
                explanation: "Progressive weakness with both upper motor neuron signs (hyperreflexia, Babinski) and lower motor neuron signs (fasciculations, atrophy), preserved sensation, and EMG showing widespread denervation with fasciculations confirms ALS."
            },
            'stroke': {
                title: "Acute Hemiparesis",
                presentation: {
                    age: 68,
                    gender: "Male", 
                    occupation: "Retired",
                    chiefComplaint: "Acute onset left-sided weakness and facial droop this morning",
                    history: "Patient was found by wife at 7 AM with left-sided weakness and facial droop. She reports he was normal when she went to bed at 11 PM. Patient has slurred speech but is alert and oriented. Denies headache, neck pain, or back pain. No recent trauma or illness.",
                    pmh: "Hypertension, diabetes, atrial fibrillation",
                    medications: "Lisinopril, metformin, warfarin"
                },
                physicalExam: {
                    inspection: "Left facial droop, left arm held in flexed posture",
                    palpation: "Not applicable for acute stroke evaluation", 
                    rom: "Reduced active ROM on left side due to weakness",
                    strength: "Left arm 2/5, left leg 3/5. Right side normal (5/5). Upper motor neuron pattern of weakness.",
                    sensation: "Diminished sensation on entire left side",
                    reflexes: "Hyperreflexic on left (3+). Right side normal (2+).",
                    specialTests: "Positive Babinski sign on left. Hoffman sign positive on left. Spasticity present in left arm."
                },
                expectedDifferential: [
                    "Acute cerebrovascular accident (stroke)",
                    "Brain tumor with mass effect",
                    "Intracranial hemorrhage",
                    "Todd's paralysis (post-ictal)",
                    "Complicated migraine"
                ],
                emgIndication: "NOT INDICATED",
                explanation: "This is an upper motor neuron lesion (stroke). EMG/NCS evaluate the peripheral nervous system and would be normal in isolated stroke. Clinical presentation with hyperreflexia, Babinski sign, and spasticity confirms central cause.",
                correctDiagnosis: "Acute Cerebrovascular Accident (Stroke) - EMG NOT INDICATED",
                educationalNote: "EMG/NCS studies are used to evaluate the peripheral nervous system (nerve roots, plexuses, peripheral nerves, neuromuscular junction, and muscle). In pure upper motor neuron lesions like stroke, EMG would be normal and is not clinically indicated."
            },
            'combined': {
                title: "Bilateral Hand Numbness and Weakness",
                presentation: {
                    age: 52,
                    gender: "Female",
                    occupation: "Assembly Line Worker",
                    chiefComplaint: "6-month history of bilateral hand numbness, tingling, and weakness affecting multiple fingers",
                    history: "Started with classic carpal tunnel symptoms (thumb/index/middle finger numbness, worse at night). Over past 2 months, developed ring/little finger numbness and weakness pinching with thumb-index finger. Works on assembly line with repetitive elbow flexion and wrist extension. Symptoms now affect both median and ulnar distributions bilaterally.",
                    pmh: "Osteoarthritis, obesity",
                    medications: "Ibuprofen PRN"
                },
                physicalExam: {
                    inspection: "Mild thenar and hypothenar atrophy bilaterally",
                    palpation: "Tender over bilateral carpal tunnels and cubital tunnels",
                    rom: "Full ROM at all joints",
                    strength: "Thenar weakness (4/5) and interosseous weakness (4/5) bilaterally",
                    sensation: "Decreased sensation in median (digits 1-3) and ulnar (digits 4-5) distributions bilaterally",
                    reflexes: "2+ and symmetric throughout",
                    specialTests: "Positive Tinel's and Phalen's signs at wrists bilaterally. Positive elbow flexion test bilaterally."
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Prolonged distal latencies (5.2ms right, 4.8ms left), reduced amplitudes",
                        interpretation: "Moderate carpal tunnel syndrome bilaterally"
                    },
                    {
                        name: "Median Sensory (digit 2)",
                        result: "abnormal", 
                        findings: "Prolonged peak latencies (4.1ms right, 3.9ms left), reduced amplitudes",
                        interpretation: "Sensory carpal tunnel syndrome"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Conduction velocity slowing across elbow (42 m/s right, 45 m/s left)",
                        interpretation: "Mild cubital tunnel syndrome bilaterally"
                    },
                    {
                        name: "Ulnar Sensory (digit 5)",
                        result: "abnormal",
                        findings: "Reduced amplitudes, normal latencies",
                        interpretation: "Mild sensory involvement at elbow"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor pollicis brevis",
                        findings: "Chronic denervation with reinnervation changes",
                        interpretation: "Chronic median neuropathy"
                    },
                    {
                        muscle: "First dorsal interosseous", 
                        findings: "Mild denervation changes",
                        interpretation: "Ulnar neuropathy"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                correctDiagnosis: "Combined Carpal Tunnel Syndrome and Cubital Tunnel Syndrome (bilateral)",
                explanation: "This case demonstrates the classic 'double crush' phenomenon where a worker with repetitive motions develops entrapments at multiple sites. Both median (carpal tunnel) and ulnar (cubital tunnel) neuropathies can coexist, especially in occupational settings."
            },
            'c5radiculopathy': {
                title: "Shoulder Pain and Arm Weakness",
                presentation: {
                    age: 41,
                    gender: "Male",
                    occupation: "Construction Worker",
                    chiefComplaint: "3-week history of severe neck pain radiating to right shoulder and arm with weakness",
                    history: "Lifting heavy materials 3 weeks ago, felt immediate sharp neck pain. Pain radiates from neck to right shoulder, lateral arm, and thumb. Weakness lifting arm overhead and external rotation. Coughing and sneezing worsen pain. No numbness in hand.",
                    pmh: "Previous back injury 10 years ago",
                    medications: "Ibuprofen, muscle relaxants"
                },
                physicalExam: {
                    inspection: "Holding right arm in adducted position",
                    palpation: "Cervical paraspinal muscle spasm, tender over C4-C5 region",
                    rom: "Limited cervical extension and right lateral flexion",
                    strength: "Deltoid 3/5, biceps 4/5, supraspinatus 3/5 on right. Left side normal.",
                    sensation: "Decreased sensation over lateral shoulder (C5 dermatome)",
                    reflexes: "Biceps reflex diminished (1+) on right. Triceps and brachioradialis normal.",
                    specialTests: "Positive Spurling's test on right"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency, amplitude, and conduction velocity",
                        interpretation: "No median neuropathy"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal parameters throughout",
                        interpretation: "No ulnar neuropathy"
                    },
                    {
                        name: "Radial Motor (EIP)",
                        result: "normal",
                        findings: "Normal distal latency and amplitude",
                        interpretation: "No radial neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Cervical paraspinals (C4-C5)",
                        findings: "Positive sharp waves and fibrillations",
                        interpretation: "Acute denervation"
                    },
                    {
                        muscle: "Deltoid",
                        findings: "Positive sharp waves, reduced recruitment",
                        interpretation: "C5 root involvement"
                    },
                    {
                        muscle: "Biceps",
                        findings: "Mild denervation changes",
                        interpretation: "C5-C6 involvement"
                    },
                    {
                        muscle: "Supraspinatus",
                        findings: "Active denervation",
                        interpretation: "C5 root lesion"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                correctDiagnosis: "Right C5 Radiculopathy",
                explanation: "Classic C5 radiculopathy presentation with shoulder/deltoid weakness, diminished biceps reflex, and lateral shoulder sensory loss. Normal peripheral NCS with denervation in C5 myotomes and cervical paraspinals confirms root level pathology."
            },
            'l5radiculopathy': {
                title: "Lower Back Pain with Leg Weakness",
                presentation: {
                    age: 38,
                    gender: "Female", 
                    occupation: "Nurse",
                    chiefComplaint: "6-week history of lower back pain radiating down right leg with foot weakness",
                    history: "Gradual onset lower back pain after lifting patient. Pain radiates from low back down posterior/lateral right leg to dorsum of foot. Weakness dorsiflexing foot, difficulty walking on heels. Numbness between great and second toe. Pain worse with sitting, better with walking.",
                    pmh: "Previous episode of low back pain 5 years ago, resolved",
                    medications: "Naproxen, gabapentin"
                },
                physicalExam: {
                    inspection: "Slightly antalgic gait favoring right leg",
                    palpation: "Lumbar paraspinal muscle spasm, tender over L4-L5 region",
                    rom: "Limited lumbar flexion and extension",
                    strength: "Extensor hallucis longus 3/5, tibialis anterior 4/5 on right. Other muscles normal.",
                    sensation: "Decreased sensation in L5 dermatome (lateral leg, dorsum of foot, web space between toes 1-2)",
                    reflexes: "Achilles and patellar reflexes symmetric and normal",
                    specialTests: "Positive straight leg raise at 45 degrees on right"
                },
                ncsStudies: [
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal",
                        findings: "Reduced amplitude (2.1 mV, normal >2.5 mV)",
                        interpretation: "Mild axonal loss affecting deep peroneal nerve"
                    },
                    {
                        name: "Tibial Motor (AH)",
                        result: "normal",
                        findings: "Normal amplitude and conduction velocity",
                        interpretation: "No tibial nerve involvement"
                    },
                    {
                        name: "Superficial Peroneal Sensory",
                        result: "abnormal",
                        findings: "Reduced amplitude on right compared to left",
                        interpretation: "Sensory involvement"
                    },
                    {
                        name: "Sural Sensory",
                        result: "normal",
                        findings: "Normal amplitude and velocity bilaterally",
                        interpretation: "S1 distribution spared"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Lumbar paraspinals (L4-L5)",
                        findings: "Positive sharp waves and fibrillations",
                        interpretation: "Acute denervation"
                    },
                    {
                        muscle: "Tibialis anterior",
                        findings: "Positive sharp waves, reduced recruitment",
                        interpretation: "L4-L5 root involvement"
                    },
                    {
                        muscle: "Extensor hallucis longus",
                        findings: "Active denervation, severely reduced recruitment",
                        interpretation: "L5 root lesion"
                    },
                    {
                        muscle: "Gluteus medius",
                        findings: "Mild denervation changes",
                        interpretation: "Superior gluteal nerve (L5 root)"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Right L5 Radiculopathy",
                explanation: "L5 radiculopathy with classic dorsiflexor weakness, sensory loss in L5 distribution, and EMG showing denervation in L5 myotomes with sparing of S1 muscles. Reduced peroneal motor amplitude reflects axonal loss from chronic root compression."
            },
            'c7radiculopathy': {
                title: "Arm Pain with Hand Weakness",
                presentation: {
                    age: 46,
                    gender: "Male",
                    occupation: "Office Manager",
                    chiefComplaint: "4-week history of neck pain radiating down arm with hand and wrist weakness",
                    history: "Gradual onset neck pain radiating down posterior arm to middle finger. Weakness extending wrist and fingers. Difficulty opening jars and gripping objects. Pain worse with neck extension. No trauma. Desk job with poor ergonomics.",
                    pmh: "Cervical disc disease on MRI 2 years ago",
                    medications: "Tramadol, prednisone taper"
                },
                physicalExam: {
                    inspection: "No visible atrophy",
                    palpation: "Cervical paraspinal tenderness at C6-C7 level",
                    rom: "Limited cervical extension",
                    strength: "Triceps 4/5, wrist extensors 3/5, finger extensors 4/5 on right",
                    sensation: "Decreased sensation in middle finger (C7 dermatome)",
                    reflexes: "Triceps reflex diminished (1+) on right. Biceps and brachioradialis normal.",
                    specialTests: "Positive Spurling's test, negative Tinel's at wrist/elbow"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency and amplitude",
                        interpretation: "No carpal tunnel syndrome"
                    },
                    {
                        name: "Radial Motor (EIP)",
                        result: "abnormal",
                        findings: "Reduced amplitude (3.2 mV, normal >4.0 mV)",
                        interpretation: "Mild axonal loss in posterior interosseous nerve"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal parameters",
                        interpretation: "No ulnar neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Cervical paraspinals (C6-C7)",
                        findings: "Positive sharp waves and fibrillations",
                        interpretation: "Acute denervation"
                    },
                    {
                        muscle: "Triceps",
                        findings: "Positive sharp waves, reduced recruitment",
                        interpretation: "C7 root involvement"
                    },
                    {
                        muscle: "Extensor carpi radialis",
                        findings: "Active denervation changes",
                        interpretation: "C7 root lesion"
                    },
                    {
                        muscle: "Extensor digitorum communis",
                        findings: "Denervation with reduced recruitment",
                        interpretation: "Posterior interosseous nerve (C7 root)"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Right C7 Radiculopathy",
                explanation: "C7 radiculopathy with classic triceps weakness, diminished triceps reflex, and middle finger sensory loss. EMG shows denervation in C7 myotomes including triceps and wrist/finger extensors, with sparing of C5, C6, C8, and T1 muscles."
            },
            'plexopathy': {
                title: "Arm Weakness After Motorcycle Accident",
                presentation: {
                    age: 28,
                    gender: "Male",
                    occupation: "Motorcycle Mechanic",
                    chiefComplaint: "3-month history of right arm weakness and numbness following motorcycle accident",
                    history: "High-speed motorcycle accident 3 months ago with right shoulder trauma. Initially had complete right arm paralysis. Some recovery occurred but persistent weakness and numbness remain. Weakness affects entire arm from shoulder down. Numbness along medial arm and forearm.",
                    pmh: "No significant past medical history",
                    medications: "Gabapentin, physical therapy"
                },
                physicalExam: {
                    inspection: "Winged scapula on right, mild atrophy of hand intrinsics",
                    palpation: "Supraclavicular tenderness, no brachial plexus mass",
                    rom: "Limited shoulder abduction and flexion",
                    strength: "Deltoid 2/5, biceps 3/5, triceps 3/5, hand intrinsics 2/5 on right",
                    sensation: "Decreased sensation along medial arm and forearm (C8-T1 distribution)",
                    reflexes: "Absent biceps and triceps reflexes on right",
                    specialTests: "Positive Tinel's sign over brachial plexus"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Severely reduced amplitude (0.8 mV), prolonged latency",
                        interpretation: "Severe median nerve dysfunction"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Severely reduced amplitude (1.2 mV)",
                        interpretation: "Severe ulnar nerve dysfunction"
                    },
                    {
                        name: "Radial Motor (EIP)",
                        result: "abnormal",
                        findings: "Reduced amplitude (2.1 mV)",
                        interpretation: "Moderate radial nerve dysfunction"
                    },
                    {
                        name: "Medial Antebrachial Cutaneous",
                        result: "abnormal",
                        findings: "Absent sensory response",
                        interpretation: "Medial cord/lower trunk involvement"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Cervical paraspinals",
                        findings: "Normal",
                        interpretation: "Root level spared"
                    },
                    {
                        muscle: "Serratus anterior",
                        findings: "Denervation changes",
                        interpretation: "Long thoracic nerve involvement"
                    },
                    {
                        muscle: "Hand intrinsics",
                        findings: "Severe denervation with poor reinnervation",
                        interpretation: "Lower trunk/medial cord lesion"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "Right Brachial Plexopathy (Lower Trunk/Medial Cord Pattern)",
                explanation: "Post-traumatic brachial plexopathy affecting primarily the lower trunk/medial cord, causing weakness in C8-T1 distribution with sparing of cervical paraspinals (distinguishing from root avulsion). Pattern of multiple nerve involvement localizes to plexus level."
            },
            's1radiculopathy': {
                title: "Lower Back Pain with Calf Weakness",
                presentation: {
                    age: 44,
                    gender: "Male",
                    occupation: "Warehouse Worker", 
                    chiefComplaint: "2-month history of lower back pain radiating down leg with calf weakness",
                    history: "Gradual onset lower back pain after lifting boxes. Pain radiates from low back down posterior leg to lateral foot. Difficulty walking on tiptoes and going up stairs. Numbness in lateral foot and little toe. Pain worse with prolonged standing.",
                    pmh: "Previous lumbar strain 3 years ago",
                    medications: "Ibuprofen, cyclobenzaprine"
                },
                physicalExam: {
                    inspection: "Slightly antalgic gait, difficulty with toe walking",
                    palpation: "Lumbar paraspinal muscle spasm, tender over L5-S1 region",
                    rom: "Limited lumbar flexion",
                    strength: "Plantarflexors 4/5, gastrocnemius 3/5 on right. EHL and tibialis anterior normal.",
                    sensation: "Decreased sensation in S1 dermatome (lateral foot, little toe)",
                    reflexes: "Achilles reflex absent on right (0+). Patellar normal.",
                    specialTests: "Positive straight leg raise at 50 degrees on right"
                },
                ncsStudies: [
                    {
                        name: "Tibial Motor (AH)",
                        result: "abnormal",
                        findings: "Reduced amplitude (8.2 mV, normal >10 mV)",
                        interpretation: "Mild axonal loss affecting tibial nerve"
                    },
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "normal",
                        findings: "Normal amplitude and conduction velocity",
                        interpretation: "L5 distribution spared"
                    },
                    {
                        name: "Sural Sensory",
                        result: "abnormal",
                        findings: "Reduced amplitude on right compared to left",
                        interpretation: "S1 sensory involvement"
                    },
                    {
                        name: "H-reflex",
                        result: "abnormal",
                        findings: "Absent H-reflex on right, normal on left",
                        interpretation: "S1 root dysfunction"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Lumbar paraspinals (L5-S1)",
                        findings: "Positive sharp waves and fibrillations",
                        interpretation: "Acute denervation"
                    },
                    {
                        muscle: "Gastrocnemius medial head",
                        findings: "Positive sharp waves, reduced recruitment",
                        interpretation: "S1 root involvement"
                    },
                    {
                        muscle: "Gluteus maximus",
                        findings: "Denervation changes",
                        interpretation: "Inferior gluteal nerve (S1 root)"
                    },
                    {
                        muscle: "Tibialis anterior",
                        findings: "Normal",
                        interpretation: "L5 distribution spared"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Right S1 Radiculopathy",
                explanation: "S1 radiculopathy with classic plantarflexor weakness, absent Achilles reflex, and lateral foot sensory loss. H-reflex absence is a sensitive early finding in S1 radiculopathy. EMG shows denervation in S1 myotomes with sparing of L5 muscles."
            },
            'radialneuropathy': {
                title: "Wrist Drop After Saturday Night",
                presentation: {
                    age: 35,
                    gender: "Male",
                    occupation: "Software Developer",
                    chiefComplaint: "Acute onset inability to extend wrist and fingers after falling asleep with arm over chair",
                    history: "Woke up yesterday morning unable to extend right wrist or fingers. Had been drinking the night before and fell asleep in chair with right arm draped over the back (Saturday night palsy). No pain, just weakness. Can still flex fingers and wrist normally.",
                    pmh: "No significant medical history",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "Right wrist drop, inability to extend fingers at MCP joints",
                    palpation: "No tenderness over spiral groove or elbow",
                    rom: "Full passive ROM, limited active extension",
                    strength: "Wrist extensors 0/5, finger extensors 0/5, triceps 5/5, brachioradialis 5/5",
                    sensation: "Decreased sensation in first web space (superficial radial distribution)",
                    reflexes: "Triceps reflex normal. Brachioradialis present but weak due to positioning.",
                    specialTests: "Negative Tinel's at elbow, positive wrist drop sign"
                },
                ncsStudies: [
                    {
                        name: "Radial Motor (EIP)",
                        result: "abnormal",
                        findings: "No response elicitable from posterior interosseous nerve",
                        interpretation: "Complete conduction block in radial nerve"
                    },
                    {
                        name: "Radial Motor (BR)",
                        result: "normal",
                        findings: "Normal amplitude and latency to brachioradialis",
                        interpretation: "Lesion distal to brachioradialis branch"
                    },
                    {
                        name: "Superficial Radial Sensory",
                        result: "abnormal",
                        findings: "Absent sensory response",
                        interpretation: "Superficial radial nerve involvement"
                    },
                    {
                        name: "Median/Ulnar studies",
                        result: "normal",
                        findings: "All parameters normal",
                        interpretation: "Other nerves unaffected"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Extensor carpi radialis longus",
                        findings: "Normal (innervated above spiral groove)",
                        interpretation: "Lesion at spiral groove level"
                    },
                    {
                        muscle: "Extensor carpi radialis brevis",
                        findings: "No voluntary activity",
                        interpretation: "Posterior interosseous nerve involvement"
                    },
                    {
                        muscle: "Extensor digitorum communis",
                        findings: "No voluntary activity",
                        interpretation: "Complete posterior interosseous nerve palsy"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "beginner",
                correctDiagnosis: "Radial Neuropathy at Spiral Groove (Saturday Night Palsy)",
                explanation: "Classic compression of radial nerve at spiral groove from prolonged pressure. Spares triceps and ECRL (innervated proximal to compression) but affects posterior interosseous nerve causing wrist and finger extensor weakness with sensory loss in superficial radial distribution."
            },
            'peronealpalsy': {
                title: "Foot Drop After Knee Surgery",
                presentation: {
                    age: 29,
                    gender: "Female",
                    occupation: "Teacher",
                    chiefComplaint: "Inability to lift foot up and numbness on top of foot since knee arthroscopy 2 weeks ago",
                    history: "Underwent knee arthroscopy 2 weeks ago for meniscal tear. Woke up from surgery with foot drop and numbness over dorsum of foot. Initially attributed to positioning during surgery. No improvement since discharge. Trips frequently due to toe catching.",
                    pmh: "Right meniscal tear",
                    medications: "Ibuprofen, physical therapy"
                },
                physicalExam: {
                    inspection: "Right foot drop, steppage gait pattern",
                    palpation: "Tenderness over fibular head, no calf tenderness",
                    rom: "Full passive dorsiflexion, limited active dorsiflexion",
                    strength: "Tibialis anterior 1/5, EHL 2/5, eversion 2/5. Plantarflexion and inversion normal.",
                    sensation: "Decreased sensation over dorsum of foot and lateral leg",
                    reflexes: "Achilles reflex normal. No patellar reflex abnormality.",
                    specialTests: "Positive Tinel's sign over fibular head"
                },
                ncsStudies: [
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal",
                        findings: "Prolonged distal latency (7.2ms), reduced amplitude (0.8 mV)",
                        interpretation: "Severe peroneal neuropathy at fibular head"
                    },
                    {
                        name: "Peroneal Motor (TA)",
                        result: "abnormal",
                        findings: "No response elicitable",
                        interpretation: "Complete conduction block to deep peroneal nerve"
                    },
                    {
                        name: "Superficial Peroneal Sensory",
                        result: "abnormal",
                        findings: "Absent sensory response",
                        interpretation: "Superficial peroneal nerve involvement"
                    },
                    {
                        name: "Tibial Motor (AH)",
                        result: "normal",
                        findings: "Normal amplitude and conduction velocity",
                        interpretation: "Tibial nerve spared"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Tibialis anterior",
                        findings: "No voluntary activity, denervation changes",
                        interpretation: "Complete deep peroneal nerve palsy"
                    },
                    {
                        muscle: "Extensor digitorum longus",
                        findings: "No voluntary activity",
                        interpretation: "Deep peroneal nerve involvement"
                    },
                    {
                        muscle: "Peroneus longus",
                        findings: "Denervation changes",
                        interpretation: "Superficial peroneal nerve involvement"
                    },
                    {
                        muscle: "Tibialis posterior",
                        findings: "Normal",
                        interpretation: "Tibial nerve spared"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "beginner",
                correctDiagnosis: "Common Peroneal Neuropathy at Fibular Head (Post-surgical)",
                explanation: "Iatrogenic peroneal nerve injury at fibular head from surgical positioning or compression. Complete palsy affecting both deep (dorsiflexion) and superficial (eversion) peroneal nerves with sparing of tibial nerve function."
            },
            'mg': {
                title: "Fatigable Weakness and Ptosis",
                presentation: {
                    age: 31,
                    gender: "Female",
                    occupation: "Graphic Designer",
                    chiefComplaint: "3-month history of fatigue, droopy eyelids, and weakness that worsens throughout the day",
                    history: "Gradual onset of fatigue and weakness that gets worse with activity and improves with rest. Noticed droopy eyelids, especially in evening. Difficulty chewing food by end of meals. Voice becomes nasal after talking for extended periods. Shortness of breath with minimal exertion.",
                    pmh: "Thyroid disease (Hashimoto's thyroiditis)",
                    medications: "Levothyroxine"
                },
                physicalExam: {
                    inspection: "Bilateral ptosis, worse on left. Facial weakness.",
                    palpation: "No muscle tenderness or atrophy",
                    rom: "Full ROM at all joints",
                    strength: "Proximal weakness (4/5) that worsens with repetitive testing. Normal strength initially.",
                    sensation: "Normal throughout",
                    reflexes: "Normal (2+) throughout",
                    specialTests: "Positive ice pack test (ptosis improves), positive edrophonium test"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency and amplitude",
                        interpretation: "No peripheral neuropathy"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal parameters",
                        interpretation: "No nerve involvement"
                    },
                    {
                        name: "Repetitive Nerve Stimulation (3Hz)",
                        result: "abnormal",
                        findings: "15% decrement in amplitude with slow repetitive stimulation",
                        interpretation: "Neuromuscular junction dysfunction"
                    },
                    {
                        name: "Single Fiber EMG",
                        result: "abnormal",
                        findings: "Increased jitter and blocking in multiple muscles",
                        interpretation: "Neuromuscular transmission defect"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Deltoid",
                        findings: "Normal motor unit morphology, normal recruitment",
                        interpretation: "No myopathy"
                    },
                    {
                        muscle: "Biceps",
                        findings: "Normal spontaneous activity and motor units",
                        interpretation: "No denervation"
                    },
                    {
                        muscle: "Orbicularis oculi",
                        findings: "Increased jitter on single fiber EMG",
                        interpretation: "Facial muscle involvement"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "Myasthenia Gravis (Generalized)",
                explanation: "Classic presentation of myasthenia gravis with fatigable weakness, ptosis, and bulbar symptoms. Repetitive nerve stimulation shows decremental response characteristic of postsynaptic neuromuscular junction disorder. Single fiber EMG confirms transmission defect."
            },
            'tarsal': {
                title: "Foot Pain and Numbness",
                presentation: {
                    age: 42,
                    gender: "Female",
                    occupation: "Nurse",
                    chiefComplaint: "6-month history of burning foot pain and numbness, worse at night",
                    history: "Gradual onset burning pain and numbness on bottom of foot, radiating to toes. Pain worse at night and when wearing shoes. Standing for long periods at work exacerbates symptoms. Some relief with rest and elevation. No back pain or leg symptoms.",
                    pmh: "Diabetes mellitus type 2, well-controlled",
                    medications: "Metformin, gabapentin"
                },
                physicalExam: {
                    inspection: "No visible deformity or swelling",
                    palpation: "Tenderness over tarsal tunnel, positive Tinel's sign",
                    rom: "Full ankle ROM",
                    strength: "Intrinsic foot muscles weak (4/5), other muscles normal",
                    sensation: "Decreased sensation on plantar surface of foot",
                    reflexes: "Achilles reflex normal bilaterally",
                    specialTests: "Positive Tinel's sign over tarsal tunnel, negative straight leg raise"
                },
                ncsStudies: [
                    {
                        name: "Tibial Motor (AH)",
                        result: "normal",
                        findings: "Normal amplitude and conduction velocity to proximal muscles",
                        interpretation: "Proximal tibial nerve normal"
                    },
                    {
                        name: "Medial Plantar Sensory",
                        result: "abnormal",
                        findings: "Prolonged peak latency (4.8ms), reduced amplitude",
                        interpretation: "Medial plantar nerve compression"
                    },
                    {
                        name: "Lateral Plantar Sensory",
                        result: "abnormal",
                        findings: "Reduced amplitude compared to contralateral side",
                        interpretation: "Lateral plantar nerve involvement"
                    },
                    {
                        name: "Sural Sensory",
                        result: "normal",
                        findings: "Normal amplitude and velocity",
                        interpretation: "Sural nerve spared"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor hallucis",
                        findings: "Denervation changes with reduced recruitment",
                        interpretation: "Medial plantar nerve involvement"
                    },
                    {
                        muscle: "Flexor digitorum brevis",
                        findings: "Mild denervation changes",
                        interpretation: "Lateral plantar nerve involvement"
                    },
                    {
                        muscle: "Tibialis posterior",
                        findings: "Normal",
                        interpretation: "Proximal tibial nerve spared"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Tarsal Tunnel Syndrome (Tibial Neuropathy at Ankle)",
                explanation: "Compression of tibial nerve and its branches (medial and lateral plantar nerves) at the tarsal tunnel. Prolonged standing and diabetes are risk factors. Studies show distal tibial nerve involvement with sparing of proximal branches."
            },
            'mildcts': {
                title: "Early Hand Tingling in Pregnancy",
                presentation: {
                    age: 28,
                    gender: "Female",
                    occupation: "Teacher",
                    chiefComplaint: "3-week history of mild tingling in fingers, mainly at night",
                    history: "Currently 32 weeks pregnant. Started noticing mild tingling in thumb, index, and middle fingers that wakes her up at night. Shaking hands provides some relief. No weakness or dropping objects. Symptoms are intermittent and mild. No previous hand problems.",
                    pmh: "Pregnant (G2P1), no complications",
                    medications: "Prenatal vitamins"
                },
                physicalExam: {
                    inspection: "No visible atrophy or deformity",
                    palpation: "Mild tenderness over carpal tunnel, no swelling",
                    rom: "Full ROM at all joints",
                    strength: "5/5 strength throughout, normal pinch strength",
                    sensation: "Subjective mild numbness in median distribution, objective sensation intact",
                    reflexes: "2+ and symmetric throughout",
                    specialTests: "Mildly positive Phalen's test (symptoms at 45 seconds), negative Tinel's sign"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency (3.2ms), normal amplitude (8.5 mV)",
                        interpretation: "No motor involvement"
                    },
                    {
                        name: "Median Sensory (digit 2)",
                        result: "abnormal",
                        findings: "Mildly prolonged peak latency (3.8ms, normal <3.5ms), normal amplitude",
                        interpretation: "Mild sensory median neuropathy"
                    },
                    {
                        name: "Median Sensory (palm-wrist)",
                        result: "abnormal",
                        findings: "Prolonged latency difference (0.6ms, normal <0.4ms)",
                        interpretation: "Early carpal tunnel syndrome"
                    },
                    {
                        name: "Ulnar Sensory (digit 5)",
                        result: "normal",
                        findings: "Normal amplitude and latency",
                        interpretation: "Normal ulnar function"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor pollicis brevis",
                        findings: "Normal spontaneous activity, normal motor units",
                        interpretation: "No denervation"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "beginner",
                correctDiagnosis: "Mild Carpal Tunnel Syndrome (Pregnancy-related)",
                explanation: "Early/mild CTS with purely sensory findings. Pregnancy-related fluid retention commonly causes reversible median nerve compression. Palm-wrist comparison study is sensitive for early CTS when routine sensory studies are borderline."
            },
            'severects': {
                title: "Severe Hand Weakness and Atrophy",
                presentation: {
                    age: 58,
                    gender: "Male",
                    occupation: "Retired Mechanic",
                    chiefComplaint: "2-year history of progressive hand weakness with visible muscle wasting",
                    history: "Started with nighttime numbness 2 years ago, gradually worsened. Now has constant numbness in thumb, index, and middle fingers. Significant weakness gripping tools, difficulty with buttons and fine motor tasks. Notices visible muscle loss in thumb area. Denies trauma or neck pain.",
                    pmh: "Diabetes mellitus type 2, osteoarthritis",
                    medications: "Metformin, insulin"
                },
                physicalExam: {
                    inspection: "Marked thenar atrophy, visible muscle wasting",
                    palpation: "Firm, non-tender mass over carpal tunnel",
                    rom: "Full ROM but weak thumb opposition",
                    strength: "Abductor pollicis brevis 2/5, opponens pollicis 2/5, severe pinch weakness",
                    sensation: "Complete sensory loss in median distribution",
                    reflexes: "2+ and symmetric throughout",
                    specialTests: "Unable to perform Phalen's test due to weakness, no Tinel's sign"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Severely prolonged distal latency (8.1ms), markedly reduced amplitude (1.2 mV)",
                        interpretation: "Severe motor median neuropathy"
                    },
                    {
                        name: "Median Sensory (digit 2)",
                        result: "abnormal",
                        findings: "No sensory response elicitable",
                        interpretation: "Severe sensory median neuropathy"
                    },
                    {
                        name: "Median Motor (FPL)",
                        result: "abnormal",
                        findings: "Prolonged latency, reduced amplitude",
                        interpretation: "Proximal median nerve involvement"
                    },
                    {
                        name: "Ulnar Motor/Sensory",
                        result: "normal",
                        findings: "All parameters normal",
                        interpretation: "Ulnar nerve spared"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor pollicis brevis",
                        findings: "Severe chronic denervation with poor reinnervation",
                        interpretation: "Severe chronic median neuropathy"
                    },
                    {
                        muscle: "Opponens pollicis",
                        findings: "Chronic denervation changes",
                        interpretation: "Recurrent motor branch involvement"
                    },
                    {
                        muscle: "Flexor pollicis longus",
                        findings: "Chronic denervation",
                        interpretation: "Anterior interosseous nerve involvement"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "beginner",
                correctDiagnosis: "Severe Carpal Tunnel Syndrome with Thenar Atrophy",
                explanation: "End-stage CTS with severe motor and sensory involvement, thenar atrophy, and poor prognosis for recovery. Diabetes is a risk factor for more severe neuropathy. Surgical decompression urgent to prevent further deterioration."
            },
            'acutecutspost': {
                title: "Acute Hand Numbness After Elbow Fracture",
                presentation: {
                    age: 24,
                    gender: "Male",
                    occupation: "Student",
                    chiefComplaint: "Acute onset numbness and weakness in hand 3 days after elbow fracture surgery",
                    history: "Fell off bicycle 1 week ago, sustained elbow fracture requiring ORIF. Surgery went well initially. Three days post-op, developed acute numbness in ring and little fingers with weakness pinching. No pre-surgical hand symptoms. Concerned about nerve injury.",
                    pmh: "No significant medical history",
                    medications: "Oxycodone, ibuprofen"
                },
                physicalExam: {
                    inspection: "Surgical incision healing well, mild swelling around elbow",
                    palpation: "Tender over surgical site, positive Tinel's over cubital tunnel",
                    rom: "Limited elbow flexion due to post-surgical restrictions",
                    strength: "Interosseous muscles 3/5, FDP (ring/little) 4/5, FCU 4/5",
                    sensation: "Decreased sensation in ulnar distribution (ring/little fingers)",
                    reflexes: "Normal throughout",
                    specialTests: "Positive elbow flexion test, positive Tinel's at cubital tunnel"
                },
                ncsStudies: [
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Conduction block across elbow (50% amplitude drop), normal distal latency",
                        interpretation: "Acute ulnar neuropathy at elbow"
                    },
                    {
                        name: "Ulnar Motor (FDI)",
                        result: "abnormal",
                        findings: "Reduced amplitude with conduction block",
                        interpretation: "Deep motor branch involvement"
                    },
                    {
                        name: "Ulnar Sensory (digit 5)",
                        result: "abnormal",
                        findings: "Severely reduced amplitude",
                        interpretation: "Ulnar sensory involvement"
                    },
                    {
                        name: "Median studies",
                        result: "normal",
                        findings: "All parameters normal",
                        interpretation: "Median nerve unaffected"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "First dorsal interosseous",
                        findings: "Reduced recruitment, no denervation (too early)",
                        interpretation: "Acute ulnar neuropathy"
                    },
                    {
                        muscle: "Flexor carpi ulnaris",
                        findings: "Reduced recruitment",
                        interpretation: "Ulnar nerve at elbow level"
                    },
                    {
                        muscle: "Flexor digitorum profundus (ring)",
                        findings: "Mildly reduced recruitment",
                        interpretation: "Ulnar nerve involvement"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                correctDiagnosis: "Acute Post-Surgical Cubital Tunnel Syndrome",
                explanation: "Iatrogenic ulnar neuropathy following elbow surgery, likely from surgical trauma, swelling, or positioning. Conduction block pattern suggests compressive/demyelinating injury with potential for recovery if decompressed early."
            },
            'lumboplexopathy': {
                title: "Hip Pain with Leg Weakness After Surgery",
                presentation: {
                    age: 67,
                    gender: "Female",
                    occupation: "Retired",
                    chiefComplaint: "Right leg weakness and numbness following hip replacement surgery 6 weeks ago",
                    history: "Underwent right total hip replacement 6 weeks ago for severe arthritis. Post-operatively developed weakness in right leg, difficulty walking, and numbness over anterior thigh. Initially attributed to surgical pain but weakness persists. Can't lift leg straight up or extend knee strongly.",
                    pmh: "Osteoarthritis, hypertension",
                    medications: "Lisinopril, tramadol, physical therapy"
                },
                physicalExam: {
                    inspection: "Surgical scar healing well, mild quadriceps atrophy",
                    palpation: "No tenderness over surgical site, no palpable masses",
                    rom: "Limited hip flexion due to weakness",
                    strength: "Hip flexors 2/5, quadriceps 3/5, hip adductors 3/5. Normal ankle dorsiflexion.",
                    sensation: "Decreased sensation over anterior thigh and medial leg",
                    reflexes: "Absent patellar reflex on right (0+). Achilles normal.",
                    specialTests: "Negative straight leg raise, positive femoral stretch test"
                },
                ncsStudies: [
                    {
                        name: "Femoral Motor (Quadriceps)",
                        result: "abnormal",
                        findings: "Reduced amplitude (4.2 mV, normal >6 mV)",
                        interpretation: "Femoral nerve dysfunction"
                    },
                    {
                        name: "Lateral Femoral Cutaneous",
                        result: "abnormal",
                        findings: "Absent sensory response",
                        interpretation: "Lateral femoral cutaneous nerve involvement"
                    },
                    {
                        name: "Saphenous Sensory",
                        result: "abnormal",
                        findings: "Reduced amplitude",
                        interpretation: "Femoral nerve sensory branch involvement"
                    },
                    {
                        name: "Peroneal/Tibial studies",
                        result: "normal",
                        findings: "Normal amplitudes and velocities",
                        interpretation: "L5-S1 distribution spared"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Lumbar paraspinals",
                        findings: "Normal",
                        interpretation: "Root level spared"
                    },
                    {
                        muscle: "Iliopsoas",
                        findings: "Denervation changes",
                        interpretation: "Femoral nerve involvement"
                    },
                    {
                        muscle: "Quadriceps",
                        findings: "Active denervation and reduced recruitment",
                        interpretation: "Femoral nerve palsy"
                    },
                    {
                        muscle: "Adductor longus",
                        findings: "Mild denervation changes",
                        interpretation: "Obturator nerve involvement"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                correctDiagnosis: "Lumbar Plexopathy (Post-Surgical) - Femoral and Obturator Nerve Pattern",
                explanation: "Post-surgical lumbar plexopathy affecting femoral and obturator nerves from retractor positioning, hematoma, or direct surgical trauma. Pattern of multiple nerve involvement in L2-L4 distribution with spared paraspinals localizes to plexus level."
            },
            'c8radiculopathy': {
                title: "Hand Weakness with Neck Pain",
                presentation: {
                    age: 51,
                    gender: "Female",
                    occupation: "Administrative Assistant",
                    chiefComplaint: "6-week history of neck pain radiating to hand with weakness gripping",
                    history: "Gradual onset neck pain radiating down medial arm to ring and little fingers. Weakness gripping small objects and difficulty with fine motor tasks. Pain worse with neck movement. Numbness in ring and little fingers. No trauma but poor workplace ergonomics.",
                    pmh: "Cervical spondylosis on previous MRI",
                    medications: "NSAIDs, muscle relaxants"
                },
                physicalExam: {
                    inspection: "Mild intrinsic hand muscle atrophy",
                    palpation: "Cervical paraspinal tenderness at C7-T1 level",
                    rom: "Limited cervical lateral flexion",
                    strength: "Hand intrinsics 4/5, FDP (ring/little) 4/5, grip strength reduced",
                    sensation: "Decreased sensation in C8 dermatome (ring/little fingers, medial hand)",
                    reflexes: "Normal biceps and triceps, finger flexor reflex hyperactive",
                    specialTests: "Positive Spurling's test, negative Tinel's at elbow/wrist"
                },
                ncsStudies: [
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Mildly reduced amplitude (6.8 mV, normal >8 mV)",
                        interpretation: "Mild ulnar nerve dysfunction"
                    },
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Reduced amplitude (5.2 mV, normal >6 mV)",
                        interpretation: "Median nerve involvement"
                    },
                    {
                        name: "Ulnar Sensory (digit 5)",
                        result: "abnormal",
                        findings: "Reduced amplitude bilaterally",
                        interpretation: "Ulnar sensory involvement"
                    },
                    {
                        name: "Medial Antebrachial Cutaneous",
                        result: "abnormal",
                        findings: "Absent response on affected side",
                        interpretation: "C8-T1 sensory involvement"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Cervical paraspinals (C7-T1)",
                        findings: "Positive sharp waves and fibrillations",
                        interpretation: "Acute denervation"
                    },
                    {
                        muscle: "First dorsal interosseous",
                        findings: "Denervation changes with reduced recruitment",
                        interpretation: "C8-T1 root involvement"
                    },
                    {
                        muscle: "Abductor digiti minimi",
                        findings: "Active denervation",
                        interpretation: "C8-T1 root lesion"
                    },
                    {
                        muscle: "Flexor digitorum profundus (ring)",
                        findings: "Denervation changes",
                        interpretation: "C8 root involvement"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                correctDiagnosis: "Right C8 Radiculopathy",
                explanation: "C8 radiculopathy with classic hand intrinsic weakness and sensory loss in C8 distribution. Both median and ulnar nerve amplitudes reduced due to C8 root lesion affecting both nerves. Cervical paraspinal denervation confirms root level pathology."
            },
            'guyon': {
                title: "Hand Numbness After Cycling",
                presentation: {
                    age: 34,
                    gender: "Male",
                    occupation: "Accountant",
                    chiefComplaint: "Numbness and weakness in ring and little fingers after long bike ride",
                    history: "Avid cyclist who completed 100-mile ride 2 weeks ago. Developed numbness in ring and little fingers during ride that persisted. Weakness gripping and pinching with thumb and little finger. No elbow pain or neck symptoms. Uses drop handlebars with prolonged pressure on palms.",
                    pmh: "No significant medical history",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "Mild hypothenar atrophy, no interosseous atrophy",
                    palpation: "Tenderness over Guyon's canal, no elbow tenderness",
                    rom: "Full ROM at all joints",
                    strength: "Hypothenar muscles 4/5, interossei normal, FCU normal",
                    sensation: "Decreased sensation in little finger and ulnar half of ring finger",
                    reflexes: "Normal throughout",
                    specialTests: "Negative Tinel's at elbow, positive Tinel's at Guyon's canal"
                },
                ncsStudies: [
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Prolonged distal latency (4.2ms), reduced amplitude",
                        interpretation: "Deep motor branch of ulnar nerve at wrist"
                    },
                    {
                        name: "Ulnar Motor (FDI)",
                        result: "normal",
                        findings: "Normal latency and amplitude",
                        interpretation: "Deep motor branch to interossei spared"
                    },
                    {
                        name: "Ulnar Sensory (digit 5)",
                        result: "abnormal",
                        findings: "Prolonged latency, reduced amplitude",
                        interpretation: "Superficial sensory branch involvement"
                    },
                    {
                        name: "Ulnar Motor across elbow",
                        result: "normal",
                        findings: "Normal conduction velocity and amplitude",
                        interpretation: "No cubital tunnel syndrome"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor digiti minimi",
                        findings: "Mild denervation changes",
                        interpretation: "Deep motor branch involvement"
                    },
                    {
                        muscle: "First dorsal interosseous",
                        findings: "Normal",
                        interpretation: "Deep motor branch to interossei spared"
                    },
                    {
                        muscle: "Flexor carpi ulnaris",
                        findings: "Normal",
                        interpretation: "Proximal ulnar nerve normal"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                correctDiagnosis: "Ulnar Neuropathy at Guyon's Canal (Cyclist's Palsy)",
                explanation: "Compression of ulnar nerve at Guyon's canal from prolonged pressure on handlebars. Affects superficial sensory branch and deep motor branch to hypothenar muscles while sparing interossei (which branch more proximally). Classic cycling injury."
            },
            'lumbosacralplexopathy': {
                title: "Bilateral Leg Weakness After Prolonged Labor",
                presentation: {
                    age: 26,
                    gender: "Female",
                    occupation: "Marketing Coordinator",
                    chiefComplaint: "Bilateral leg weakness and numbness after prolonged childbirth 6 weeks ago",
                    history: "Had difficult 18-hour labor with prolonged second stage requiring forceps delivery. Immediately post-delivery noticed bilateral leg weakness and numbness. Right leg more affected than left. Difficulty walking, frequent falls. Numbness over anterior thighs and medial legs bilaterally.",
                    pmh: "Uncomplicated pregnancy until delivery",
                    medications: "Iron supplements, physical therapy"
                },
                physicalExam: {
                    inspection: "Bilateral quadriceps atrophy, more pronounced on right",
                    palpation: "No masses or tenderness over pelvis",
                    rom: "Limited hip flexion due to weakness",
                    strength: "Hip flexors 3/5 bilaterally, quadriceps 2/5 right, 3/5 left",
                    sensation: "Decreased sensation over anterior thighs and medial legs bilaterally",
                    reflexes: "Absent patellar reflexes bilaterally, normal Achilles reflexes",
                    specialTests: "Negative straight leg raise, positive femoral stretch test bilaterally"
                },
                ncsStudies: [
                    {
                        name: "Femoral Motor (Quadriceps) - Right",
                        result: "abnormal",
                        findings: "Severely reduced amplitude (2.1 mV), normal latency",
                        interpretation: "Severe femoral nerve dysfunction"
                    },
                    {
                        name: "Femoral Motor (Quadriceps) - Left",
                        result: "abnormal",
                        findings: "Mildly reduced amplitude (4.8 mV)",
                        interpretation: "Mild femoral nerve dysfunction"
                    },
                    {
                        name: "Lateral Femoral Cutaneous - Bilateral",
                        result: "abnormal",
                        findings: "Absent responses bilaterally",
                        interpretation: "Bilateral lateral femoral cutaneous nerve involvement"
                    },
                    {
                        name: "Peroneal/Tibial studies",
                        result: "normal",
                        findings: "Normal amplitudes and velocities",
                        interpretation: "L5-S1 distribution spared"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Lumbar paraspinals",
                        findings: "Normal",
                        interpretation: "Root level spared"
                    },
                    {
                        muscle: "Iliopsoas - Bilateral",
                        findings: "Denervation changes bilaterally",
                        interpretation: "Bilateral femoral nerve involvement"
                    },
                    {
                        muscle: "Quadriceps - Right",
                        findings: "Severe denervation with poor reinnervation",
                        interpretation: "Severe femoral nerve palsy"
                    },
                    {
                        muscle: "Quadriceps - Left",
                        findings: "Mild denervation changes",
                        interpretation: "Mild femoral nerve involvement"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                correctDiagnosis: "Bilateral Lumbosacral Plexopathy (Obstetric) - Femoral Nerve Pattern",
                explanation: "Bilateral femoral nerve injury from prolonged labor with fetal head compression against maternal pelvis. Classic obstetric complication affecting lumbosacral plexus, typically involving femoral and lateral femoral cutaneous nerves."
            },
            'pinoneuropathy': {
                title: "Thumb Weakness After Wrist Fracture",
                presentation: {
                    age: 39,
                    gender: "Female",
                    occupation: "Physical Therapist",
                    chiefComplaint: "Inability to pinch and weakness making 'OK' sign 8 weeks after wrist fracture",
                    history: "Fell on outstretched hand 8 weeks ago, sustained distal radius fracture requiring ORIF with volar plate. Post-operatively developed inability to pinch tip of thumb to tip of index finger. Can't make 'OK' sign or pick up small objects. No numbness. Other hand functions normal.",
                    pmh: "No significant medical history",
                    medications: "Ibuprofen, physical therapy"
                },
                physicalExam: {
                    inspection: "No visible atrophy, well-healed surgical scar",
                    palpation: "No tenderness over carpal tunnel or surgical site",
                    rom: "Full ROM at wrist and fingers",
                    strength: "FPL 2/5, FDP (index) 2/5, all other muscles normal including APB",
                    sensation: "Normal sensation throughout hand",
                    reflexes: "Normal throughout",
                    specialTests: "Positive anterior interosseous nerve sign (can't make 'OK' sign)"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency and amplitude",
                        interpretation: "Main trunk of median nerve normal"
                    },
                    {
                        name: "Median Sensory (digit 2)",
                        result: "normal",
                        findings: "Normal amplitude and latency",
                        interpretation: "No carpal tunnel syndrome"
                    },
                    {
                        name: "Ulnar Motor/Sensory",
                        result: "normal",
                        findings: "All parameters normal",
                        interpretation: "Ulnar nerve unaffected"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Flexor pollicis longus",
                        findings: "No voluntary activity, denervation changes",
                        interpretation: "Anterior interosseous nerve palsy"
                    },
                    {
                        muscle: "Flexor digitorum profundus (index)",
                        findings: "No voluntary activity",
                        interpretation: "Anterior interosseous nerve involvement"
                    },
                    {
                        muscle: "Pronator quadratus",
                        findings: "Denervation changes",
                        interpretation: "Anterior interosseous nerve palsy"
                    },
                    {
                        muscle: "Abductor pollicis brevis",
                        findings: "Normal",
                        interpretation: "Main median nerve trunk spared"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                correctDiagnosis: "Anterior Interosseous Nerve Palsy (Post-Surgical)",
                explanation: "Isolated anterior interosseous nerve (pure motor branch of median nerve) palsy following volar plate ORIF. Classic presentation with inability to pinch (FPL and FDP index weakness) with preserved sensation and normal APB. Often iatrogenic from surgical approach."
            },
            'lamberteatonmyasthenic': {
                title: "Progressive Weakness in Cancer Patient",
                presentation: {
                    age: 62,
                    gender: "Male",
                    occupation: "Retired Electrician",
                    chiefComplaint: "6-month history of progressive weakness and fatigue, especially in legs",
                    history: "Gradual onset proximal weakness, especially in legs. Difficulty standing from chair and climbing stairs. Weakness improves with activity initially but then worsens. Dry mouth and some difficulty swallowing. Recently diagnosed with small cell lung cancer. Family concerned about progression.",
                    pmh: "Small cell lung cancer (recently diagnosed), smoking history",
                    medications: "Chemotherapy regimen, prednisone"
                },
                physicalExam: {
                    inspection: "Mild proximal muscle atrophy, no fasciculations",
                    palpation: "No muscle tenderness",
                    rom: "Full ROM but limited by weakness",
                    strength: "Proximal weakness (3/5) that improves with initial exercise then fatigues",
                    sensation: "Normal throughout",
                    reflexes: "Diminished (1+) but improve with exercise",
                    specialTests: "Strength improves with brief exercise, then fatigues"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Low baseline amplitude (2.8 mV), normal latency",
                        interpretation: "Reduced compound muscle action potential"
                    },
                    {
                        name: "High-Frequency Repetitive Stimulation (50Hz)",
                        result: "abnormal",
                        findings: "400% increment in amplitude with high-frequency stimulation",
                        interpretation: "Classic Lambert-Eaton pattern"
                    },
                    {
                        name: "Post-Exercise Facilitation",
                        result: "abnormal",
                        findings: "Marked increase in CMAP amplitude after 10 seconds of exercise",
                        interpretation: "Presynaptic neuromuscular junction disorder"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Deltoid",
                        findings: "Small amplitude motor units with normal morphology",
                        interpretation: "Reduced recruitment due to NMJ dysfunction"
                    },
                    {
                        muscle: "Quadriceps",
                        findings: "Low amplitude voluntary units, no denervation",
                        interpretation: "Neuromuscular transmission defect"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "Lambert-Eaton Myasthenic Syndrome (Paraneoplastic)",
                explanation: "Presynaptic neuromuscular junction disorder associated with small cell lung cancer. Characterized by low baseline CMAP amplitudes with dramatic increment (>100%) on high-frequency stimulation, opposite pattern from myasthenia gravis."
            },
            'inclusionbodymyositis': {
                title: "Slowly Progressive Weakness and Atrophy",
                presentation: {
                    age: 68,
                    gender: "Male",
                    occupation: "Retired Teacher",
                    chiefComplaint: "3-year history of slowly progressive weakness in arms and legs with muscle wasting",
                    history: "Insidious onset weakness starting with difficulty gripping objects and frequent falls. Progressive weakness in both proximal and distal muscles. Noticed muscle wasting in forearms and thighs. Difficulty swallowing solids recently. No rash or arthritis. Family history of 'muscle disease' in uncle.",
                    pmh: "Hypertension, type 2 diabetes",
                    medications: "Lisinopril, metformin"
                },
                physicalExam: {
                    inspection: "Asymmetric muscle atrophy affecting quadriceps and forearm flexors",
                    palpation: "Firm, atrophic muscles without tenderness",
                    rom: "Limited by weakness and contractures",
                    strength: "Asymmetric weakness: quadriceps 2/5, finger flexors 3/5, deltoids 4/5",
                    sensation: "Normal throughout",
                    reflexes: "Diminished (1+) throughout",
                    specialTests: "No rash, no fasciculations at rest"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency and amplitude",
                        interpretation: "No peripheral neuropathy"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal parameters throughout",
                        interpretation: "No nerve involvement"
                    },
                    {
                        name: "Sensory studies",
                        result: "normal",
                        findings: "All sensory responses normal",
                        interpretation: "No sensory neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Quadriceps",
                        findings: "Mixed myopathic and neurogenic changes, positive sharp waves",
                        interpretation: "Inclusion body myositis pattern"
                    },
                    {
                        muscle: "Biceps",
                        findings: "Small polyphasic motor units with spontaneous activity",
                        interpretation: "Active myopathy with denervation"
                    },
                    {
                        muscle: "Forearm flexors",
                        findings: "Mixed pattern: small motor units with fibrillations",
                        interpretation: "Characteristic IBM pattern"
                    },
                    {
                        muscle: "Deltoid",
                        findings: "Predominantly myopathic changes",
                        interpretation: "Proximal myopathy"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "Inclusion Body Myositis",
                explanation: "Progressive inflammatory myopathy with characteristic asymmetric pattern affecting both proximal and distal muscles. EMG shows mixed myopathic and neurogenic features with spontaneous activity, distinguishing it from other inflammatory myopathies."
            },
            'pronatorteres': {
                title: "Forearm Pain with Hand Numbness",
                presentation: {
                    age: 42,
                    gender: "Female",
                    occupation: "Tennis Instructor",
                    chiefComplaint: "6-month history of forearm pain and hand numbness that worsens with activity",
                    history: "Gradual onset pain in proximal forearm with numbness in thumb, index, and middle fingers. Pain and numbness worsen with repetitive forearm pronation during tennis instruction. Unlike typical carpal tunnel, symptoms present during day with activity rather than at night. No weakness with pinching.",
                    pmh: "Tennis elbow 2 years ago, resolved",
                    medications: "Ibuprofen PRN"
                },
                physicalExam: {
                    inspection: "No visible atrophy or deformity",
                    palpation: "Tenderness over pronator teres muscle, no carpal tunnel tenderness",
                    rom: "Full ROM but pain with resisted pronation",
                    strength: "5/5 strength throughout including normal pinch strength",
                    sensation: "Mild numbness in median distribution, including thenar eminence",
                    reflexes: "2+ and symmetric throughout",
                    specialTests: "Negative Phalen's and Tinel's at wrist. Positive pronator teres compression test."
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Mildly prolonged distal latency (4.2ms), normal amplitude",
                        interpretation: "Mild motor median neuropathy"
                    },
                    {
                        name: "Median Sensory (digit 2)",
                        result: "abnormal",
                        findings: "Prolonged latency, reduced amplitude compared to ulnar",
                        interpretation: "Sensory median neuropathy"
                    },
                    {
                        name: "Median Sensory (palm-wrist)",
                        result: "normal",
                        findings: "Normal latency difference (<0.4ms)",
                        interpretation: "No carpal tunnel syndrome"
                    },
                    {
                        name: "Palmar cutaneous sensory",
                        result: "abnormal",
                        findings: "Reduced amplitude",
                        interpretation: "Proximal to carpal tunnel (palmar cutaneous branches above wrist)"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor pollicis brevis",
                        findings: "Mild denervation changes",
                        interpretation: "Median nerve involvement"
                    },
                    {
                        muscle: "Flexor pollicis longus",
                        findings: "Normal",
                        interpretation: "AIN spared (branches before pronator teres)"
                    },
                    {
                        muscle: "Pronator teres",
                        findings: "Normal",
                        interpretation: "Compression distal to muscle innervation"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Pronator Teres Syndrome (Proximal Median Neuropathy)",
                explanation: "Median nerve compression at pronator teres level. Key features: activity-related symptoms (vs nighttime CTS), thenar eminence numbness (palmar cutaneous involved), normal palm-wrist studies. Less common than CTS, requires high index of suspicion."
            },
            'sci': {
                title: "Acute Paralysis After Diving Accident",
                presentation: {
                    age: 22,
                    gender: "Male",
                    occupation: "College Student",
                    chiefComplaint: "Complete paralysis below chest level after diving accident 2 weeks ago",
                    history: "Dove into shallow water 2 weeks ago, struck head on bottom. Immediate complete paralysis below nipple line. No sensation or movement in legs. Some arm movement preserved but hands weak. Bladder and bowel dysfunction. MRI shows complete C6 spinal cord injury.",
                    pmh: "Previously healthy athlete",
                    medications: "Methylprednisolone, catheter care"
                },
                physicalExam: {
                    inspection: "Wheelchair-bound, complete flaccid paralysis below C6 level",
                    palpation: "No pain sensation below injury level",
                    rom: "No active movement below C6 dermatome",
                    strength: "Biceps 4/5, triceps 0/5, complete paralysis below C7",
                    sensation: "Complete sensory loss below C6 dermatome",
                    reflexes: "Absent reflexes below injury, hyperreflexic biceps",
                    specialTests: "Positive Babinski sign, spasticity in arms"
                },
                ncsStudies: [],
                emgStudies: [],
                requiresEMG: false,
                emgIndication: "NOT INDICATED",
                difficulty: "beginner",
                correctDiagnosis: "Complete C6 Spinal Cord Injury - EMG NOT INDICATED",
                explanation: "Complete spinal cord injury with clear anatomical level and imaging confirmation. EMG/NCS would be normal below the lesion as the peripheral nervous system is intact. Clinical picture and imaging provide definitive diagnosis.",
                educationalNote: "EMG/NCS studies evaluate the peripheral nervous system. In complete spinal cord injuries, the peripheral nerves, muscles, and neuromuscular junctions are intact. EMG would show normal nerve conduction and muscle responses, providing no additional diagnostic information beyond clinical examination and imaging."
            },
            'femoraltrauma': {
                title: "Hip Pain and Leg Weakness After MVA",
                presentation: {
                    age: 35,
                    gender: "Male",
                    occupation: "Construction Worker",
                    chiefComplaint: "Right leg weakness and anterior thigh numbness 8 weeks after motor vehicle accident",
                    history: "High-speed MVA 8 weeks ago with pelvic fractures and retroperitoneal hematoma. After initial trauma stabilization, developed right leg weakness and numbness. Cannot extend knee or flex hip effectively. Numbness over anterior thigh and medial leg. Initial concern was for back injury but lumbar spine imaging normal.",
                    pmh: "No significant medical history before accident",
                    medications: "Oxycodone, physical therapy"
                },
                physicalExam: {
                    inspection: "Right quadriceps atrophy, antalgic gait with assistive device",
                    palpation: "Well-healed abdominal surgical scars, no palpable masses",
                    rom: "Limited hip flexion and knee extension",
                    strength: "Hip flexors 2/5, quadriceps 1/5, hip adductors 3/5 on right",
                    sensation: "Complete sensory loss over anterior thigh and medial leg",
                    reflexes: "Absent patellar reflex on right (0+), normal Achilles",
                    specialTests: "Positive femoral stretch test, negative straight leg raise"
                },
                ncsStudies: [
                    {
                        name: "Femoral Motor (Quadriceps)",
                        result: "abnormal",
                        findings: "No motor response elicitable",
                        interpretation: "Complete femoral nerve palsy"
                    },
                    {
                        name: "Saphenous Sensory",
                        result: "abnormal",
                        findings: "Absent sensory response",
                        interpretation: "Complete sensory loss in femoral distribution"
                    },
                    {
                        name: "Lateral Femoral Cutaneous",
                        result: "abnormal",
                        findings: "Absent response",
                        interpretation: "Lateral femoral cutaneous nerve involvement"
                    },
                    {
                        name: "Obturator nerve testing",
                        result: "abnormal",
                        findings: "Reduced response to adductor muscles",
                        interpretation: "Partial obturator nerve involvement"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Lumbar paraspinals",
                        findings: "Normal",
                        interpretation: "Root level spared"
                    },
                    {
                        muscle: "Iliopsoas",
                        findings: "No voluntary activity, denervation changes",
                        interpretation: "Complete femoral nerve palsy"
                    },
                    {
                        muscle: "Quadriceps",
                        findings: "No voluntary activity, active denervation",
                        interpretation: "Complete femoral nerve lesion"
                    },
                    {
                        muscle: "Adductor longus",
                        findings: "Denervation changes",
                        interpretation: "Partial obturator nerve involvement"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Traumatic Femoral Nerve Palsy with Partial Obturator Nerve Injury",
                explanation: "Complete femoral nerve palsy from retroperitoneal hematoma or direct trauma during pelvic fracture. Compression/stretching of lumbar plexus branches. Pattern localizes to plexus level (spared paraspinals) rather than root avulsion."
            },
            'sciaticneoplasm': {
                title: "Progressive Leg Pain and Weakness",
                presentation: {
                    age: 58,
                    gender: "Female",
                    occupation: "Accountant",
                    chiefComplaint: "6-month history of progressive right leg pain, weakness, and numbness",
                    history: "Insidious onset deep, aching pain in right buttock radiating down entire leg. Progressive weakness in foot dorsiflexion and plantarflexion. Numbness in lateral leg and foot. Pain constant, not positional. Weight loss of 15 pounds. Night pain disrupting sleep. No back pain or trauma.",
                    pmh: "Breast cancer 8 years ago, treated with mastectomy and chemotherapy",
                    medications: "Gabapentin, oxycodone"
                },
                physicalExam: {
                    inspection: "Right leg atrophy, foot drop gait pattern",
                    palpation: "Deep tenderness in right buttock, no discrete mass palpable",
                    rom: "Limited by weakness and pain",
                    strength: "Complete foot drop (0/5 dorsiflexion), plantarflexion 2/5, hip weakness 3/5",
                    sensation: "Decreased sensation in entire sciatic distribution (lateral leg, dorsal/plantar foot)",
                    reflexes: "Absent Achilles reflex, absent patellar reflex on right",
                    specialTests: "Negative straight leg raise (too painful), negative Spurling's test"
                },
                ncsStudies: [
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal",
                        findings: "No response elicitable",
                        interpretation: "Complete deep peroneal nerve palsy"
                    },
                    {
                        name: "Tibial Motor (AH)",
                        result: "abnormal",
                        findings: "Severely reduced amplitude (2.1 mV)",
                        interpretation: "Severe tibial nerve dysfunction"
                    },
                    {
                        name: "Superficial Peroneal Sensory",
                        result: "abnormal",
                        findings: "Absent response",
                        interpretation: "Complete superficial peroneal nerve loss"
                    },
                    {
                        name: "Sural Sensory",
                        result: "abnormal",
                        findings: "Absent response",
                        interpretation: "Complete sural nerve loss"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Lumbar paraspinals",
                        findings: "Normal",
                        interpretation: "Root level spared"
                    },
                    {
                        muscle: "Gluteus maximus",
                        findings: "Severe denervation, no voluntary activity",
                        interpretation: "Sciatic nerve involvement above knee"
                    },
                    {
                        muscle: "Biceps femoris (short head)",
                        findings: "Complete denervation",
                        interpretation: "Peroneal division of sciatic nerve"
                    },
                    {
                        muscle: "Gastrocnemius",
                        findings: "Severe denervation changes",
                        interpretation: "Tibial division of sciatic nerve"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Sciatic Neuropathy Secondary to Neoplasm (Metastatic Disease)",
                explanation: "Complete sciatic nerve palsy from tumor compression/infiltration in pelvis. History of breast cancer, weight loss, and progressive nature suggest metastatic disease. EMG localizes to sciatic nerve level with spared paraspinals, distinguishing from root pathology."
            },
            'ulnarwristcompression': {
                title: "Hand Weakness After Wrist Injury",
                presentation: {
                    age: 29,
                    gender: "Male",
                    occupation: "Rock Climber",
                    chiefComplaint: "Hand weakness and numbness after fall while rock climbing 4 weeks ago",
                    history: "Fell while climbing 4 weeks ago, landed on outstretched hands. Initially focused on wrist pain, but developed progressive weakness and numbness in ring and little fingers. Weakness gripping and difficulty with fine motor tasks. Uses wrist guards for climbing which may compress ulnar nerve at wrist.",
                    pmh: "Previous wrist injuries from climbing",
                    medications: "Ibuprofen, wrist bracing"
                },
                physicalExam: {
                    inspection: "Mild hypothenar atrophy, well-healed abrasions on palm",
                    palpation: "Tenderness over Guyon's canal and pisiform bone",
                    rom: "Full ROM at wrist and fingers",
                    strength: "Hypothenar muscles 3/5, interossei normal (5/5), FCU normal",
                    sensation: "Decreased sensation in little finger and ulnar half ring finger",
                    reflexes: "Normal throughout",
                    specialTests: "Positive Tinel's at Guyon's canal, negative at elbow"
                },
                ncsStudies: [
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Prolonged distal latency (4.8ms), reduced amplitude",
                        interpretation: "Deep motor branch ulnar neuropathy at wrist"
                    },
                    {
                        name: "Ulnar Motor (FDI)",
                        result: "normal",
                        findings: "Normal latency and amplitude",
                        interpretation: "Deep motor branch to interossei spared"
                    },
                    {
                        name: "Ulnar Sensory (digit 5)",
                        result: "abnormal",
                        findings: "Prolonged latency, reduced amplitude",
                        interpretation: "Superficial sensory branch involvement"
                    },
                    {
                        name: "Dorsal ulnar cutaneous",
                        result: "normal",
                        findings: "Normal response",
                        interpretation: "Branches proximal to Guyon's canal spared"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor digiti minimi",
                        findings: "Denervation changes with reduced recruitment",
                        interpretation: "Deep motor branch involvement"
                    },
                    {
                        muscle: "First dorsal interosseous",
                        findings: "Normal",
                        interpretation: "Interossei branch spares (branches proximally in canal)"
                    },
                    {
                        muscle: "Flexor carpi ulnaris",
                        findings: "Normal",
                        interpretation: "Proximal ulnar nerve intact"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Ulnar Neuropathy at Guyon's Canal - Type I (Mixed Motor and Sensory)",
                explanation: "Ulnar nerve compression at Guyon's canal affecting both superficial sensory and deep motor branches to hypothenar muscles. Spares interossei (branch more proximally) and dorsal ulnar cutaneous nerve (branches above wrist). Classic pattern from trauma or chronic pressure."
            },
            'fibromyalgia': {
                title: "Widespread Pain and Fatigue",
                presentation: {
                    age: 45,
                    gender: "Female",
                    occupation: "Office Manager",
                    chiefComplaint: "6-month history of widespread muscle pain, fatigue, and tingling in hands",
                    history: "Gradual onset of widespread muscle and joint pain, fatigue, and sleep disturbances. Reports tingling in hands that led to EMG referral. No weakness or muscle atrophy. Pain worse with stress and weather changes. Multiple tender points throughout body. Previous normal labs including ESR, CRP, ANA.",
                    pmh: "Depression, irritable bowel syndrome",
                    medications: "Sertraline, gabapentin"
                },
                physicalExam: {
                    inspection: "No visible atrophy or fasciculations",
                    palpation: "Multiple tender points at neck, shoulders, back, hips",
                    rom: "Full ROM but limited by pain",
                    strength: "5/5 strength throughout (limited by effort due to pain)",
                    sensation: "Normal objective sensation, subjective numbness in hands",
                    reflexes: "2+ and symmetric throughout",
                    specialTests: "Positive tender points (>11/18), negative Tinel's/Phalen's"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal distal latency and amplitude",
                        interpretation: "No median neuropathy"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal parameters throughout",
                        interpretation: "No ulnar neuropathy"
                    },
                    {
                        name: "All sensory studies",
                        result: "normal",
                        findings: "Normal amplitudes and latencies",
                        interpretation: "No peripheral neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Multiple muscles sampled",
                        findings: "Normal spontaneous activity, normal motor units",
                        interpretation: "No evidence of myopathy or neuropathy"
                    }
                ],
                requiresEMG: false,
                emgIndication: "NOT INDICATED",
                difficulty: "beginner",
                correctDiagnosis: "Fibromyalgia - EMG NOT INDICATED",
                explanation: "Fibromyalgia is a central pain disorder with normal peripheral nervous system. EMG/NCS are normal and not indicated unless there are objective neurological findings. Subjective sensory symptoms without objective deficits don't warrant electrodiagnostic studies.",
                educationalNote: "EMG/NCS should only be performed when there are objective neurological findings (weakness, atrophy, reflex changes, objective sensory loss). Subjective pain and fatigue without focal neurological deficits are not indications for electrodiagnostic testing."
            },
            'charcotmarietooth': {
                title: "Progressive Foot Deformity and Weakness",
                presentation: {
                    age: 32,
                    gender: "Male",
                    occupation: "Software Engineer",
                    chiefComplaint: "Lifelong foot problems with recent worsening weakness and frequent falls",
                    history: "Born with 'club feet' requiring braces as child. Progressive weakness in feet and legs over past 5 years. Frequent ankle sprains and falls. Family history of similar problems in father and paternal grandfather. High-arched feet and difficulty finding shoes that fit.",
                    pmh: "Pes cavus since childhood, multiple ankle sprains",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "Bilateral pes cavus, hammer toes, distal leg atrophy",
                    palpation: "Atrophic calf muscles, normal proximal muscles",
                    rom: "Limited ankle dorsiflexion",
                    strength: "Distal weakness: dorsiflexion 3/5, plantarflexion 4/5. Proximal muscles normal.",
                    sensation: "Decreased vibration and position sense in feet",
                    reflexes: "Absent Achilles reflexes, diminished patellar reflexes",
                    specialTests: "Positive Romberg sign, high-arched feet"
                },
                ncsStudies: [
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal",
                        findings: "Markedly reduced amplitude (0.5 mV), slow conduction velocity (25 m/s)",
                        interpretation: "Severe demyelinating neuropathy"
                    },
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Reduced amplitude, slow conduction velocity (35 m/s)",
                        interpretation: "Demyelinating neuropathy affecting arms"
                    },
                    {
                        name: "Sural Sensory",
                        result: "abnormal",
                        findings: "Absent response",
                        interpretation: "Severe sensory neuropathy"
                    },
                    {
                        name: "Median Sensory",
                        result: "abnormal",
                        findings: "Reduced amplitude, slow conduction velocity",
                        interpretation: "Demyelinating sensory neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Tibialis anterior",
                        findings: "Chronic denervation with large polyphasic motor units",
                        interpretation: "Chronic neuropathy with reinnervation"
                    },
                    {
                        muscle: "Gastrocnemius",
                        findings: "Severe denervation, poor recruitment",
                        interpretation: "Advanced neuropathy"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Charcot-Marie-Tooth Disease (Hereditary Neuropathy)",
                explanation: "Hereditary demyelinating neuropathy with classic distal weakness, pes cavus, and family history. Uniform slowing of conduction velocities throughout suggests demyelinating CMT (likely CMT1). Genetic testing would confirm specific subtype."
            },
            'multifocalmotorneuropathy': {
                title: "Asymmetric Hand and Arm Weakness",
                presentation: {
                    age: 48,
                    gender: "Male",
                    occupation: "Electrician",
                    chiefComplaint: "2-year history of progressive asymmetric weakness in hands and arms",
                    history: "Gradual onset weakness starting in right hand, now affecting left hand and right arm. Weakness is patchy - some muscles weak while adjacent ones normal. No sensory symptoms. No fasciculations visible. Weakness interferes with work requiring fine motor control.",
                    pmh: "No significant medical history",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "Asymmetric muscle atrophy in hands and forearms",
                    palpation: "Atrophic muscles without tenderness",
                    rom: "Full ROM where strength permits",
                    strength: "Patchy weakness: FDI 2/5 right, normal left. APB 3/5 right, 4/5 left. Triceps normal bilaterally.",
                    sensation: "Normal throughout",
                    reflexes: "Normal throughout",
                    specialTests: "No fasciculations, no upper motor neuron signs"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Conduction block: 60% amplitude drop from forearm to wrist",
                        interpretation: "Focal conduction block in median nerve"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Conduction block across elbow, prolonged distal latency",
                        interpretation: "Multifocal involvement of ulnar nerve"
                    },
                    {
                        name: "All sensory studies",
                        result: "normal",
                        findings: "Normal amplitudes and latencies",
                        interpretation: "No sensory involvement"
                    },
                    {
                        name: "Anti-GM1 antibodies",
                        result: "positive",
                        findings: "Elevated anti-GM1 ganglioside antibodies",
                        interpretation: "Supports MMN diagnosis"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor pollicis brevis",
                        findings: "Chronic denervation with large motor units",
                        interpretation: "Chronic motor neuropathy"
                    },
                    {
                        muscle: "First dorsal interosseous",
                        findings: "Active denervation, reduced recruitment",
                        interpretation: "Progressive motor neuropathy"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "Multifocal Motor Neuropathy (MMN)",
                explanation: "Rare immune-mediated motor neuropathy with conduction blocks at non-entrapment sites. Key features: asymmetric pure motor involvement, normal sensory studies, conduction blocks, and anti-GM1 antibodies. Responds to immunotherapy unlike ALS."
            },
            'criticalillnesspolyneuropathy': {
                title: "Weakness After Prolonged ICU Stay",
                presentation: {
                    age: 55,
                    gender: "Female",
                    occupation: "Nurse",
                    chiefComplaint: "Severe weakness in all extremities after 3-week ICU stay for sepsis",
                    history: "Admitted 6 weeks ago with severe pneumonia and sepsis, required mechanical ventilation for 3 weeks. Multiple organ failure with prolonged use of steroids and neuromuscular blocking agents. When sedation lifted, found to have severe weakness in all extremities. Unable to lift arms or legs against gravity.",
                    pmh: "Diabetes mellitus, hypertension",
                    medications: "Multiple ICU medications, now weaning steroids"
                },
                physicalExam: {
                    inspection: "Generalized muscle atrophy, recently extubated",
                    palpation: "Diffuse muscle atrophy without specific tenderness",
                    rom: "Full passive ROM, limited active movement",
                    strength: "Proximal and distal weakness 2-3/5 throughout all extremities",
                    sensation: "Decreased sensation in stocking-glove distribution",
                    reflexes: "Diminished to absent throughout (1+ or absent)",
                    specialTests: "Difficulty weaning from ventilator due to diaphragm weakness"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Markedly reduced amplitude (1.8 mV), normal conduction velocity",
                        interpretation: "Severe axonal motor neuropathy"
                    },
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal",
                        findings: "Severely reduced amplitude (0.6 mV)",
                        interpretation: "Severe axonal neuropathy"
                    },
                    {
                        name: "Median Sensory",
                        result: "abnormal",
                        findings: "Severely reduced amplitude",
                        interpretation: "Axonal sensory neuropathy"
                    },
                    {
                        name: "Sural Sensory",
                        result: "abnormal",
                        findings: "Absent response",
                        interpretation: "Severe sensory axonal loss"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Deltoid",
                        findings: "Fibrillations, positive sharp waves, reduced recruitment",
                        interpretation: "Acute denervation"
                    },
                    {
                        muscle: "Biceps",
                        findings: "Mixed myopathic and neuropathic changes",
                        interpretation: "Critical illness neuromyopathy"
                    },
                    {
                        muscle: "Tibialis anterior",
                        findings: "Severe denervation changes",
                        interpretation: "Axonal neuropathy"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "Critical Illness Polyneuropathy/Myopathy",
                explanation: "Acquired condition in critically ill patients, often with sepsis, prolonged mechanical ventilation, and multiple organ failure. Combination of axonal neuropathy and myopathy. Recovery is variable and often incomplete."
            },
            'spinalmusculatrophy': {
                title: "Progressive Weakness Since Childhood",
                presentation: {
                    age: 28,
                    gender: "Male",
                    occupation: "Teacher (uses wheelchair)",
                    chiefComplaint: "Lifelong progressive weakness, now with new concerns about swallowing",
                    history: "Born with muscle weakness, delayed motor milestones. Progressive weakness throughout childhood requiring wheelchair by age 12. Recent development of difficulty swallowing and choking on liquids. Family history of similar condition in younger brother who died in infancy.",
                    pmh: "Spinal muscular atrophy (known diagnosis), scoliosis",
                    medications: "Nusinersen injections, respiratory support"
                },
                physicalExam: {
                    inspection: "Severe muscle atrophy, scoliosis, fasciculations in tongue",
                    palpation: "Diffuse muscle atrophy, particularly proximal",
                    rom: "Contractures at hips and knees",
                    strength: "Severe proximal weakness (1-2/5), distal muscles relatively preserved",
                    sensation: "Normal throughout",
                    reflexes: "Absent throughout",
                    specialTests: "Tongue fasciculations, weak cough, difficulty swallowing"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Reduced amplitude (3.2 mV), normal latency and conduction velocity",
                        interpretation: "Reduced motor units but normal nerve conduction"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Reduced amplitude, normal conduction parameters",
                        interpretation: "Motor neuron loss"
                    },
                    {
                        name: "All sensory studies",
                        result: "normal",
                        findings: "Normal amplitudes and latencies",
                        interpretation: "No sensory involvement"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Deltoid",
                        findings: "Widespread fasciculations, large polyphasic motor units",
                        interpretation: "Chronic denervation with reinnervation"
                    },
                    {
                        muscle: "Biceps",
                        findings: "Fasciculations, giant motor units, reduced recruitment",
                        interpretation: "Chronic motor neuron disease"
                    },
                    {
                        muscle: "Tongue",
                        findings: "Fasciculations and fibrillations",
                        interpretation: "Bulbar motor neuron involvement"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "Spinal Muscular Atrophy Type II (Intermediate)",
                explanation: "Genetic motor neuron disease caused by SMN1 gene mutations. Type II presents in childhood with progressive proximal weakness, fasciculations, and preserved sensation. Distinguished from ALS by early onset, family history, and specific genetic pattern."
            },
            'toxicneuropathy': {
                title: "Progressive Painful Neuropathy",
                presentation: {
                    age: 52,
                    gender: "Male",
                    occupation: "Factory Worker (Chemical Plant)",
                    chiefComplaint: "6-month history of progressive burning feet and hand numbness",
                    history: "Insidious onset burning pain in feet, progressing to hands over several months. Works in chemical plant with exposure to organic solvents. Symptoms worse at night, interfering with sleep. Progressive weakness in feet making walking difficult. Coworkers have similar complaints.",
                    pmh: "No diabetes, no alcohol abuse",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "No visible deformities, mild pes cavus",
                    palpation: "No specific tenderness",
                    rom: "Full ROM",
                    strength: "Mild distal weakness, toe dorsiflexion 4/5, hand intrinsics 4/5",
                    sensation: "Decreased vibration and pinprick in stocking-glove distribution",
                    reflexes: "Absent ankle reflexes, diminished throughout",
                    specialTests: "Negative Romberg, gait with mild foot drop"
                },
                ncsStudies: [
                    {
                        name: "Sural Sensory",
                        result: "abnormal",
                        findings: "Severely reduced amplitude (2 μV), mildly slow velocity (38 m/s)",
                        interpretation: "Axonal sensory neuropathy"
                    },
                    {
                        name: "Median Sensory",
                        result: "abnormal", 
                        findings: "Reduced amplitude, mildly prolonged latency",
                        interpretation: "Distal axonal neuropathy"
                    },
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal",
                        findings: "Low amplitude (1.2 mV), normal velocity",
                        interpretation: "Axonal motor neuropathy"
                    },
                    {
                        name: "Tibial Motor (AHB)",
                        result: "abnormal",
                        findings: "Reduced amplitude, normal conduction velocity",
                        interpretation: "Length-dependent axonal neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Extensor digitorum brevis",
                        findings: "Fibrillations and positive sharp waves, reduced recruitment",
                        interpretation: "Active denervation"
                    },
                    {
                        muscle: "Tibialis anterior",
                        findings: "Chronic denervation changes with large motor units",
                        interpretation: "Chronic axonal neuropathy"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Toxic Polyneuropathy (Solvent Exposure)",
                explanation: "Length-dependent axonal polyneuropathy caused by chronic exposure to organic solvents. Key features: occupational exposure, predominantly sensory symptoms with burning pain, distal axonal pattern on NCS, and similar symptoms in coworkers suggesting environmental cause."
            },
            'postviralguillainbarre': {
                title: "Acute Ascending Weakness",
                presentation: {
                    age: 34,
                    gender: "Female", 
                    occupation: "Teacher",
                    chiefComplaint: "Rapidly progressive weakness in legs and arms over 5 days",
                    history: "2 weeks ago had viral gastroenteritis with diarrhea. 5 days ago developed tingling in toes, followed by progressive weakness ascending from feet to hands. Now has difficulty walking and using hands. No respiratory symptoms yet but concerned about breathing.",
                    pmh: "Recent viral gastroenteritis 2 weeks ago",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "No muscle atrophy, appears anxious",
                    palpation: "No muscle tenderness",
                    rom: "Full passive ROM",
                    strength: "Symmetric weakness: legs 3/5 distal, 4/5 proximal; arms 4/5 distal, 4+/5 proximal",
                    sensation: "Decreased vibration in feet, mild numbness in fingertips",
                    reflexes: "Absent throughout all extremities",
                    specialTests: "Negative Babinski, normal cranial nerves, vital capacity 80% predicted"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Prolonged distal latency (6.2 ms), conduction block, slow velocity (38 m/s)",
                        interpretation: "Demyelinating motor neuropathy with conduction block"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "abnormal",
                        findings: "Prolonged F-wave latency, temporal dispersion",
                        interpretation: "Proximal demyelination"
                    },
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal",
                        findings: "Absent response at ankle stimulation",
                        interpretation: "Severe demyelinating neuropathy"
                    },
                    {
                        name: "Median Sensory",
                        result: "abnormal",
                        findings: "Prolonged latency, reduced amplitude",
                        interpretation: "Sensory nerve involvement"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Abductor pollicis brevis",
                        findings: "Normal spontaneous activity, reduced recruitment",
                        interpretation: "Acute demyelination without denervation yet"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Guillain-Barré Syndrome (AIDP variant)",
                explanation: "Acute inflammatory demyelinating polyneuropathy following viral infection. Classic features: ascending weakness after infection, areflexia, demyelinating pattern on NCS with conduction blocks and prolonged latencies. Requires urgent monitoring for respiratory involvement."
            },
            'hereditaryneuropathy': {
                title: "Family History of Foot Problems",
                presentation: {
                    age: 28,
                    gender: "Male",
                    occupation: "Physical Therapist",
                    chiefComplaint: "Lifelong foot deformities and recent ankle sprains",
                    history: "Born with high arched feet, frequent ankle sprains since childhood. Mother and grandfather had similar foot problems and weakness. Recently noticed weakness in hands, difficulty with fine motor tasks. Progressive symptoms but very slowly. No acute illnesses.",
                    pmh: "Multiple ankle sprains, no other medical problems",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "High arched feet (pes cavus), hammer toes, mild hand atrophy",
                    palpation: "Atrophic intrinsic foot muscles",
                    rom: "Limited ankle dorsiflexion due to contractures",
                    strength: "Distal weakness: foot dorsiflexion 3/5, foot inversion 4/5, hand intrinsics 4/5",
                    sensation: "Decreased vibration in feet and hands",
                    reflexes: "Absent ankle reflexes, diminished elsewhere",
                    specialTests: "Steppage gait, positive family history"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal",
                        findings: "Mildly reduced amplitude, slow velocity (42 m/s)",
                        interpretation: "Mild demyelinating motor neuropathy"
                    },
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal", 
                        findings: "Low amplitude (1.5 mV), slow velocity (38 m/s)",
                        interpretation: "Demyelinating neuropathy with axonal loss"
                    },
                    {
                        name: "Median Sensory",
                        result: "abnormal",
                        findings: "Absent response",
                        interpretation: "Severe sensory nerve involvement"
                    },
                    {
                        name: "Sural Sensory",
                        result: "abnormal",
                        findings: "Absent response",
                        interpretation: "Chronic sensory neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Extensor digitorum brevis",
                        findings: "Chronic denervation with large motor units",
                        interpretation: "Chronic neurogenic changes"
                    },
                    {
                        muscle: "Abductor pollicis brevis",
                        findings: "Mild chronic denervation changes",
                        interpretation: "Progressive motor neuropathy"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "intermediate",
                correctDiagnosis: "Charcot-Marie-Tooth Disease (CMT1A)",
                explanation: "Hereditary sensorimotor neuropathy with autosomal dominant inheritance. Classic features: pes cavus, distal weakness, positive family history, uniform slowing on NCS, and chronic progressive course. Genetic testing confirms PMP22 duplication."
            },
            'metabolicmyopathy': {
                title: "Exercise Intolerance and Muscle Pain",
                presentation: {
                    age: 25,
                    gender: "Female",
                    occupation: "Graduate Student",
                    chiefComplaint: "Lifelong exercise intolerance with muscle pain and fatigue",
                    history: "Since childhood, develops severe muscle pain and fatigue with moderate exercise. Episodes of dark urine after strenuous activity. Cannot keep up with peers during physical activity. Symptoms improve with rest and carbohydrate intake. Family history of similar symptoms in brother.",
                    pmh: "Recurrent episodes of myoglobinuria",
                    medications: "None"
                },
                physicalExam: {
                    inspection: "Normal muscle bulk, no atrophy",
                    palpation: "No muscle tenderness at rest",
                    rom: "Full ROM",
                    strength: "Normal strength at rest (5/5 throughout)",
                    sensation: "Normal throughout",
                    reflexes: "Normal and symmetric (2+ throughout)",
                    specialTests: "Ischemic forearm test planned, normal baseline strength"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "normal",
                        findings: "Normal amplitude, latency, and conduction velocity",
                        interpretation: "No peripheral neuropathy"
                    },
                    {
                        name: "Ulnar Motor (ADM)",
                        result: "normal",
                        findings: "Normal parameters throughout",
                        interpretation: "Normal nerve conduction"
                    },
                    {
                        name: "All sensory studies",
                        result: "normal",
                        findings: "Normal amplitudes and latencies",
                        interpretation: "No sensory neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Deltoid",
                        findings: "Normal spontaneous activity, normal motor unit morphology",
                        interpretation: "No evidence of myopathy at rest"
                    },
                    {
                        muscle: "Quadriceps",
                        findings: "Normal baseline findings",
                        interpretation: "Normal muscle membrane stability"
                    },
                    {
                        muscle: "Ischemic forearm test",
                        findings: "No rise in serum lactate with anaerobic exercise",
                        interpretation: "Suggests glycolytic enzyme deficiency"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "McArdle Disease (Glycogen Storage Disease Type V)",
                explanation: "Metabolic myopathy due to muscle phosphorylase deficiency. Key features: exercise intolerance, myoglobinuria, normal strength at rest, normal EMG at baseline, and abnormal ischemic forearm test (no lactate rise). Requires enzyme testing or genetic analysis for confirmation."
            },
            'criticalillnessmyopathy': {
                title: "Post-ICU Weakness with Elevated CK",
                presentation: {
                    age: 48,
                    gender: "Male",
                    occupation: "Construction Worker",
                    chiefComplaint: "Severe weakness after prolonged ICU stay for COVID-19",
                    history: "Hospitalized 8 weeks ago with severe COVID-19, required mechanical ventilation for 4 weeks. Received high-dose steroids and neuromuscular blocking agents. Now has severe proximal and distal weakness, worse than expected for polyneuropathy alone. CK elevated at 2800 U/L.",
                    pmh: "Hypertension, obesity",
                    medications: "Prednisone (tapering), multiple ICU medications"
                },
                physicalExam: {
                    inspection: "Generalized muscle atrophy, more prominent proximally",
                    palpation: "Muscle atrophy without specific tenderness",
                    rom: "Full passive ROM, limited active movement",
                    strength: "Severe weakness: proximal 2/5, distal 3/5 in all extremities",
                    sensation: "Mild stocking-glove sensory loss",
                    reflexes: "Absent throughout",
                    specialTests: "Difficulty with ventilator weaning, elevated CK"
                },
                ncsStudies: [
                    {
                        name: "Median Motor (APB)",
                        result: "abnormal", 
                        findings: "Reduced amplitude (2.1 mV), normal velocity",
                        interpretation: "Axonal motor neuropathy component"
                    },
                    {
                        name: "Peroneal Motor (EDB)",
                        result: "abnormal",
                        findings: "Low amplitude (0.8 mV)",
                        interpretation: "Severe axonal neuropathy"
                    },
                    {
                        name: "Sensory studies",
                        result: "abnormal",
                        findings: "Reduced amplitudes in distal nerves",
                        interpretation: "Mild sensory axonal neuropathy"
                    }
                ],
                emgStudies: [
                    {
                        muscle: "Deltoid",
                        findings: "Fibrillations, positive sharp waves, small polyphasic motor units",
                        interpretation: "Combined myopathic and neurogenic features"
                    },
                    {
                        muscle: "Quadriceps",
                        findings: "Abundant spontaneous activity, mixed motor unit sizes",
                        interpretation: "Acute myopathy with membrane instability"
                    },
                    {
                        muscle: "Biceps",
                        findings: "Myopathic motor units with spontaneous activity",
                        interpretation: "Necrotizing myopathy pattern"
                    }
                ],
                requiresEMG: true,
                emgIndication: "INDICATED",
                difficulty: "difficult",
                correctDiagnosis: "Critical Illness Myopathy with Polyneuropathy",
                explanation: "Combined critical illness myopathy and polyneuropathy (CIM/CIP) following prolonged ICU stay. Features: severe weakness, elevated CK, mixed EMG pattern with both myopathic and neurogenic changes, worse than neuropathy alone. Associated with steroids, paralytics, and systemic inflammation."
            }
        };

        function startCase(caseId) {
            // Remove selected class from all buttons
            const buttons = document.querySelectorAll('.complaint-button');
            buttons.forEach(button => button.classList.remove('selected'));
            
            // Add selected class to clicked button
            event.target.classList.add('selected');
            
            const differentialDiv = document.getElementById('differential-results');
            differentialDiv.style.display = 'block';
            
            let content = '';
            
            switch(complaint) {
                case 'hand14':
                    content = `
                        <h3>Hand Pain/Paresthesias (Digits 1-4)</h3>
                        <div class="differential-category">
                            <h4>Focal Neuropathies</h4>
                            <div class="differential-item">
                                <strong>Carpal Tunnel Syndrome:</strong> Median nerve entrapment at wrist. Most common. Night symptoms, thenar weakness.
                            </div>
                            <div class="differential-item">
                                <strong>Pronator Syndrome:</strong> Median nerve entrapment in forearm. Proximal forearm pain, no night symptoms.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Radiculopathy</h4>
                            <div class="differential-item">
                                <strong>C6 Radiculopathy:</strong> Neck pain, biceps weakness, thumb/index numbness.
                            </div>
                            <div class="differential-item">
                                <strong>C7 Radiculopathy:</strong> Middle finger numbness, triceps weakness.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Other Considerations</h4>
                            <div class="differential-item">
                                <strong>Polyneuropathy:</strong> Usually starts distally, bilateral, length-dependent.
                            </div>
                            <div class="differential-item">
                                <strong>Cervical Myelopathy:</strong> Upper motor neuron signs, bilateral symptoms.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'hand45':
                    content = `
                        <h3>Hand Pain/Paresthesias (Digits 4-5)</h3>
                        <div class="differential-category">
                            <h4>Focal Neuropathies</h4>
                            <div class="differential-item">
                                <strong>Ulnar Neuropathy at Elbow:</strong> Most common. Cubital tunnel syndrome, progressive hand weakness.
                            </div>
                            <div class="differential-item">
                                <strong>Ulnar Neuropathy at Wrist:</strong> Guyon's canal, cyclist's palsy, hypothenar weakness.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Radiculopathy</h4>
                            <div class="differential-item">
                                <strong>C8 Radiculopathy:</strong> Medial forearm pain, hand intrinsic weakness, Horner's syndrome possible.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Plexopathy</h4>
                            <div class="differential-item">
                                <strong>Lower Trunk Brachial Plexopathy:</strong> C8-T1 involvement, Pancoast tumor, neurogenic TOS.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'thenar':
                    content = `
                        <h3>Thenar Weakness</h3>
                        <div class="differential-category">
                            <h4>Focal Neuropathies</h4>
                            <div class="differential-item">
                                <strong>Carpal Tunnel Syndrome:</strong> Progressive median nerve compression, APB weakness.
                            </div>
                            <div class="differential-item">
                                <strong>Recurrent Motor Branch Injury:</strong> Pure motor branch of median nerve at wrist.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Radiculopathy</h4>
                            <div class="differential-item">
                                <strong>C6/C7 Radiculopathy:</strong> Neck pain, broader weakness pattern, reflex changes.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Anterior Horn Cell</h4>
                            <div class="differential-item">
                                <strong>ALS:</strong> Progressive weakness, fasciculations, upper motor neuron signs.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'radicular':
                    content = `
                        <h3>Radicular Weakness Pattern</h3>
                        <div class="differential-category">
                            <h4>Cervical Radiculopathy</h4>
                            <div class="differential-item">
                                <strong>C5:</strong> Deltoid, biceps weakness. Axillary/musculocutaneous nerve pattern.
                            </div>
                            <div class="differential-item">
                                <strong>C6:</strong> Biceps, brachioradialis weakness. Lateral forearm numbness.
                            </div>
                            <div class="differential-item">
                                <strong>C7:</strong> Triceps, wrist extensors weakness. Middle finger numbness.
                            </div>
                            <div class="differential-item">
                                <strong>C8:</strong> Hand intrinsics, FDP weakness. Medial forearm numbness.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Lumbar Radiculopathy</h4>
                            <div class="differential-item">
                                <strong>L4:</strong> Quadriceps weakness, knee reflex loss, medial leg numbness.
                            </div>
                            <div class="differential-item">
                                <strong>L5:</strong> Dorsiflexors, EHL weakness, lateral leg numbness.
                            </div>
                            <div class="differential-item">
                                <strong>S1:</strong> Plantarflexors, ankle reflex loss, lateral foot numbness.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Mimics</h4>
                            <div class="differential-item">
                                <strong>Plexopathy:</strong> Multiple nerve territories, trauma history.
                            </div>
                            <div class="differential-item">
                                <strong>Multiple Mononeuropathies:</strong> Diabetes, vasculitis.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'dropfoot':
                    content = `
                        <h3>Drop Foot</h3>
                        <div class="differential-category">
                            <h4>Focal Neuropathies</h4>
                            <div class="differential-item">
                                <strong>Fibular (Peroneal) Neuropathy:</strong> Most common. Compression at fibular head, footdrop with eversion.
                            </div>
                            <div class="differential-item">
                                <strong>Deep Fibular Neuropathy:</strong> Anterior compartment syndrome, weak dorsiflexion only.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Radiculopathy</h4>
                            <div class="differential-item">
                                <strong>L5 Radiculopathy:</strong> Back pain, EHL weakness, lateral leg numbness, normal eversion.
                            </div>
                            <div class="differential-item">
                                <strong>L4 Radiculopathy:</strong> Quadriceps weakness, tibialis anterior involvement.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Other Causes</h4>
                            <div class="differential-item">
                                <strong>Lumbosacral Plexopathy:</strong> Multiple nerve involvement, trauma/tumor.
                            </div>
                            <div class="differential-item">
                                <strong>Sciatic Neuropathy:</strong> High division, affects fibular > tibial.
                            </div>
                            <div class="differential-item">
                                <strong>Central Causes:</strong> Stroke, spinal cord lesion, upper motor neuron signs.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'knee':
                    content = `
                        <h3>Knee Extension Weakness</h3>
                        <div class="differential-category">
                            <h4>Focal Neuropathies</h4>
                            <div class="differential-item">
                                <strong>Femoral Neuropathy:</strong> Diabetes, retroperitoneal hematoma, inguinal surgery.
                            </div>
                            <div class="differential-item">
                                <strong>Saphenous Neuropathy:</strong> Sensory only, medial leg numbness.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Radiculopathy</h4>
                            <div class="differential-item">
                                <strong>L4 Radiculopathy:</strong> Back pain, knee reflex loss, medial leg numbness.
                            </div>
                            <div class="differential-item">
                                <strong>L2/L3 Radiculopathy:</strong> Hip flexor weakness, anterior thigh pain.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Plexopathy</h4>
                            <div class="differential-item">
                                <strong>Lumbar Plexopathy:</strong> Diabetes, tumor, radiation, multiple nerves.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Myopathy</h4>
                            <div class="differential-item">
                                <strong>Inflammatory Myopathy:</strong> Proximal weakness, elevated CK, myopathic EMG.
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'brachial':
                    content = `
                        <h3>Brachial Plexopathy Syndromes</h3>
                        <div class="differential-category">
                            <h4>Upper Trunk (C5-C6)</h4>
                            <div class="differential-item">
                                <strong>Erb's Palsy:</strong> Birth trauma, motorcycle accident. Deltoid, biceps, supraspinatus weakness.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Lower Trunk (C8-T1)</h4>
                            <div class="differential-item">
                                <strong>Klumpke's Palsy:</strong> Hand intrinsic weakness, Horner's syndrome possible.
                            </div>
                            <div class="differential-item">
                                <strong>Pancoast Tumor:</strong> Lower trunk involvement, pain, weight loss.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Idiopathic/Inflammatory</h4>
                            <div class="differential-item">
                                <strong>Parsonage-Turner Syndrome:</strong> Acute onset, severe pain followed by weakness.
                            </div>
                        </div>
                        <div class="differential-category">
                            <h4>Traumatic</h4>
                            <div class="differential-item">
                                <strong>Stretch Injury:</strong> Motor vehicle accident, surgical positioning.
                            </div>
                            <div class="differential-item">
                                <strong>Radiation Plexopathy:</strong> Late complication, usually upper trunk.
                            </div>
                        </div>
                    `;
                    break;
            }
            
            differentialDiv.innerHTML = content;
        }
        
        // Essential utility functions
        function updateProgress(percentage) {
            document.getElementById('progress-fill').style.width = percentage + '%';
        }

        // Smart differential analysis with synonym recognition
        function analyzeDifferential() {
            const userInput = document.getElementById('user-differential').value.toLowerCase();
            const expectedDifferentials = currentCase.expectedDifferential || [];
            const feedbackDiv = document.getElementById('differential-feedback');
            
            if (!userInput.trim()) {
                feedbackDiv.innerHTML = `
                    <div class="feedback-card error">
                        <h4>🤔 Missing Input</h4>
                        <p>Please enter your differential diagnosis first!</p>
                    </div>
                `;
                return;
            }
            
            // Check for insufficient input (too short to be meaningful)
            if (userInput.trim().length < 3) {
                feedbackDiv.innerHTML = `
                    <div class="feedback-card warning">
                        <h4>🤔 Need More Detail</h4>
                        <p>Please provide more detailed input. Single letters or very short text cannot be properly analyzed.</p>
                        <p><strong>Example:</strong> Try entering actual diagnoses like "carpal tunnel syndrome" or abbreviations like "CTS".</p>
                    </div>
                `;
                return;
            }
            
            // Enhanced synonym dictionary for smart recognition
            const synonyms = {
                'cts': ['carpal tunnel syndrome', 'carpal tunnel', 'median neuropathy at wrist'],
                'carpal tunnel': ['cts', 'carpal tunnel syndrome', 'median neuropathy'],
                'cuts': ['cubital tunnel syndrome', 'ulnar neuropathy at elbow', 'ulnar entrapment'],
                'cubital tunnel': ['cuts', 'ulnar neuropathy', 'ulnar entrapment at elbow'],
                'radiculopathy': ['nerve root compression', 'pinched nerve', 'disc herniation'],
                'polyneuropathy': ['peripheral neuropathy', 'distal neuropathy', 'diabetic neuropathy'],
                'myopathy': ['muscle disease', 'muscular disorder', 'muscle weakness'],
                'als': ['amyotrophic lateral sclerosis', 'motor neuron disease', 'lou gehrig'],
                'guillain barre': ['gbs', 'guillain-barre syndrome', 'acute inflammatory demyelinating polyneuropathy', 'aidp'],
                'gbs': ['guillain barre', 'guillain-barre syndrome'],
                'cmt': ['charcot marie tooth', 'charcot-marie-tooth disease', 'hereditary neuropathy'],
                'tarsal tunnel': ['tibial neuropathy at ankle', 'posterior tibial neuropathy'],
                'peroneal neuropathy': ['fibular neuropathy', 'common peroneal neuropathy', 'foot drop'],
                'plexopathy': ['brachial plexopathy', 'lumbosacral plexopathy', 'plexus injury'],
                'myasthenia': ['mg', 'myasthenia gravis', 'neuromuscular junction disorder'],
                'stroke': ['cva', 'cerebrovascular accident', 'brain infarct', 'hemiplegia']
            };
            
            // Smart matching function with proper minimum length requirements
            function isMatch(userText, diagnosis) {
                const diagnosisLower = diagnosis.toLowerCase();
                const userLower = userText.toLowerCase().trim();
                
                // Minimum input length requirement - must be at least 3 characters
                if (userLower.length < 3) {
                    return false;
                }
                
                // Direct substring match (only if user input is meaningful)
                if (userLower.length >= 4) {
                    if (diagnosisLower.includes(userLower)) {
                        return true;
                    }
                }
                
                // Check synonyms (only with meaningful input)
                for (const [key, values] of Object.entries(synonyms)) {
                    if (key.length >= 3 && userLower.includes(key)) {
                        return values.some(synonym => diagnosisLower.includes(synonym));
                    }
                    if (diagnosisLower.includes(key)) {
                        return values.some(synonym => synonym.length >= 3 && userLower.includes(synonym));
                    }
                    if (values.some(synonym => synonym.length >= 3 && userLower.includes(synonym) && diagnosisLower.includes(key))) {
                        return true;
                    }
                }
                
                // Check individual keywords (with stricter matching)
                const diagnosisWords = diagnosisLower.split(' ').filter(word => word.length > 4);
                const userWords = userLower.split(' ').filter(word => word.length > 3);
                
                // Require at least 4-character overlap for word matching
                return diagnosisWords.some(diagWord => 
                    userWords.some(userWord => {
                        if (userWord.length >= 4 && diagWord.length >= 4) {
                            return diagWord.includes(userWord) || (userWord.length >= 5 && userWord.includes(diagWord));
                        }
                        return false;
                    })
                );
            }
            
            let matchedDiagnoses = [];
            let missedDiagnoses = [];
            
            expectedDifferentials.forEach(diagnosis => {
                if (isMatch(userInput, diagnosis)) {
                    matchedDiagnoses.push(diagnosis);
                } else {
                    missedDiagnoses.push(diagnosis);
                }
            });
            
            // Generate enhanced feedback
            let feedbackHTML = `
                <div class="analysis-header">
                    <h3>🧠 Smart Differential Analysis</h3>
                    <p>AI-powered recognition with medical abbreviations</p>
                </div>
            `;
            
            if (matchedDiagnoses.length > 0) {
                feedbackHTML += `
                    <div class="feedback-card success">
                        <h4>✅ Great job! You considered:</h4>
                        <ul class="diagnosis-list">
                            ${matchedDiagnoses.map(dx => `<li class="matched-diagnosis">${dx}</li>`).join('')}
                        </ul>
                        <p class="feedback-note">These match your input. Well done on your clinical reasoning!</p>
                    </div>
                `;
            }
            
            if (missedDiagnoses.length > 0) {
                feedbackHTML += `
                    <div class="feedback-card suggestion">
                        <h4>💡 Also consider these possibilities:</h4>
                        <ul class="diagnosis-list">
                            ${missedDiagnoses.map(dx => `<li class="missed-diagnosis">${dx}</li>`).join('')}
                        </ul>
                        <p class="feedback-note">These are important differentials to keep in mind for this presentation.</p>
                    </div>
                `;
            }
            
            // Always show the complete expected differential list for educational value
            if (matchedDiagnoses.length === 0) {
                feedbackHTML += `
                    <div class="feedback-card warning">
                        <h4>🤔 Hmm, let's think about this...</h4>
                        <p>Your input didn't match the expected differentials. Here are the key diagnoses to consider for this presentation:</p>
                    </div>
                `;
            }
            
            // Always display the complete differential list for learning
            feedbackHTML += `
                <div class="feedback-card info">
                    <h4>📚 Complete Expected Differential Diagnoses:</h4>
                    <ul class="diagnosis-list">
                        ${expectedDifferentials.map(dx => `<li class="expected-diagnosis">${dx}</li>`).join('')}
                    </ul>
                    <p class="feedback-note"><strong>Learning Point:</strong> These are the primary differentials based on the clinical presentation. Consider how each fits with the patient's symptoms and examination findings.</p>
                    ${matchedDiagnoses.length === 0 ? '<p><strong>Tip:</strong> You can use abbreviations like "CTS" for carpal tunnel syndrome!</p>' : ''}
                </div>
            `;
            
            // Always show comprehensive feedback and allow continuation
            feedbackDiv.innerHTML = feedbackHTML;
            document.getElementById('continue-to-studies').style.display = 'inline-block';
            
            console.log('📊 Differential analysis complete - matches:', matchedDiagnoses.length, 'total expected:', expectedDifferentials.length);
        }

        function checkFinalDiagnosis() {
            const userDiagnosis = document.getElementById('final-diagnosis').value.trim();
            const feedbackDiv = document.getElementById('diagnosis-feedback');
            
            if (!userDiagnosis) {
                feedbackDiv.innerHTML = '<div class="feedback-card error"><h4>📝 Missing Input</h4><p>Please enter your diagnosis first.</p></div>';
                return;
            }
            
            // Simple matching to determine if user got it right or wrong
            const correctDiagnosis = currentCase.correctDiagnosis.toLowerCase();
            const userLower = userDiagnosis.toLowerCase();
            const isCorrect = correctDiagnosis.includes(userLower) || userLower.includes(correctDiagnosis) ||
                             correctDiagnosis.split(' ').some(word => userLower.includes(word) && word.length > 3);
            
            let feedbackHTML = `
                <div class="analysis-header">
                    <h3>🎯 Final Diagnosis Review</h3>
                    <p>Your diagnosis: "<em>${userDiagnosis}</em>"</p>
                </div>
            `;
            
            if (isCorrect) {
                feedbackHTML += `
                    <div class="feedback-card success">
                        <h4>✅ Excellent! You got it right!</h4>
                        <p><strong>Correct Diagnosis:</strong> ${currentCase.correctDiagnosis}</p>
                        <p><strong>Explanation:</strong> ${currentCase.explanation}</p>
                    </div>
                `;
            } else {
                feedbackHTML += `
                    <div class="feedback-card error">
                        <h4>🤔 Not quite - let's review</h4>
                        <p><strong>Your Answer:</strong> ${userDiagnosis}</p>
                    </div>
                    <div class="feedback-card info">
                        <h4>🎯 Correct Diagnosis: ${currentCase.correctDiagnosis}</h4>
                        <p><strong>Explanation:</strong> ${currentCase.explanation}</p>
                        ${currentCase.educationalNote ? `<p><strong>Educational Note:</strong> ${currentCase.educationalNote}</p>` : ''}
                    </div>
                `;
            }
            
            // Special handling for EMG not indicated cases
            if (currentCase.emgIndication === "NOT INDICATED") {
                feedbackHTML += `
                    <div class="feedback-card warning">
                        <h4>⚠️ Important Clinical Point</h4>
                        <p><strong>EMG/NCS was NOT indicated</strong> for this case because this represents upper motor neuron pathology.</p>
                        <p>${currentCase.educationalNote || 'EMG/NCS studies evaluate the peripheral nervous system and would be normal in central lesions.'}</p>
                    </div>
                `;
            }
            
            feedbackDiv.innerHTML = feedbackHTML;
        }

        // New streamlined interface functions
        // Difficulty selection and case management
        function toggleDifficulty(difficulty) {
            const toggle = document.getElementById(`${difficulty}-toggle`);
            const checkbox = document.getElementById(`${difficulty}-checkbox`);
            const statusText = toggle.querySelector('.status-text');
            
            if (toggle.classList.contains('active')) {
                // Turn OFF
                toggle.classList.remove('active');
                toggle.classList.add('inactive');
                checkbox.checked = false;
                statusText.textContent = 'INACTIVE';
            } else {
                // Turn ON
                toggle.classList.remove('inactive');
                toggle.classList.add('active');
                checkbox.checked = true;
                statusText.textContent = 'ACTIVE';
            }
            
            updateCaseDisplay();
        }
        
        function showCaseSelection() {
            document.getElementById('case-selection-section').style.display = 'block';
            populateCaseGrid();
            // Smooth scroll to case selection
            document.getElementById('case-selection-section').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }
        
        function hideCaseSelection() {
            document.getElementById('case-selection-section').style.display = 'none';
        }
        
        function updateCaseDisplay() {
            const beginnerChecked = document.getElementById('beginner-checkbox').checked;
            const intermediateChecked = document.getElementById('intermediate-checkbox').checked;
            const difficultChecked = document.getElementById('difficult-checkbox').checked;
            
            populateCaseGrid();
        }
        
        function populateCaseGrid() {
            const caseGrid = document.getElementById('case-grid');
            const beginnerChecked = document.getElementById('beginner-checkbox').checked;
            const intermediateChecked = document.getElementById('intermediate-checkbox').checked;
            const difficultChecked = document.getElementById('difficult-checkbox').checked;
            
            let html = '';
            
            for (const [caseId, caseData] of Object.entries(caseDatabase)) {
                const difficulty = caseData.difficulty || 'intermediate';
                
                // Filter based on selected difficulties
                if ((difficulty === 'beginner' && !beginnerChecked) ||
                    (difficulty === 'intermediate' && !intermediateChecked) ||
                    (difficulty === 'difficult' && !difficultChecked)) {
                    continue;
                }
                
                const difficultyClass = difficulty;
                const difficultyText = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
                
                html += `
                    <div class="case-card" onclick="toggleCaseSelection('${caseId}')" id="case-${caseId}">
                        <input type="checkbox" id="checkbox-${caseId}" onchange="event.stopPropagation(); updateCaseCard('${caseId}')">
                        <h4>${caseData.title}</h4>
                        <p><strong>Age:</strong> ${caseData.presentation.age} | <strong>Gender:</strong> ${caseData.presentation.gender}</p>
                        <p>${caseData.presentation.chiefComplaint}</p>
                        <span class="difficulty ${difficultyClass}">${difficultyText}</span>
                    </div>
                `;
            }
            
            caseGrid.innerHTML = html;
        }
        
        function toggleCaseSelection(caseId) {
            const checkbox = document.getElementById(`checkbox-${caseId}`);
            const caseCard = document.getElementById(`case-${caseId}`);
            
            checkbox.checked = !checkbox.checked;
            updateCaseCard(caseId);
        }
        
        function updateCaseCard(caseId) {
            const checkbox = document.getElementById(`checkbox-${caseId}`);
            const caseCard = document.getElementById(`case-${caseId}`);
            
            if (checkbox.checked) {
                caseCard.classList.add('selected');
            } else {
                caseCard.classList.remove('selected');
            }
        }
        
        function selectAllCases() {
            const checkboxes = document.querySelectorAll('#case-grid input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                const caseId = checkbox.id.replace('checkbox-', '');
                updateCaseCard(caseId);
            });
        }
        
        function deselectAllCases() {
            const checkboxes = document.querySelectorAll('#case-grid input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                const caseId = checkbox.id.replace('checkbox-', '');
                updateCaseCard(caseId);
            });
        }
        
        function getSelectedCases() {
            const selectedCases = [];
            const checkboxes = document.querySelectorAll('#case-grid input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                const caseId = checkbox.id.replace('checkbox-', '');
                selectedCases.push(caseId);
            });
            return selectedCases;
        }
        
        function startSelectedCases() {
            const selectedCases = getSelectedCases();
            if (selectedCases.length === 0) {
                alert('Please select at least one case first.');
                return;
            }
            
            // Start with first selected case for now
            // Could be enhanced to create a queue of cases
            const randomSelected = selectedCases[Math.floor(Math.random() * selectedCases.length)];
            startSpecificCase(randomSelected);
        }
        
        function startRandomCaseByDifficulty() {
            const beginnerChecked = document.getElementById('beginner-checkbox').checked;
            const intermediateChecked = document.getElementById('intermediate-checkbox').checked;
            const difficultChecked = document.getElementById('difficult-checkbox').checked;
            
            if (!beginnerChecked && !intermediateChecked && !difficultChecked) {
                alert('Please select at least one difficulty level first.');
                return;
            }
            
            const availableCases = [];
            for (const [caseId, caseData] of Object.entries(caseDatabase)) {
                const difficulty = caseData.difficulty || 'intermediate';
                
                if ((difficulty === 'beginner' && beginnerChecked) ||
                    (difficulty === 'intermediate' && intermediateChecked) ||
                    (difficulty === 'difficult' && difficultChecked)) {
                    availableCases.push(caseId);
                }
            }
            
            if (availableCases.length === 0) {
                alert('No cases available for the selected difficulty levels.');
                return;
            }
            
            const randomId = availableCases[Math.floor(Math.random() * availableCases.length)];
            startSpecificCase(randomId);
        }

        function startRandomCase() {
            // Use all cases for random selection
            const allCaseIds = Object.keys(caseDatabase);
            const randomId = allCaseIds[Math.floor(Math.random() * allCaseIds.length)];
            startSpecificCase(randomId);
        }

        function startSpecificCase(caseId) {
            if (!caseDatabase[caseId]) {
                alert('Case not available yet. Please try another case.');
                return;
            }

            currentCase = caseDatabase[caseId];
            currentStep = 1;  // Reset step for fresh start
            userDifferential = '';  // Clear previous differential
            
            // Hide case selection, show case interface
            document.getElementById('case-selection').style.display = 'none';
            document.getElementById('case-interface').style.display = 'block';
            
            // Populate case details
            populateCaseDetails();
            
            // Reset interface
            showCasePresentation();
            updateProgress(20);
        }

        function populateCaseDetails() {
            const case_ = currentCase;
            const caseDetailsDiv = document.getElementById('case-details');
            
            // Present all cases neutrally - no red warnings
            caseDetailsDiv.innerHTML = `
                <h4>${case_.title}</h4>
                <p><strong>Age:</strong> ${case_.presentation.age} | <strong>Gender:</strong> ${case_.presentation.gender} | <strong>Occupation:</strong> ${case_.presentation.occupation}</p>
                <p><strong>Chief Complaint:</strong> ${case_.presentation.chiefComplaint}</p>
                <p><strong>History:</strong> ${case_.presentation.history}</p>
                <p><strong>PMH:</strong> ${case_.presentation.pmh}</p>
                <p><strong>Medications:</strong> ${case_.presentation.medications}</p>
            `;
            
            // Populate physical exam
            const examDiv = document.getElementById('physical-exam-details');
            const exam = case_.physicalExam;
            examDiv.innerHTML = `
                <div class="physical-exam">
                    <div class="exam-category">
                        <h5>👁️ Inspection</h5>
                        <p>${exam.inspection}</p>
                    </div>
                    <div class="exam-category">
                        <h5>👋 Palpation</h5>
                        <p>${exam.palpation}</p>
                    </div>
                    <div class="exam-category">
                        <h5>🔄 Range of Motion</h5>
                        <p>${exam.rom}</p>
                    </div>
                    <div class="exam-category">
                        <h5>💪 Strength</h5>
                        <p>${exam.strength}</p>
                    </div>
                    <div class="exam-category">
                        <h5>👆 Sensation</h5>
                        <p>${exam.sensation}</p>
                    </div>
                    <div class="exam-category">
                        <h5>🔨 Reflexes</h5>
                        <p>${exam.reflexes}</p>
                    </div>
                    <div class="exam-category">
                        <h5>🧪 Special Tests</h5>
                        <p>${exam.specialTests}</p>
                    </div>
                </div>
            `;
        }

        function showCasePresentation() {
            hideAllSteps();
            document.getElementById('case-presentation-step').style.display = 'block';
            updateProgress(20);
        }

        function showPhysicalExam() {
            hideAllSteps();
            document.getElementById('physical-exam-step').style.display = 'block';
            updateProgress(40);
        }

        function showDifferentialBuilder() {
            hideAllSteps();
            document.getElementById('differential-step').style.display = 'block';
            updateProgress(60);
        }

        function showEMGDecision() {
            hideAllSteps();
            document.getElementById('emg-decision-step').style.display = 'block';
            updateProgress(70);
        }

        let userEMGDecision = null;

        function makeEMGDecision(indicatedDecision) {
            userEMGDecision = indicatedDecision;
            const feedbackDiv = document.getElementById('emg-decision-feedback');
            const continueBtn = document.getElementById('continue-after-decision');
            const isEMGIndicated = currentCase.emgIndication !== "NOT INDICATED";
            
            if (indicatedDecision === true && isEMGIndicated) {
                // Correct: YES for peripheral case
                feedbackDiv.innerHTML = `
                    <div style="background: #f0fff4; border: 2px solid #27ae60; border-radius: 8px; padding: 20px;">
                        <h4 style="color: #27ae60;">✅ Correct Decision</h4>
                        <p>You correctly identified that this presentation warrants EMG/NCS evaluation. This appears to be a peripheral nervous system problem that would benefit from electrodiagnostic studies.</p>
                    </div>
                `;
                continueBtn.style.display = 'inline-block';
                continueBtn.textContent = 'Proceed to EMG/NCS Results →';
            } else if (indicatedDecision === false && !isEMGIndicated) {
                // Correct: NO for central case
                feedbackDiv.innerHTML = `
                    <div style="background: #f0fff4; border: 2px solid #27ae60; border-radius: 8px; padding: 20px;">
                        <h4 style="color: #27ae60;">✅ Excellent Clinical Judgment</h4>
                        <p>You correctly identified that EMG/NCS is <strong>not indicated</strong> in this case. The presentation suggests a central nervous system lesion with upper motor neuron signs.</p>
                        <div style="background: #e74c3c; color: white; padding: 15px; border-radius: 5px; margin-top: 15px;">
                            <h5>🚨 Immediate Management Required</h5>
                            <p>${currentCase.educationalNote}</p>
                        </div>
                    </div>
                `;
                continueBtn.style.display = 'inline-block';
                continueBtn.textContent = 'Complete Case Review →';
            } else if (indicatedDecision === false && isEMGIndicated) {
                // Incorrect: NO for peripheral case
                feedbackDiv.innerHTML = `
                    <div style="background: #fff5f5; border: 2px solid #e74c3c; border-radius: 8px; padding: 20px;">
                        <h4 style="color: #e74c3c;">❌ Reconsider Your Decision</h4>
                        <p>Actually, EMG/NCS <strong>would be appropriate</strong> in this case. This presentation suggests a peripheral nervous system problem that could be localized and characterized with electrodiagnostic studies.</p>
                        <p><strong>Learning Point:</strong> EMG/NCS is indicated when there are signs of peripheral nerve, muscle, or neuromuscular junction pathology.</p>
                    </div>
                `;
                continueBtn.style.display = 'inline-block';
                continueBtn.textContent = 'Proceed to EMG/NCS Results (Educational) →';
            } else {
                // Incorrect: YES for central case
                feedbackDiv.innerHTML = `
                    <div style="background: #fff5f5; border: 2px solid #e74c3c; border-radius: 8px; padding: 20px;">
                        <h4 style="color: #e74c3c;">❌ Reconsider Your Decision</h4>
                        <p>EMG/NCS would <strong>not be helpful</strong> in this case. The presence of upper motor neuron signs (hyperreflexia, Babinski sign, spasticity) suggests a central nervous system lesion.</p>
                        <p><strong>Learning Point:</strong> EMG/NCS evaluates the peripheral nervous system and would be normal in isolated central lesions.</p>
                        <div style="background: #e74c3c; color: white; padding: 15px; border-radius: 5px; margin-top: 15px;">
                            <h5>🚨 This Patient Needs:</h5>
                            <p>${currentCase.educationalNote}</p>
                        </div>
                    </div>
                `;
                continueBtn.style.display = 'inline-block';
                continueBtn.textContent = 'Complete Case Review →';
            }
        }

        function proceedAfterDecision() {
            const isEMGIndicated = currentCase.emgIndication !== "NOT INDICATED";
            
            if (userEMGDecision === true && isEMGIndicated) {
                // Show NCS results for appropriate case
                showNCSResults();
            } else if (userEMGDecision === false && !isEMGIndicated) {
                // End case appropriately for central cause
                showFinalDiagnosis();
            } else if (userEMGDecision === false && isEMGIndicated) {
                // Educational: show NCS results even though they said no
                showNCSResults();
            } else {
                // End case for central cause (they incorrectly said yes)
                showFinalDiagnosis();
            }
        }

        function showNCSResults() {
            hideAllSteps();
            document.getElementById('results-step').style.display = 'block';
            
            // Populate NCS results
            const ncsDiv = document.getElementById('ncs-results');
            if (currentCase.emgIndication === "NOT INDICATED") {
                ncsDiv.innerHTML = `
                    <div style="background: #fff5f5; border: 2px solid #e74c3c; border-radius: 8px; padding: 20px;">
                        <h4 style="color: #e74c3c;">⚠️ EMG/NCS NOT INDICATED</h4>
                        <p>${currentCase.explanation}</p>
                    </div>
                `;
            } else {
                let html = '';
                currentCase.ncsStudies.forEach(study => {
                    const resultClass = study.result === 'abnormal' ? 'abnormal-finding' : 'normal-finding';
                    html += `
                        <div class="ncs-study">
                            <h4>⚡ ${study.name}</h4>
                            <div class="${resultClass}">
                                <strong>Results:</strong> ${study.findings}
                            </div>
                            <p><strong>Interpretation:</strong> ${study.interpretation}</p>
                        </div>
                    `;
                });
                ncsDiv.innerHTML = html;
                
                // Show EMG results if required
                if (currentCase.requiresEMG && currentCase.emgStudies) {
                    document.getElementById('emg-results').style.display = 'block';
                    const emgDiv = document.getElementById('emg-details');
                    let emgHtml = '';
                    currentCase.emgStudies.forEach(study => {
                        emgHtml += `
                            <div style="margin: 15px 0; padding: 15px; background: #fff; border-left: 4px solid #f39c12; border-radius: 5px;">
                                <h5>${study.muscle}</h5>
                                <p><strong>Findings:</strong> ${study.findings}</p>
                                <p><strong>Interpretation:</strong> ${study.interpretation}</p>
                            </div>
                        `;
                    });
                    emgDiv.innerHTML = emgHtml;
                }
            }
            
            updateProgress(80);
        }

        function showFinalDiagnosis() {
            hideAllSteps();
            document.getElementById('diagnosis-step').style.display = 'block';
            updateProgress(100);
        }

        function hideAllSteps() {
            const steps = ['case-presentation-step', 'physical-exam-step', 'differential-step', 'emg-decision-step', 'results-step', 'diagnosis-step'];
            steps.forEach(stepId => {
                document.getElementById(stepId).style.display = 'none';
            });
        }

        function startNewCase() {
            // Reset all case state variables
            currentCase = null;
            currentStep = 1;
            userDifferential = '';
            
            // Reset interface
            document.getElementById('case-interface').style.display = 'none';
            document.getElementById('case-selection').style.display = 'block';
            
            // Clear form data
            document.getElementById('user-differential').value = '';
            document.getElementById('final-diagnosis').value = '';
            document.getElementById('differential-feedback').innerHTML = '';
            document.getElementById('diagnosis-feedback').innerHTML = '';
            document.getElementById('continue-to-studies').style.display = 'none';
            
            // Hide EMG results
            document.getElementById('emg-results').style.display = 'none';
            
            // Reset progress
            updateProgress(0);
            currentCase = null;
        }
        
        // Initialize videos when page loads
        function initializeVideos() {
            const videos = [
                {
                    title: "📍 Median Motor Study",
                    description: "Median motor nerve conduction technique for carpal tunnel evaluation",
                    recording: "Thenar muscles (APB)",
                    stimulation: "Wrist & elbow",
                    videoUrl: "https://www.youtube.com/embed/cdVrcgeBgIg"
                },
                {
                    title: "📍 Median Sensory Study",
                    description: "Median sensory nerve conduction study - digit 3 to wrist",
                    recording: "Digit 3 to wrist",
                    stimulation: "Orthodromic stimulation",
                    videoUrl: "https://www.youtube.com/embed/86j7cNLIX0U"
                },
                {
                    title: "📍 Ulnar Motor Study", 
                    description: "Ulnar motor nerve conduction technique with across-elbow segment",
                    recording: "Hypothenar muscles (ADM)",
                    stimulation: "Wrist, below & above elbow",
                    videoUrl: "https://www.youtube.com/embed/UmFYJDMucOY"
                },
                {
                    title: "📍 Ulnar Sensory Study",
                    description: "Ulnar sensory nerve conduction study - digit 5 to wrist", 
                    recording: "Digit 5 to wrist",
                    stimulation: "Orthodromic stimulation",
                    videoUrl: "https://www.youtube.com/embed/i9Naurf0eWU"
                },
                {
                    title: "📍 Dorsal Ulnar Cutaneous Study",
                    description: "DUC study for differentiating ulnar neuropathy location",
                    recording: "Dorsal hand to forearm",
                    stimulation: "Antidromic stimulation",
                    videoUrl: "https://www.youtube.com/embed/U-60ft_8klI"
                },
                {
                    title: "📍 Radial Sensory Study",
                    description: "Superficial radial sensory nerve conduction study",
                    recording: "Dorsal web space to forearm",
                    stimulation: "Antidromic stimulation",
                    videoUrl: "https://www.youtube.com/embed/nMaxrbpyR-0"
                },
                {
                    title: "📍 Common Fibular Motor Study",
                    description: "Common fibular (peroneal) motor nerve conduction for drop foot evaluation",
                    recording: "Extensor digitorum brevis (EDB)", 
                    stimulation: "Ankle, fibular head & popliteal fossa",
                    videoUrl: "https://www.youtube.com/embed/G1bsDinxuF8"
                },
                {
                    title: "📍 Superficial Fibular Study",
                    description: "Superficial fibular sensory nerve conduction study",
                    recording: "Lateral foot to leg",
                    stimulation: "Antidromic stimulation",
                    videoUrl: "https://www.youtube.com/embed/M1sE2FT8YQg"
                },
                {
                    title: "📍 Tibial Motor Study",
                    description: "Tibial motor nerve conduction technique",
                    recording: "Abductor hallucis (AH)",
                    stimulation: "Ankle, popliteal fossa",
                    videoUrl: "https://www.youtube.com/embed/pWeH6kCa9lo"
                },
                {
                    title: "📍 Sural Sensory Study",
                    description: "Sural sensory nerve conduction - important for polyneuropathy screening",
                    recording: "Lateral foot to calf",
                    stimulation: "Antidromic stimulation",
                    videoUrl: "https://www.youtube.com/embed/zP1yAU5DW2s"
                }
            ];
            
            const container = document.getElementById('video-grid');
            let html = '';
            
            videos.forEach(video => {
                html += `
                    <div class="video-card">
                        <h3>${video.title}</h3>
                        <div class="video-container">
                            <iframe width="100%" height="100%" src="${video.videoUrl}" 
                                    frameborder="0" allowfullscreen 
                                    title="${video.description}">
                            </iframe>
                        </div>
                        <div class="video-info">
                            <p><strong>Description:</strong> ${video.description}</p>
                            <p><strong>Recording:</strong> ${video.recording}</p>
                            <p><strong>Stimulation:</strong> ${video.stimulation}</p>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Advanced Muscle Localization Lab (Tab 8)
        window.AdvancedMuscleTest = {
            currentMode: 'regional',
            isTestActive: false,
            currentQuestion: null,
            stats: {
                questionsAnswered: 0,
                correctAnswers: 0,
                currentStreak: 0
            },
            
            setMode: function(mode) {
                this.currentMode = mode;
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.classList.remove('selected');
                });
                event.target.closest('.mode-card').classList.add('selected');
                console.log('🎯 Training mode set to:', mode);
            },
            
            startTest: function() {
                this.isTestActive = true;
                document.getElementById('advanced-muscle-test-modal').style.display = 'flex';
                this.generateQuestion();
                console.log('🚀 Advanced muscle test started');
            },
            
            stopTest: function() {
                this.isTestActive = false;
                document.getElementById('advanced-muscle-test-modal').style.display = 'none';
                console.log('⏹️ Advanced muscle test stopped');
            },
            
            generateQuestion: function() {
                const questions = this.getQuestionPool();
                this.currentQuestion = questions[Math.floor(Math.random() * questions.length)];
                this.displayQuestion();
            },
            
            getQuestionPool: function() {
                return [
                    {
                        muscle: "Flexor pollicis longus",
                        nerve: "Anterior interosseous nerve (branch of median)",
                        roots: "C7, C8, T1",
                        region: "UE",
                        context: "Patient unable to flex thumb IP joint, but thenar muscles intact"
                    },
                    {
                        muscle: "Extensor indicis proprius",
                        nerve: "Posterior interosseous nerve (branch of radial)",
                        roots: "C7, C8",
                        region: "UE",
                        context: "Isolated weakness of index finger extension"
                    },
                    {
                        muscle: "Tibialis posterior",
                        nerve: "Tibial nerve",
                        roots: "L4, L5",
                        region: "LE",
                        context: "Foot drop with preserved dorsiflexion but weak inversion"
                    }
                ];
            },
            
            displayQuestion: function() {
                const question = this.currentQuestion;
                document.getElementById('advanced-question-text').textContent = 
                    `What nerve innervates the ${question.muscle}?`;
                
                const options = this.generateAnswerOptions(question);
                this.displayAnswerOptions(options);
            },
            
            generateAnswerOptions: function(question) {
                const correct = question.nerve;
                const distractors = [
                    "Median nerve",
                    "Ulnar nerve", 
                    "Radial nerve",
                    "Tibial nerve",
                    "Common peroneal nerve"
                ].filter(option => option !== correct);
                
                const shuffled = [correct, ...distractors.slice(0, 3)].sort(() => Math.random() - 0.5);
                return shuffled.map((option, index) => ({
                    id: String.fromCharCode(65 + index),
                    text: option,
                    correct: option === correct
                }));
            },
            
            displayAnswerOptions: function(options) {
                const container = document.getElementById('advanced-answer-options');
                container.innerHTML = options.map(option => `
                    <div class="answer-option-advanced" data-answer="${option.id}" onclick="AdvancedMuscleTest.selectAnswer('${option.id}')">
                        <div class="option-letter">${option.id}</div>
                        <div class="option-text">${option.text}</div>
                    </div>
                `).join('');
            },
            
            selectAnswer: function(answerId) {
                document.querySelectorAll('.answer-option-advanced').forEach(option => {
                    option.classList.remove('selected');
                });
                document.querySelector(`[data-answer="${answerId}"]`).classList.add('selected');
                document.getElementById('advanced-submit-btn').disabled = false;
            },
            
            submitAnswer: function() {
                const selectedOption = document.querySelector('.answer-option-advanced.selected');
                if (!selectedOption) return;
                
                const isCorrect = this.checkAnswer(selectedOption.dataset.answer);
                this.updateStatsAfterAnswer(isCorrect);
                this.showFeedback(isCorrect);
                
                document.getElementById('advanced-submit-btn').style.display = 'none';
                document.getElementById('advanced-next-btn').style.display = 'block';
            },
            
            checkAnswer: function(answerId) {
                const options = this.generateAnswerOptions(this.currentQuestion);
                const selectedOption = options.find(opt => opt.id === answerId);
                return selectedOption && selectedOption.correct;
            },
            
            updateStatsAfterAnswer: function(isCorrect) {
                this.stats.questionsAnswered++;
                if (isCorrect) {
                    this.stats.correctAnswers++;
                    this.stats.currentStreak++;
                } else {
                    this.stats.currentStreak = 0;
                }
            },
            
            showFeedback: function(isCorrect) {
                const feedbackContainer = document.getElementById('advanced-feedback');
                const question = this.currentQuestion;
                
                feedbackContainer.innerHTML = `
                    <div class="feedback-card ${isCorrect ? 'correct' : 'incorrect'}">
                        <h4>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h4>
                        <p><strong>${question.muscle}</strong> is innervated by the <strong>${question.nerve}</strong></p>
                        <p><strong>Nerve roots:</strong> ${question.roots}</p>
                        <p><strong>Clinical context:</strong> ${question.context}</p>
                    </div>
                `;
            },
            
            nextQuestion: function() {
                document.getElementById('advanced-submit-btn').style.display = 'block';
                document.getElementById('advanced-next-btn').style.display = 'none';
                document.getElementById('advanced-submit-btn').disabled = true;
                document.getElementById('advanced-feedback').innerHTML = '';
                
                this.generateQuestion();
            },
            
            reviewMissed: function() {
                alert('Review missed questions functionality coming soon!');
            }
        };

        // EMG Localization Challenge (Tab 9)
        window.EMGChallenge = {
            currentSettings: {
                difficulty: 'moderate',
                region: 'mixed',
                type: 'localization'
            },
            isActive: false,
            currentCase: null,
            activeQuestionTypes: {
                root: true,
                trunk: true,
                cord: true,
                peripheral: true
            },
            
            lesionSites: {
                UE: {
                    'C5 nerve root': { type: 'root', muscles: ['Deltoid', 'Biceps brachii', 'Supraspinatus', 'Infraspinatus'] },
                    'C6 nerve root': { type: 'root', muscles: ['Biceps brachii', 'Brachioradialis', 'Extensor carpi radialis'] },
                    'C7 nerve root': { type: 'root', muscles: ['Triceps brachii', 'Extensor digitorum', 'Flexor carpi radialis'] },
                    'C8 nerve root': { type: 'root', muscles: ['First dorsal interosseous', 'Abductor pollicis brevis', 'Flexor carpi ulnaris'] },
                    'T1 nerve root': { type: 'root', muscles: ['First dorsal interosseous', 'Abductor pollicis brevis', 'Abductor digiti minimi'] },
                    'Upper trunk (C5-C6)': { type: 'trunk', muscles: ['Deltoid', 'Biceps brachii', 'Supraspinatus', 'Brachioradialis'] },
                    'Middle trunk (C7)': { type: 'trunk', muscles: ['Triceps brachii', 'Extensor digitorum', 'Flexor carpi radialis'] },
                    'Lower trunk (C8-T1)': { type: 'trunk', muscles: ['First dorsal interosseous', 'Abductor pollicis brevis', 'Flexor carpi ulnaris', 'Abductor digiti minimi'] },
                    'Posterior cord': { type: 'cord', muscles: ['Deltoid', 'Triceps brachii', 'Extensor digitorum', 'Brachioradialis'] },
                    'Medial cord': { type: 'cord', muscles: ['First dorsal interosseous', 'Abductor pollicis brevis', 'Flexor carpi ulnaris'] },
                    'Lateral cord': { type: 'cord', muscles: ['Biceps brachii', 'Brachialis', 'Pronator teres'] },
                    'Median nerve at wrist (carpal tunnel)': { type: 'peripheral', muscles: ['Abductor pollicis brevis', 'Opponens pollicis'] },
                    'Median nerve at forearm': { type: 'peripheral', muscles: ['Abductor pollicis brevis', 'Flexor pollicis longus', 'Pronator teres', 'Flexor carpi radialis'] },
                    'Ulnar nerve at wrist (Guyon canal)': { type: 'peripheral', muscles: ['First dorsal interosseous', 'Abductor digiti minimi', 'Adductor pollicis'] },
                    'Ulnar nerve at elbow': { type: 'peripheral', muscles: ['First dorsal interosseous', 'Flexor carpi ulnaris', 'Abductor digiti minimi'] },
                    'Radial nerve in spiral groove': { type: 'peripheral', muscles: ['Triceps brachii', 'Brachioradialis', 'Extensor digitorum'] },
                    'Posterior interosseous nerve': { type: 'peripheral', muscles: ['Extensor digitorum', 'Extensor pollicis longus'] },
                    'Axillary nerve': { type: 'peripheral', muscles: ['Deltoid', 'Teres minor'] },
                    'Suprascapular nerve': { type: 'peripheral', muscles: ['Supraspinatus', 'Infraspinatus'] }
                },
                LE: {
                    'L2 nerve root': { type: 'root', muscles: ['Iliopsoas (psoas major)', 'Adductor longus', 'Sartorius'] },
                    'L3 nerve root': { type: 'root', muscles: ['Rectus femoris', 'Vastus medialis', 'Adductor longus'] },
                    'L4 nerve root': { type: 'root', muscles: ['Tibialis anterior', 'Rectus femoris', 'Vastus medialis'] },
                    'L5 nerve root': { type: 'root', muscles: ['Extensor hallucis longus', 'Tibialis anterior', 'Gluteus medius', 'Biceps femoris (short head)'] },
                    'S1 nerve root': { type: 'root', muscles: ['Gastrocnemius', 'Gluteus maximus', 'Biceps femoris (long head)'] },
                    'Femoral nerve': { type: 'peripheral', muscles: ['Rectus femoris', 'Vastus medialis', 'Vastus lateralis', 'Sartorius'] },
                    'Peroneal nerve at fibular head': { type: 'peripheral', muscles: ['Tibialis anterior', 'Extensor hallucis longus', 'Fibularis longus'] },
                    'Deep peroneal nerve': { type: 'peripheral', muscles: ['Tibialis anterior', 'Extensor hallucis longus', 'Extensor digitorum brevis'] },
                    'Sciatic nerve': { type: 'peripheral', muscles: ['Biceps femoris (long head)', 'Semitendinosus', 'Gastrocnemius'] },
                    'Tibial nerve': { type: 'peripheral', muscles: ['Gastrocnemius', 'Soleus', 'Flexor hallucis longus'] },
                    'Superior gluteal nerve': { type: 'peripheral', muscles: ['Gluteus medius', 'Gluteus minimus', 'Tensor fasciae latae'] },
                    'Inferior gluteal nerve': { type: 'peripheral', muscles: ['Gluteus maximus'] }
                }
            },
            
            startChallenge: function() {
                this.isActive = true;
                
                document.getElementById('emg-challenge-setup').style.display = 'none';
                document.getElementById('emg-challenge-active').style.display = 'block';
                
                this.generateCase();
                console.log('🚀 EMG Challenge started');
            },
            
            toggleQuestionType: function(type) {
                console.log('🎯 Toggle called for:', type);
                // Toggle the state
                this.activeQuestionTypes[type] = !this.activeQuestionTypes[type];
                
                // Update UI
                const option = document.querySelector(`[data-type="${type}"]`);
                const indicator = option.querySelector('.status-indicator');
                const text = option.querySelector('.status-text');
                
                if (this.activeQuestionTypes[type]) {
                    option.classList.add('active');
                    indicator.classList.add('active');
                    text.textContent = 'Active';
                } else {
                    option.classList.remove('active');
                    indicator.classList.remove('active');
                    text.textContent = 'Inactive';
                }
                
                // Check if at least one type is active
                const hasActiveType = Object.values(this.activeQuestionTypes).some(active => active);
                const launchBtn = document.querySelector('.launch-challenge-btn');
                const launchNote = document.querySelector('.launch-note');
                
                if (!hasActiveType) {
                    launchBtn.disabled = true;
                    launchBtn.style.opacity = '0.5';
                    launchNote.textContent = 'At least one question type must be selected';
                    launchNote.style.color = '#ef4444';
                } else {
                    launchBtn.disabled = false;
                    launchBtn.style.opacity = '1';
                    launchNote.textContent = 'Ready to launch challenge';
                    launchNote.style.color = '#6b7280';
                }
                
                console.log('🎯 Question type toggled:', type, '→', this.activeQuestionTypes[type]);
            },
            
            generateCase: function() {
                this.currentCase = this.getCaseData();
                this.displayCase();
            },
            
            displayCase: function() {
                if (!this.currentCase) return;
                
                const case_data = this.currentCase;
                
                // Display scenario
                const scenarioEl = document.getElementById('challenge-scenario-text');
                if (scenarioEl) {
                    scenarioEl.textContent = case_data.scenario;
                }
                
                // Display muscle findings
                const abnormalEl = document.getElementById('challenge-abnormal-muscles');
                const normalEl = document.getElementById('challenge-normal-muscles');
                
                if (abnormalEl) {
                    abnormalEl.innerHTML = case_data.abnormalMuscles.map(muscle => `<li>${muscle}</li>`).join('');
                }
                
                if (normalEl) {
                    normalEl.innerHTML = case_data.normalMuscles.map(muscle => `<li>${muscle}</li>`).join('');
                }
                
                // Display answer options
                const optionsEl = document.getElementById('challenge-answer-options');
                if (optionsEl && case_data.options) {
                    optionsEl.innerHTML = case_data.options.map((option, index) => `
                        <div class="emg-answer-option" data-answer="${option}" onclick="window.EMGChallenge.selectAnswer('${option}')">
                            <div class="option-content">${option}</div>
                            <div class="option-indicator">○</div>
                        </div>
                    `).join('');
                }
                
                // Reset selected answer
                this.selectedAnswer = null;
                
                // Disable submit button until an answer is selected
                const submitBtn = document.getElementById('challenge-submit-btn');
                if (submitBtn) {
                    submitBtn.disabled = true;
                }
            },
            
            selectAnswer: function(answer) {
                this.selectedAnswer = answer;
                
                // Update UI to show selection
                const options = document.querySelectorAll('.emg-answer-option');
                options.forEach(option => {
                    option.classList.remove('selected');
                    const indicator = option.querySelector('.option-indicator');
                    if (indicator) indicator.textContent = '○';
                });
                
                const selectedOption = document.querySelector(`[data-answer="${answer}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                    const indicator = selectedOption.querySelector('.option-indicator');
                    if (indicator) indicator.textContent = '●';
                }
                
                // Enable submit button
                const submitBtn = document.getElementById('challenge-submit-btn');
                if (submitBtn) {
                    submitBtn.disabled = false;
                }
            },
            
            submitAnswer: function() {
                if (!this.selectedAnswer) {
                    alert('Please select an answer before submitting.');
                    return;
                }
                
                console.log('📝 Submitting answer:', this.selectedAnswer);
                
                const isCorrect = this.selectedAnswer === this.currentCase.correctAnswer;
                
                // Show feedback
                this.showFeedback(isCorrect);
                
                // Update buttons
                const submitBtn = document.getElementById('challenge-submit-btn');
                const nextBtn = document.getElementById('challenge-next-btn');
                
                if (submitBtn) submitBtn.style.display = 'none';
                if (nextBtn) nextBtn.style.display = 'block';
            },
            
            showFeedback: function(isCorrect) {
                const feedbackEl = document.getElementById('challenge-feedback');
                if (!feedbackEl) return;
                
                const case_data = this.currentCase;
                feedbackEl.innerHTML = `
                    <div class="feedback-header ${isCorrect ? 'correct' : 'incorrect'}">
                        <h4>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h4>
                    </div>
                    <div class="feedback-content">
                        <p><strong>Your Answer:</strong> ${this.selectedAnswer}</p>
                        <p><strong>Correct Answer:</strong> ${case_data.correctAnswer}</p>
                        <p><strong>Explanation:</strong> ${case_data.explanation}</p>
                    </div>
                `;
                feedbackEl.style.display = 'block';
            },
            
            nextCase: function() {
                console.log('➡️ Loading next case...');
                
                // Hide feedback
                const feedbackEl = document.getElementById('challenge-feedback');
                if (feedbackEl) {
                    feedbackEl.style.display = 'none';
                }
                
                // Reset buttons
                const submitBtn = document.getElementById('challenge-submit-btn');
                const nextBtn = document.getElementById('challenge-next-btn');
                
                if (submitBtn) {
                    submitBtn.style.display = 'block';
                    submitBtn.disabled = true;  // Will be enabled when answer is selected
                }
                if (nextBtn) nextBtn.style.display = 'none';
                
                // Generate new case
                this.generateCase();
            },
            
            backToSettings: function() {
                console.log('🔙 Returning to settings...');
                
                // Reset challenge state
                this.isActive = false;
                this.currentCase = null;
                this.selectedAnswer = null;
                
                // Hide active challenge and show setup
                document.getElementById('emg-challenge-active').style.display = 'none';
                document.getElementById('emg-challenge-setup').style.display = 'block';
                
                // Hide feedback
                const feedbackEl = document.getElementById('challenge-feedback');
                if (feedbackEl) {
                    feedbackEl.style.display = 'none';
                }
            },
            
            getFilteredLesions: function() {
                const filtered = { UE: {}, LE: {} };
                
                // Filter lesions based on active question types
                ['UE', 'LE'].forEach(region => {
                    Object.entries(this.lesionSites[region]).forEach(([lesionName, lesionData]) => {
                        if (this.activeQuestionTypes[lesionData.type]) {
                            filtered[region][lesionName] = lesionData;
                        }
                    });
                });
                
                return filtered;
            },
            
            getCaseData: function() {
                // Get a random lesion from filtered lesions
                const filteredLesions = this.getFilteredLesions();
                
                // Choose a region first (UE or LE), then select lesion within that region
                const regions = [];
                if (Object.keys(filteredLesions.UE).length > 0) regions.push('UE');
                if (Object.keys(filteredLesions.LE).length > 0) regions.push('LE');
                
                if (regions.length === 0) {
                    console.error('No active lesion types found');
                    return null;
                }
                
                // Pick a random region
                const selectedRegion = regions[Math.floor(Math.random() * regions.length)];
                const regionLesions = Object.entries(filteredLesions[selectedRegion]);
                
                if (regionLesions.length === 0) {
                    console.error('No lesions found in selected region:', selectedRegion);
                    return null;
                }
                
                const [lesionName, lesionData] = regionLesions[Math.floor(Math.random() * regionLesions.length)];
                
                // Clinical scenarios that don't give away the answer
                const scenarios = this.getRealisticScenarios();
                const scenario = scenarios[lesionData.type] || scenarios.default;
                
                // Get muscles actually affected by this lesion based on muscle database
                const actuallyAffectedMuscles = this.getMusclesAffectedByLesion(lesionName, lesionData.type, selectedRegion);
                
                // Fallback to hardcoded muscles if no matches found
                const abnormalMuscles = actuallyAffectedMuscles.length > 0 
                    ? actuallyAffectedMuscles 
                    : lesionData.muscles;
                
                // Generate realistic normal muscles (muscles NOT affected by this lesion) from SAME region
                const normalMuscles = this.generateNormalMuscles(lesionName, lesionData, selectedRegion);
                
                // Generate multiple choice options
                const options = this.generateAnswerOptions(lesionName, lesionData);
                
                console.log(`🧠 Lesion: ${lesionName}, Affected muscles from DB:`, actuallyAffectedMuscles);
                console.log(`🧠 Normal muscles for case:`, normalMuscles);
                
                const case_data = {
                    scenario: scenario,
                    abnormalMuscles: abnormalMuscles.slice(0, Math.min(4, abnormalMuscles.length)),
                    normalMuscles: normalMuscles,
                    correctAnswer: lesionName,
                    options: options,
                    explanation: this.getExplanation(lesionName, lesionData)
                };
                
                console.log(`🧠 Final case_data.normalMuscles:`, case_data.normalMuscles);
                
                return case_data;
            },
            
            getRealisticScenarios: function() {
                return {
                    root: "A patient presents with weakness and sensory changes following trauma. EMG needle examination reveals the following pattern:",
                    plexus: "A patient with recent shoulder trauma presents with weakness and numbness. Needle EMG findings are shown below:",
                    peripheral: "A patient reports progressive weakness and sensory symptoms. The following EMG needle examination results were obtained:",
                    default: "Clinical presentation includes weakness and sensory changes. EMG needle examination shows the following pattern:"
                };
            },
            
            // NEW: Get muscles actually affected by a lesion based on muscle database
            getMusclesAffectedByLesion: function(lesionName, lesionType, selectedRegion) {
                const affectedMuscles = [];
                
                console.log(`🔬 Analyzing lesion: "${lesionName}" (type: ${lesionType}, region: ${selectedRegion})`);
                
                // Go through all muscles in the muscle database for this region
                console.log(`🔍 Debug: window.MuscleAnatomy exists?`, !!window.MuscleAnatomy);
                console.log(`🔍 Debug: this.muscleDatabase exists?`, !!this.muscleDatabase);
                console.log(`🔍 Debug: MuscleAnatomy object:`, typeof MuscleAnatomy, Object.keys(MuscleAnatomy || {}));
                
                const muscleDB = MuscleAnatomy?.muscleDatabase || window.MuscleAnatomy?.muscleDatabase || this.muscleDatabase || {};
                console.log(`🔍 MuscleDB found:`, Object.keys(muscleDB).length, 'muscles');
                console.log(`🔍 First 3 muscles in DB:`, Object.keys(muscleDB).slice(0, 3));
                
                Object.entries(muscleDB).forEach(([muscleName, muscleData]) => {
                    if (muscleData.region !== selectedRegion) return;
                    
                    let isAffected = false;
                    
                    switch(lesionType) {
                        case 'root':
                            // Extract root from lesion name (e.g., "C6 nerve root" -> "C6")
                            const match = lesionName.match(/([CLSclsT]\d+)/);
                            if (match) {
                                const lesionRoot = match[1].toUpperCase();
                                isAffected = muscleData.roots && muscleData.roots.includes(lesionRoot);
                                if (isAffected) {
                                    console.log(`  ✅ ${muscleName} affected by ${lesionRoot} (roots: ${muscleData.roots})`);
                                }
                            }
                            break;
                        case 'trunk':
                            const trunkName = lesionName.toLowerCase().split(' ')[0]; // e.g., "upper" from "Upper trunk"
                            isAffected = muscleData.trunk && muscleData.trunk.toLowerCase().includes(trunkName);
                            break;
                        case 'cord':
                            const cordName = lesionName.toLowerCase().split(' ')[0]; // e.g., "lateral" from "Lateral cord"
                            isAffected = muscleData.cord && muscleData.cord.toLowerCase().includes(cordName);
                            break;
                        case 'peripheral':
                            isAffected = muscleData.peripheralNerve && 
                                        (muscleData.peripheralNerve.toLowerCase().includes(lesionName.toLowerCase()) ||
                                         lesionName.toLowerCase().includes(muscleData.peripheralNerve.toLowerCase()));
                            break;
                    }
                    
                    if (isAffected) {
                        affectedMuscles.push(muscleName);
                    }
                });
                
                console.log(`🎯 Total affected muscles: ${affectedMuscles.length}`, affectedMuscles);
                return affectedMuscles;
            },

            generateNormalMuscles: function(lesionName, lesionData, selectedRegion) {
                // Get all muscles from this region
                const muscleDB = MuscleAnatomy?.muscleDatabase || window.MuscleAnatomy?.muscleDatabase || this.muscleDatabase || {};
                console.log(`🧪 generateNormalMuscles: MuscleDB has ${Object.keys(muscleDB).length} muscles`);
                
                const allRegionMuscles = Object.keys(muscleDB).filter(muscleName => 
                    muscleDB[muscleName].region === selectedRegion
                );
                console.log(`🧪 generateNormalMuscles: Found ${allRegionMuscles.length} muscles for region ${selectedRegion}`);
                
                // Get muscles that would actually be affected by this lesion
                const actuallyAffectedMuscles = this.getMusclesAffectedByLesion(lesionName, lesionData.type, selectedRegion);
                console.log(`🧪 generateNormalMuscles: ${actuallyAffectedMuscles.length} muscles affected by ${lesionName}`);
                
                // Normal muscles are those NOT affected by this lesion
                const availableNormals = allRegionMuscles.filter(muscle => 
                    !actuallyAffectedMuscles.includes(muscle)
                );
                
                console.log(`🔍 Debug Normal Muscles for ${lesionName}:`);
                console.log(`   All region muscles: ${allRegionMuscles.length}`, allRegionMuscles.slice(0, 5));
                console.log(`   Actually affected: ${actuallyAffectedMuscles.length}`, actuallyAffectedMuscles);
                console.log(`   Available normals: ${availableNormals.length}`, availableNormals.slice(0, 5));
                
                // If we don't have enough normal muscles, fall back to hardcoded approach
                if (availableNormals.length < 2) {
                    console.log(`⚠️ Not enough normal muscles found, using fallback approach`);
                    // Use the old hardcoded approach as fallback
                    const regionMuscles = Object.values(this.lesionSites[selectedRegion]).flatMap(site => site.muscles);
                    const fallbackNormals = [...new Set(regionMuscles)].filter(muscle => 
                        !lesionData.muscles.includes(muscle)
                    );
                    const shuffled = fallbackNormals.sort(() => 0.5 - Math.random());
                    return shuffled.slice(0, Math.min(4, shuffled.length));
                }
                
                // Randomly select 3-4 normal muscles from the same region
                const shuffled = availableNormals.sort(() => 0.5 - Math.random());
                const finalNormalMuscles = shuffled.slice(0, Math.min(4, shuffled.length));
                console.log(`🎯 generateNormalMuscles returning:`, finalNormalMuscles);
                return finalNormalMuscles;
            },
            
            generateAnswerOptions: function(correctAnswer, lesionData) {
                // Determine if correct answer is UE or LE
                const isUE = this.lesionSites.UE.hasOwnProperty(correctAnswer);
                const regionLesions = isUE ? Object.keys(this.lesionSites.UE) : Object.keys(this.lesionSites.LE);
                const regionData = isUE ? this.lesionSites.UE : this.lesionSites.LE;
                
                // Get active question types
                const activeTypes = Object.keys(this.activeQuestionTypes).filter(type => this.activeQuestionTypes[type]);
                const multipleTypesActive = activeTypes.length > 1;
                
                let distractors = [];
                let targetCount = multipleTypesActive ? 7 : 4; // 8 total vs 5 total options
                
                if (multipleTypesActive) {
                    // When multiple types are active, include answers from all active types
                    console.log('🎯 Multiple types active:', activeTypes);
                    
                    // Get lesions from each active type (same region)
                    activeTypes.forEach(type => {
                        if (type === lesionData.type) return; // Skip same type as correct answer initially
                        
                        const typeSpecificLesions = regionLesions.filter(lesion => 
                            regionData[lesion].type === type
                        );
                        
                        // Add 1-2 from each type for variety
                        const shuffled = typeSpecificLesions.sort(() => 0.5 - Math.random());
                        const count = Math.min(2, shuffled.length);
                        distractors.push(...shuffled.slice(0, count));
                    });
                    
                    // Fill remaining slots with intelligent choices
                    const remainingSlots = targetCount - distractors.length;
                    if (remainingSlots > 0) {
                        // Add same-type lesions that might be confusing
                        const sameTypeLesions = regionLesions.filter(lesion => 
                            regionData[lesion].type === lesionData.type && 
                            lesion !== correctAnswer &&
                            !distractors.includes(lesion)
                        );
                        
                        // Intelligent selection: prefer lesions that share some muscles with the correct answer
                        const intelligentChoices = sameTypeLesions.filter(lesion => {
                            const sharedMuscles = regionData[lesion].muscles.some(muscle => 
                                lesionData.muscles.includes(muscle)
                            );
                            return sharedMuscles;
                        });
                        
                        const shuffledIntelligent = intelligentChoices.sort(() => 0.5 - Math.random());
                        const remainingFromSameType = sameTypeLesions.filter(l => !intelligentChoices.includes(l));
                        const shuffledRemaining = remainingFromSameType.sort(() => 0.5 - Math.random());
                        
                        const finalChoices = [
                            ...shuffledIntelligent.slice(0, Math.min(remainingSlots, intelligentChoices.length)),
                            ...shuffledRemaining.slice(0, Math.max(0, remainingSlots - intelligentChoices.length))
                        ];
                        
                        distractors.push(...finalChoices.slice(0, remainingSlots));
                    }
                    
                } else {
                    // Single type active - original behavior but refined
                    const sameTypeRegionLesions = regionLesions.filter(lesion => {
                        return regionData[lesion].type === lesionData.type;
                    });
                    
                    // Remove correct answer from pool
                    const availableDistractors = sameTypeRegionLesions.filter(l => l !== correctAnswer);
                    
                    if (availableDistractors.length >= targetCount) {
                        // Prioritize confusing similar lesions
                        const intelligentChoices = availableDistractors.filter(lesion => {
                            const sharedMuscles = regionData[lesion].muscles.some(muscle => 
                                lesionData.muscles.includes(muscle)
                            );
                            return sharedMuscles;
                        });
                        
                        const remainingChoices = availableDistractors.filter(l => !intelligentChoices.includes(l));
                        const shuffledIntelligent = intelligentChoices.sort(() => 0.5 - Math.random());
                        const shuffledRemaining = remainingChoices.sort(() => 0.5 - Math.random());
                        
                        // Mix intelligent and random choices
                        const mixedChoices = [
                            ...shuffledIntelligent.slice(0, Math.min(2, intelligentChoices.length)),
                            ...shuffledRemaining.slice(0, targetCount - Math.min(2, intelligentChoices.length))
                        ];
                        
                        distractors = mixedChoices.slice(0, targetCount);
                    } else {
                        // Use all available same-type distractors
                        distractors = [...availableDistractors];
                        
                        // Fill remaining with other types if needed
                        if (distractors.length < targetCount) {
                            const otherRegionTypes = regionLesions.filter(lesion => 
                                !sameTypeRegionLesions.includes(lesion) && lesion !== correctAnswer
                            );
                            const additionalNeeded = targetCount - distractors.length;
                            const shuffledOthers = otherRegionTypes.sort(() => 0.5 - Math.random());
                            distractors = [...distractors, ...shuffledOthers.slice(0, additionalNeeded)];
                        }
                    }
                }
                
                // Combine with correct answer and shuffle
                const options = [correctAnswer, ...distractors].sort(() => 0.5 - Math.random());
                
                console.log(`🎯 Generated ${options.length} options for ${correctAnswer}:`, options);
                return options;
            },
            
            getExplanation: function(lesionName, lesionData) {
                const muscleList = lesionData.muscles.slice(0, 3).join(', ');
                return `This EMG pattern is consistent with ${lesionName}. The denervation pattern involving ${muscleList} localizes to this specific anatomical site. Other lesions would show different muscle involvement patterns.`;
            },
            
            displayCase: function() {
                const case_data = this.currentCase;
                
                // Display scenario
                document.getElementById('challenge-scenario-text').textContent = case_data.scenario;
                
                // Display muscle findings
                document.getElementById('challenge-abnormal-muscles').innerHTML = 
                    case_data.abnormalMuscles.map(muscle => `<li>${muscle}</li>`).join('');
                document.getElementById('challenge-normal-muscles').innerHTML = 
                    case_data.normalMuscles.map(muscle => `<li>${muscle}</li>`).join('');
                
                // Display answer options
                const shuffledOptions = [...case_data.options].sort(() => Math.random() - 0.5);
                document.getElementById('challenge-answer-options').innerHTML = 
                    shuffledOptions.map((option, index) => `
                        <div class="answer-option-challenge" data-answer="${option}" onclick="EMGChallenge.selectAnswer('${option}')">
                            <div class="option-text-challenge">${option}</div>
                        </div>
                    `).join('');
                
                // Reset buttons
                document.getElementById('challenge-submit-btn').disabled = true;
                document.getElementById('challenge-submit-btn').style.display = 'block';
                document.getElementById('challenge-next-btn').style.display = 'none';
                document.getElementById('challenge-feedback').style.display = 'none';
            },
            
            selectAnswer: function(answer) {
                document.querySelectorAll('.answer-option-challenge').forEach(option => {
                    option.classList.remove('selected');
                });
                document.querySelector(`[data-answer="${answer}"]`).classList.add('selected');
                document.getElementById('challenge-submit-btn').disabled = false;
            },
            
            submitAnswer: function() {
                const selectedOption = document.querySelector('.answer-option-challenge.selected');
                if (!selectedOption) return;
                
                const selectedAnswer = selectedOption.dataset.answer;
                const isCorrect = selectedAnswer === this.currentCase.correctAnswer;
                
                this.showChallengeFeedback(isCorrect, selectedAnswer);
                
                document.getElementById('challenge-submit-btn').style.display = 'none';
                document.getElementById('challenge-next-btn').style.display = 'block';
            },
            
            showChallengeFeedback: function(isCorrect, selectedAnswer) {
                const feedbackDiv = document.getElementById('challenge-feedback');
                const case_data = this.currentCase;
                
                feedbackDiv.innerHTML = `
                    <div class="challenge-feedback-card ${isCorrect ? 'correct' : 'incorrect'}">
                        <h4>${isCorrect ? '🎯 Excellent Analysis!' : '🔍 Learning Opportunity'}</h4>
                        <div class="feedback-content">
                            <p><strong>Your answer:</strong> ${selectedAnswer}</p>
                            <p><strong>Correct answer:</strong> ${case_data.correctAnswer}</p>
                            <p><strong>Explanation:</strong> ${case_data.explanation}</p>
                        </div>
                    </div>
                `;
                
                feedbackDiv.style.display = 'block';
            },
            
            nextCase: function() {
                this.generateCase();
            },
            
            getFilteredLesions: function() {
                const filtered = { UE: {}, LE: {} };
                
                // Get the lesion sites from the other EMGChallenge object
                const otherEMG = window.EMGChallenge || this;
                if (!otherEMG.lesionSites) {
                    // Return all lesions if no filtering is set up
                    return { UE: {}, LE: {} };
                }
                
                // Filter lesions based on active question types
                ['UE', 'LE'].forEach(region => {
                    Object.entries(otherEMG.lesionSites[region] || {}).forEach(([lesionName, lesionData]) => {
                        if (this.activeQuestionTypes[lesionData.type]) {
                            filtered[region][lesionName] = lesionData;
                        }
                    });
                });
                
                return filtered;
            }
        };


        // Initialize videos when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeVideos();
            MuscleAnatomy.initializeDisplay();
            // Don't populate case grid initially - only when user clicks "Choose Specific Cases"
        });

        // Advanced Muscle Anatomy System
        const MuscleAnatomy = {
            currentRegion: 'lower',
            currentAnatomyType: 'nerve',
            inlineQuizActive: false,
            quizMode: 'type', // 'type' or 'multiple'
            // Independent quiz type toggles (separate from display mode)
            activeQuizTypes: {
                nerve: true,
                roots: true,
                cord: true,
                trunk: true,
                actions: true
            },

            // Anatomical pathway database - complete axon path understanding
            anatomicalPathways: {
                // Each muscle's complete pathway from spinal cord to end organ
                'Biceps brachii': {
                    roots: ['C5', 'C6'],
                    trunk: 'Upper trunk',
                    cord: 'Lateral cord',
                    nerve: 'Musculocutaneous',
                    pathway: [
                        { level: 'root', location: 'C5 nerve root', description: 'C5 nerve root exit foramina' },
                        { level: 'root', location: 'C6 nerve root', description: 'C6 nerve root exit foramina' },
                        { level: 'trunk', location: 'Upper trunk', description: 'C5-C6 trunk formation' },
                        { level: 'cord', location: 'Lateral cord', description: 'Lateral cord of brachial plexus' },
                        { level: 'peripheral', location: 'Musculocutaneous nerve', description: 'Musculocutaneous nerve in axilla' }
                    ],
                    // Muscles that would be normal if lesion is at different levels
                    normalIfLesionAt: {
                        'C5 root': ['Brachioradialis', 'Extensor carpi radialis'], // C6 muscles would be normal
                        'C6 root': ['Deltoid', 'Supraspinatus'], // C5 muscles would be normal  
                        'Upper trunk': ['Triceps brachii', 'First dorsal interosseous'], // Other trunk/cord muscles normal
                        'Lateral cord': ['Deltoid', 'Triceps brachii'], // Posterior cord muscles normal
                        'Musculocutaneous nerve': ['Triceps brachii', 'Flexor carpi radialis'] // Other nerves normal
                    }
                },

                'Brachioradialis': {
                    roots: ['C5', 'C6'],
                    trunk: 'Upper trunk', 
                    cord: 'Posterior cord',
                    nerve: 'Radial',
                    pathway: [
                        { level: 'root', location: 'C5 nerve root', description: 'C5 nerve root exit foramina' },
                        { level: 'root', location: 'C6 nerve root', description: 'C6 nerve root exit foramina' },
                        { level: 'trunk', location: 'Upper trunk', description: 'C5-C6 trunk formation' },
                        { level: 'cord', location: 'Posterior cord', description: 'Posterior cord of brachial plexus' },
                        { level: 'peripheral', location: 'Radial nerve', description: 'Radial nerve in spiral groove' }
                    ],
                    normalIfLesionAt: {
                        'C5 root': ['Triceps brachii', 'Extensor digitorum'], // C7-C8 muscles normal
                        'C6 root': ['Deltoid', 'Biceps brachii'], // C5 muscles normal
                        'Upper trunk': ['Triceps brachii', 'First dorsal interosseous'], // Other levels normal
                        'Posterior cord': ['Biceps brachii', 'First dorsal interosseous'], // Other cords normal
                        'Radial nerve': ['Biceps brachii', 'First dorsal interosseous'] // Other nerves normal
                    }
                },

                'First dorsal interosseous': {
                    roots: ['C8', 'T1'],
                    trunk: 'Lower trunk',
                    cord: 'Medial cord', 
                    nerve: 'Ulnar',
                    pathway: [
                        { level: 'root', location: 'C8 nerve root', description: 'C8 nerve root exit foramina' },
                        { level: 'root', location: 'T1 nerve root', description: 'T1 nerve root exit foramina' },
                        { level: 'trunk', location: 'Lower trunk', description: 'C8-T1 trunk formation' },
                        { level: 'cord', location: 'Medial cord', description: 'Medial cord of brachial plexus' },
                        { level: 'peripheral', location: 'Ulnar nerve at elbow', description: 'Ulnar nerve at cubital tunnel' },
                        { level: 'peripheral', location: 'Ulnar nerve at wrist', description: 'Ulnar nerve at Guyon canal' }
                    ],
                    normalIfLesionAt: {
                        'C8 root': ['Abductor pollicis brevis', 'Flexor carpi ulnaris'], // T1 muscles affected differently
                        'T1 root': ['Flexor carpi ulnaris'], // C8 muscles affected differently
                        'Lower trunk': ['Biceps brachii', 'Triceps brachii'], // Other levels normal
                        'Medial cord': ['Triceps brachii', 'Deltoid'], // Other cords normal
                        'Ulnar nerve at elbow': ['Abductor pollicis brevis', 'Pronator teres'], // Median nerve normal
                        'Ulnar nerve at wrist': ['Flexor carpi ulnaris'] // Proximal ulnar muscles normal
                    }
                },

                'Triceps brachii': {
                    roots: ['C6', 'C7', 'C8'],
                    trunk: 'Upper/Middle trunk',
                    cord: 'Posterior cord',
                    nerve: 'Radial',
                    pathway: [
                        { level: 'root', location: 'C6 nerve root', description: 'C6 nerve root exit foramina' },
                        { level: 'root', location: 'C7 nerve root', description: 'C7 nerve root exit foramina' },
                        { level: 'root', location: 'C8 nerve root', description: 'C8 nerve root exit foramina' },
                        { level: 'trunk', location: 'Upper trunk', description: 'C5-C6 contribution' },
                        { level: 'trunk', location: 'Middle trunk', description: 'C7 contribution' },
                        { level: 'cord', location: 'Posterior cord', description: 'Posterior cord of brachial plexus' },
                        { level: 'peripheral', location: 'Radial nerve in spiral groove', description: 'Radial nerve in humeral spiral groove' }
                    ],
                    normalIfLesionAt: {
                        'C6 root': ['First dorsal interosseous'], // C8-T1 muscles normal
                        'C7 root': ['Biceps brachii', 'First dorsal interosseous'], // C5-C6, C8-T1 normal
                        'C8 root': ['Biceps brachii', 'Brachioradialis'], // C5-C7 normal
                        'Posterior cord': ['Biceps brachii', 'First dorsal interosseous'], // Other cords normal
                        'Radial nerve': ['Biceps brachii', 'First dorsal interosseous'] // Other nerves normal
                    }
                }
                // Add more muscles as needed...
            },
            testData: {
                questionsAnswered: 0,
                correctAnswers: 0,
                missedQuestions: [],
                usedMuscles: new Set(),
                isActive: false
            },

            // Complete Muscle Database - Preston & Shapiro
            muscleDatabase: {
                // Upper Extremity Muscles
                'Trapezius (upper)': { nerve: 'Spinal accessory', roots: ['C3', 'C4'], region: 'UE', peripheralNerve: 'Spinal accessory', cord: 'N/A (cranial nerve)', actions: 'Shoulder elevation, scapular retraction' },
                'Rhomboids': { nerve: 'Dorsal scapular', roots: ['C5'], region: 'UE', peripheralNerve: 'Dorsal scapular', cord: 'N/A (pre-plexus)', trunk: 'Upper trunk', actions: 'Scapular retraction and downward rotation' },
                'Serratus anterior': { nerve: 'Long thoracic', roots: ['C5', 'C6', 'C7'], region: 'UE', peripheralNerve: 'Long thoracic', cord: 'N/A (pre-plexus)', trunk: 'Upper/Middle trunk', actions: 'Scapular protraction and upward rotation' },
                'Supraspinatus': { nerve: 'Suprascapular', roots: ['C5', 'C6'], region: 'UE', peripheralNerve: 'Suprascapular', cord: 'N/A (pre-plexus)', trunk: 'Upper trunk', actions: 'Shoulder abduction initiation' },
                'Infraspinatus': { nerve: 'Suprascapular', roots: ['C5', 'C6'], region: 'UE', peripheralNerve: 'Suprascapular', cord: 'N/A (pre-plexus)', trunk: 'Upper trunk', actions: 'Shoulder external rotation' },
                'Teres minor': { nerve: 'Axillary', roots: ['C5', 'C6'], region: 'UE', peripheralNerve: 'Axillary', cord: 'Posterior cord', actions: 'Shoulder external rotation' },
                'Deltoid': { nerve: 'Axillary', roots: ['C5', 'C6'], region: 'UE', peripheralNerve: 'Axillary', cord: 'Posterior cord', actions: 'Shoulder abduction, flexion, extension' },
                'Biceps brachii': { nerve: 'Musculocutaneous', roots: ['C5', 'C6'], region: 'UE', peripheralNerve: 'Musculocutaneous', cord: 'Lateral cord', trunk: 'Upper trunk', actions: 'Elbow flexion, forearm supination' },
                'Brachialis': { nerve: 'Musculocutaneous/Radial', roots: ['C5', 'C6', 'C7'], region: 'UE', peripheralNerve: 'Musculocutaneous', cord: 'Lateral/Posterior cord', trunk: 'Upper/Middle trunk', actions: 'Elbow flexion' },
                'Brachioradialis': { nerve: 'Radial', roots: ['C5', 'C6'], region: 'UE', peripheralNerve: 'Radial', cord: 'Posterior cord', actions: 'Elbow flexion, forearm rotation' },
                'Subscapularis': { nerve: 'Subscapular', roots: ['C5', 'C6'], region: 'UE', peripheralNerve: 'Subscapular', cord: 'Posterior cord', actions: 'Shoulder internal rotation' },
                'Extensor carpi radialis': { nerve: 'Radial', roots: ['C6', 'C7'], region: 'UE', peripheralNerve: 'Radial', cord: 'Posterior cord', actions: 'Wrist extension and radial deviation' },
                'Pronator teres': { nerve: 'Median', roots: ['C6', 'C7'], region: 'UE', peripheralNerve: 'Median', cord: 'Lateral/Medial cord', trunk: 'Upper/Middle trunk', actions: 'Forearm pronation, elbow flexion' },
                'Flexor carpi radialis': { nerve: 'Median', roots: ['C6', 'C7'], region: 'UE', peripheralNerve: 'Median', cord: 'Lateral/Medial cord', trunk: 'Upper/Middle trunk', actions: 'Wrist flexion and radial deviation' },
                'Pectoralis major': { nerve: 'Pectoral', roots: ['C5', 'C6', 'C7', 'C8', 'T1'], region: 'UE', peripheralNerve: 'Pectoral', cord: 'Lateral/Medial cord', actions: 'Shoulder adduction, internal rotation' },
                'Latissimus dorsi': { nerve: 'Thoracodorsal', roots: ['C6', 'C7', 'C8'], region: 'UE', peripheralNerve: 'Thoracodorsal', cord: 'Posterior cord', actions: 'Shoulder adduction, extension, internal rotation' },
                'Triceps brachii': { nerve: 'Radial', roots: ['C6', 'C7', 'C8'], region: 'UE', peripheralNerve: 'Radial', cord: 'Posterior cord', actions: 'Elbow extension' },
                'Extensor digitorum': { nerve: 'Posterior interosseous', roots: ['C7', 'C8'], region: 'UE', peripheralNerve: 'Radial', cord: 'Posterior cord', actions: 'Finger extension at MCP joints' },
                'Extensor pollicis longus': { nerve: 'Posterior interosseous', roots: ['C7', 'C8'], region: 'UE', peripheralNerve: 'Radial', cord: 'Posterior cord', actions: 'Thumb extension and retropulsion' },
                'Flexor digitorum superficialis': { nerve: 'Median', roots: ['C7', 'C8', 'T1'], region: 'UE', peripheralNerve: 'Median', cord: 'Lateral/Medial cord', actions: 'Finger flexion at PIP joints' },
                'Flexor digitorum profundus (digits 2&3)': { nerve: 'Anterior interosseous', roots: ['C7', 'C8', 'T1'], region: 'UE', peripheralNerve: 'Median', cord: 'Lateral/Medial cord', actions: 'Finger flexion at DIP joints (index, middle)' },
                'Flexor digitorum profundus (digits 4&5)': { nerve: 'Ulnar', roots: ['C7', 'C8', 'T1'], region: 'UE', peripheralNerve: 'Ulnar', cord: 'Medial cord', trunk: 'Middle/Lower trunk', actions: 'Finger flexion at DIP joints (ring, little)' },
                'Flexor carpi ulnaris': { nerve: 'Ulnar', roots: ['C8', 'T1'], region: 'UE', peripheralNerve: 'Ulnar', cord: 'Medial cord', trunk: 'Lower trunk', actions: 'Wrist flexion and ulnar deviation' },
                'Flexor pollicis longus': { nerve: 'Anterior interosseous', roots: ['C8', 'T1'], region: 'UE', peripheralNerve: 'Median', cord: 'Lateral/Medial cord', actions: 'Thumb flexion at IP joint' },
                'Abductor pollicis brevis': { nerve: 'Median', roots: ['C8', 'T1'], region: 'UE', peripheralNerve: 'Median', cord: 'Lateral/Medial cord', actions: 'Thumb abduction' },
                'Opponens pollicis': { nerve: 'Median', roots: ['C8', 'T1'], region: 'UE', peripheralNerve: 'Median', cord: 'Lateral/Medial cord', actions: 'Thumb opposition' },
                'Adductor pollicis': { nerve: 'Ulnar', roots: ['C8', 'T1'], region: 'UE', peripheralNerve: 'Ulnar', cord: 'Medial cord', trunk: 'Lower trunk', actions: 'Thumb adduction' },
                'First dorsal interosseous': { nerve: 'Ulnar', roots: ['C8', 'T1'], region: 'UE', peripheralNerve: 'Ulnar', cord: 'Medial cord', trunk: 'Lower trunk', actions: 'Index finger abduction' },
                'Abductor digiti minimi': { nerve: 'Ulnar', roots: ['C8', 'T1'], region: 'UE', peripheralNerve: 'Ulnar', cord: 'Medial cord', trunk: 'Lower trunk', actions: 'Little finger abduction' },
                
                // Lower Extremity Muscles - Complete Database
                // Gluteal Region
                'Gluteus maximus': { nerve: 'Inferior gluteal', roots: ['L5', 'S1', 'S2'], region: 'LE', peripheralNerve: 'Inferior gluteal', actions: 'Hip extension, lateral rotation, upper fibers assist in abduction' },
                'Gluteus medius': { nerve: 'Superior gluteal', roots: ['L4', 'L5', 'S1'], region: 'LE', peripheralNerve: 'Superior gluteal', actions: 'Hip abduction, medial rotation (anterior fibers), lateral rotation (posterior fibers)' },
                'Gluteus minimus': { nerve: 'Superior gluteal', roots: ['L4', 'L5', 'S1'], region: 'LE', peripheralNerve: 'Superior gluteal', actions: 'Hip abduction, medial rotation, stabilizes pelvis' },
                'Tensor fasciae latae': { nerve: 'Superior gluteal', roots: ['L4', 'L5', 'S1'], region: 'LE', peripheralNerve: 'Superior gluteal', actions: 'Hip flexion, abduction, medial rotation, stabilizes IT band' },
                'Piriformis': { nerve: 'Nerve to piriformis', roots: ['S1', 'S2'], region: 'LE', peripheralNerve: 'Piriformis', actions: 'Hip lateral rotation, abduction when hip is flexed' },
                'Superior gemellus': { nerve: 'Nerve to obturator internus', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Obturator internus', actions: 'Hip lateral rotation' },
                'Obturator internus': { nerve: 'Nerve to obturator internus', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Obturator internus', actions: 'Hip lateral rotation' },
                'Inferior gemellus': { nerve: 'Nerve to quadratus femoris', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Quadratus femoris', actions: 'Hip lateral rotation' },
                'Quadratus femoris': { nerve: 'Nerve to quadratus femoris', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Quadratus femoris', actions: 'Hip lateral rotation, adduction' },
                'Obturator externus': { nerve: 'Obturator', roots: ['L3', 'L4'], region: 'LE', peripheralNerve: 'Obturator', actions: 'Hip lateral rotation' },
                
                // Thigh
                'Rectus femoris': { nerve: 'Femoral', roots: ['L2', 'L3', 'L4'], region: 'LE', peripheralNerve: 'Femoral', actions: 'Knee extension, hip flexion' },
                'Vastus lateralis': { nerve: 'Femoral', roots: ['L2', 'L3', 'L4'], region: 'LE', peripheralNerve: 'Femoral', actions: 'Knee extension' },
                'Vastus medialis': { nerve: 'Femoral', roots: ['L2', 'L3', 'L4'], region: 'LE', peripheralNerve: 'Femoral', actions: 'Knee extension' },
                'Vastus intermedius': { nerve: 'Femoral', roots: ['L2', 'L3', 'L4'], region: 'LE', peripheralNerve: 'Femoral', actions: 'Knee extension' },
                'Sartorius': { nerve: 'Femoral', roots: ['L2', 'L3'], region: 'LE', peripheralNerve: 'Femoral', actions: 'Hip flexion, abduction, external rotation; knee flexion' },
                'Iliopsoas (psoas major)': { nerve: 'Lumbar plexus', roots: ['L1', 'L2', 'L3'], region: 'LE', peripheralNerve: 'Lumbar plexus', actions: 'Hip flexion, stabilizes lumbar spine' },
                'Iliopsoas (iliacus)': { nerve: 'Femoral', roots: ['L2', 'L3'], region: 'LE', peripheralNerve: 'Femoral', actions: 'Hip flexion' },
                'Pectineus': { nerve: 'Femoral/Obturator', roots: ['L2', 'L3'], region: 'LE', peripheralNerve: 'Femoral', actions: 'Hip flexion, adduction' },
                'Adductor longus': { nerve: 'Obturator', roots: ['L2', 'L3', 'L4'], region: 'LE', peripheralNerve: 'Obturator', actions: 'Hip adduction, flexion' },
                'Adductor brevis': { nerve: 'Obturator', roots: ['L2', 'L3', 'L4'], region: 'LE', peripheralNerve: 'Obturator', actions: 'Hip adduction, flexion' },
                'Adductor magnus': { nerve: 'Obturator/Sciatic', roots: ['L2', 'L3', 'L4', 'L5'], region: 'LE', peripheralNerve: 'Obturator', actions: 'Hip adduction, extension (posterior fibers)' },
                'Gracilis': { nerve: 'Obturator', roots: ['L2', 'L3'], region: 'LE', peripheralNerve: 'Obturator', actions: 'Hip adduction, knee flexion' },
                'Biceps femoris (long head)': { nerve: 'Sciatic (tibial division)', roots: ['L5', 'S1', 'S2'], region: 'LE', peripheralNerve: 'Sciatic', actions: 'Knee flexion, hip extension' },
                'Biceps femoris (short head)': { nerve: 'Sciatic (peroneal division)', roots: ['L5', 'S1', 'S2'], region: 'LE', peripheralNerve: 'Sciatic', actions: 'Knee flexion' },
                'Semitendinosus': { nerve: 'Sciatic (tibial division)', roots: ['L5', 'S1', 'S2'], region: 'LE', peripheralNerve: 'Sciatic', actions: 'Knee flexion, hip extension' },
                'Semimembranosus': { nerve: 'Sciatic (tibial division)', roots: ['L5', 'S1', 'S2'], region: 'LE', peripheralNerve: 'Sciatic', actions: 'Knee flexion, hip extension' },
                
                // Leg
                'Tibialis anterior': { nerve: 'Deep peroneal', roots: ['L4', 'L5'], region: 'LE', peripheralNerve: 'Peroneal', actions: 'Ankle dorsiflexion, foot inversion' },
                'Extensor digitorum longus': { nerve: 'Deep peroneal', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Peroneal', actions: 'Toe extension, ankle dorsiflexion' },
                'Extensor hallucis longus': { nerve: 'Deep peroneal', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Peroneal', actions: 'Great toe extension, ankle dorsiflexion' },
                'Fibularis tertius': { nerve: 'Deep peroneal', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Peroneal', actions: 'Ankle dorsiflexion, foot eversion' },
                'Fibularis longus': { nerve: 'Superficial peroneal', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Peroneal', actions: 'Ankle plantarflexion, foot eversion' },
                'Fibularis brevis': { nerve: 'Superficial peroneal', roots: ['L5', 'S1'], region: 'LE', peripheralNerve: 'Peroneal', actions: 'Foot eversion' },
                'Gastrocnemius': { nerve: 'Tibial', roots: ['S1', 'S2'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Ankle plantarflexion, knee flexion' },
                'Soleus': { nerve: 'Tibial', roots: ['S1', 'S2'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Ankle plantarflexion' },
                'Plantaris': { nerve: 'Tibial', roots: ['S1', 'S2'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Ankle plantarflexion, knee flexion' },
                'Popliteus': { nerve: 'Tibial', roots: ['L4', 'L5', 'S1'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Knee flexion, unlocks knee' },
                'Tibialis posterior': { nerve: 'Tibial', roots: ['L4', 'L5'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Ankle plantarflexion, foot inversion' },
                'Flexor digitorum longus': { nerve: 'Tibial', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Toe flexion, ankle plantarflexion' },
                'Flexor hallucis longus': { nerve: 'Tibial', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Great toe flexion, ankle plantarflexion' },
                
                // Foot
                'Extensor digitorum brevis': { nerve: 'Deep peroneal', roots: ['S1', 'S2'], region: 'LE', peripheralNerve: 'Peroneal', actions: 'Toe extension at MTP joints' },
                'Extensor hallucis brevis': { nerve: 'Deep peroneal', roots: ['S1', 'S2'], region: 'LE', peripheralNerve: 'Peroneal', actions: 'Great toe extension at MTP joint' },
                'Abductor hallucis': { nerve: 'Medial plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Great toe abduction, arch support' },
                'Flexor digitorum brevis': { nerve: 'Medial plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Toe flexion at PIP joints' },
                'Abductor digiti minimi (foot)': { nerve: 'Lateral plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Little toe abduction' },
                'Quadratus plantae': { nerve: 'Lateral plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Assists flexor digitorum longus' },
                'Lumbricals (1st)': { nerve: 'Medial plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'MTP flexion, IP extension' },
                'Lumbricals (2nd-4th)': { nerve: 'Lateral plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'MTP flexion, IP extension' },
                'Flexor hallucis brevis': { nerve: 'Medial plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Great toe flexion at MTP joint' },
                'Adductor hallucis': { nerve: 'Lateral plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Great toe adduction' },
                'Flexor digiti minimi brevis': { nerve: 'Lateral plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Little toe flexion at MTP joint' },
                'Plantar interossei': { nerve: 'Lateral plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Toe adduction toward 2nd toe' },
                'Dorsal interossei': { nerve: 'Lateral plantar', roots: ['S2', 'S3'], region: 'LE', peripheralNerve: 'Tibial', actions: 'Toe abduction from 2nd toe' }
            },

            initializeDisplay() {
                this.displayMuscles('lower');
            },

            switchAnatomy(region) {
                this.currentRegion = region;
                this.displayMuscles(region);
                
                // Update button states
                document.querySelectorAll('.region-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-region="${region}"]`).classList.add('active');
            },
            
            studyMode: 'explorer',
            activeInfo: {
                nerve: true,
                roots: true,
                actions: true,
                peripheral: true
            },
            
            setStudyMethod(method) {
                this.studyMode = method;
                
                // Update button states
                document.querySelectorAll('.method-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-method="${method}"]`).classList.add('active');
                
                // Refresh display based on study method
                this.displayMuscles(this.currentRegion);
                
                console.log('🎯 Study method changed to:', method);
            },
            
            toggleInfo(infoType) {
                this.activeInfo[infoType] = !this.activeInfo[infoType];
                
                // Update button states
                const button = document.querySelector(`[data-info="${infoType}"]`);
                if (this.activeInfo[infoType]) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
                
                // Refresh display
                this.displayMuscles(this.currentRegion);
                
                console.log('📊 Info toggle:', infoType, '→', this.activeInfo[infoType]);
            },

            displayMuscles(region) {
                const display = document.getElementById('muscle-anatomy-display');
                if (!display) return;

                const muscles = Object.entries(this.muscleDatabase).filter(([name, data]) => 
                    data.region === (region === 'upper' ? 'UE' : 'LE')
                );

                const regionName = region === 'upper' ? 'Upper Extremity' : 'Lower Extremity';
                const regionEmoji = region === 'upper' ? '💪' : '🦵';

                let html = `
                    <div class="muscle-region">
                        <h3>${regionEmoji} ${regionName} Muscles</h3>
                        <div class="muscle-grid">
                `;

                muscles.forEach(([muscleName, muscleData]) => {
                    html += `
                        <div class="muscle-card-interactive" data-muscle="${muscleName}">
                            <div class="muscle-header">
                                <h4 class="muscle-name">${muscleName}</h4>
                            </div>
                            
                            <!-- Interactive reveal buttons -->
                            <div class="muscle-controls">
                                <button class="muscle-btn nerve" onclick="MuscleAnatomy.toggleDetail('${muscleName}', 'nerve')" title="Show Nerve Supply">
                                    Nerve
                                </button>
                                <button class="muscle-btn roots" onclick="MuscleAnatomy.toggleDetail('${muscleName}', 'roots')" title="Show Nerve Roots">
                                    Roots
                                </button>
                                <button class="muscle-btn cord" onclick="MuscleAnatomy.toggleDetail('${muscleName}', 'cord')" title="Show Cord">
                                    Cord
                                </button>
                                <button class="muscle-btn trunk" onclick="MuscleAnatomy.toggleDetail('${muscleName}', 'trunk')" title="Show Trunk">
                                    Trunk
                                </button>
                                <button class="muscle-btn actions" onclick="MuscleAnatomy.toggleDetail('${muscleName}', 'actions')" title="Show Actions">
                                    Actions
                                </button>
                                <button class="muscle-btn show-all" onclick="MuscleAnatomy.toggleDetail('${muscleName}', 'all')" title="Show All Details">
                                    Show All
                                </button>
                            </div>
                            
                            <!-- Hidden detail sections -->
                            <div class="muscle-detail nerve-detail" data-type="nerve" style="display: none;">
                                <div class="detail-header">
                                    <span class="detail-label">Nerve Supply</span>
                                </div>
                                <div class="detail-content">${muscleData.peripheralNerve}</div>
                            </div>
                            
                            <div class="muscle-detail roots-detail" data-type="roots" style="display: none;">
                                <div class="detail-header">
                                    <span class="detail-label">Nerve Roots</span>
                                </div>
                                <div class="detail-content">${muscleData.roots.join(', ')}</div>
                            </div>
                            
                            <div class="muscle-detail cord-detail" data-type="cord" style="display: none;">
                                <div class="detail-header">
                                    <span class="detail-label">Brachial Plexus Cord</span>
                                </div>
                                <div class="detail-content">${muscleData.cord || 'Not applicable'}</div>
                            </div>
                            
                            <div class="muscle-detail trunk-detail" data-type="trunk" style="display: none;">
                                <div class="detail-header">
                                    <span class="detail-label">Brachial Plexus Trunk</span>
                                </div>
                                <div class="detail-content">${muscleData.trunk || 'Not applicable'}</div>
                            </div>
                            
                            <div class="muscle-detail actions-detail" data-type="actions" style="display: none;">
                                <div class="detail-header">
                                    <span class="detail-label">Primary Actions</span>
                                </div>
                                <div class="detail-content">${muscleData.actions}</div>
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;

                display.innerHTML = html;
            },

            // Interactive flashcard flip function with smooth 3D animation
            flipCard(muscleName) {
                // Handle special characters in muscle names
                const card = Array.from(document.querySelectorAll('[data-muscle]')).find(el => el.dataset.muscle === muscleName);
                if (!card) return;
                
                // Toggle the flipped state
                card.classList.toggle('flipped');
                
                // Add expanding effect for better visibility
                if (card.classList.contains('flipped')) {
                    card.classList.add('expanded');
                } else {
                    // Remove expanded class after flip animation completes
                    setTimeout(() => {
                        card.classList.remove('expanded');
                    }, 400);
                }
                
                // Add tactile feedback
                card.style.transform = card.classList.contains('flipped') 
                    ? 'scale(1.05) translateY(-5px)' 
                    : 'scale(0.98)';
                    
                setTimeout(() => {
                    card.style.transform = card.classList.contains('flipped') 
                        ? 'scale(1.05) translateY(-5px)' 
                        : '';
                }, 200);
            },

            toggleDetail(muscleName, type) {
                // Escape special characters in muscle names for CSS selector
                const escapedName = muscleName.replace(/[\\()&]/g, '\\$&');
                const card = document.querySelector(`[data-muscle="${escapedName}"]`) || 
                           document.querySelector(`div[data-muscle]`).parentNode.querySelector(`[data-muscle="${muscleName}"]`) ||
                           Array.from(document.querySelectorAll('[data-muscle]')).find(el => el.dataset.muscle === muscleName);
                if (!card) return;

                if (type === 'all') {
                    const details = card.querySelectorAll('.muscle-detail');
                    const buttons = card.querySelectorAll('.muscle-btn:not(.show-all)');
                    const showAllBtn = card.querySelector('.muscle-btn.show-all');
                    const isAllShown = Array.from(details).every(detail => detail.style.display === 'block');
                    
                    details.forEach(detail => {
                        detail.style.display = isAllShown ? 'none' : 'block';
                        if (!isAllShown) {
                            // Add smooth animation
                            detail.style.opacity = '0';
                            detail.style.transform = 'translateY(-10px)';
                            setTimeout(() => {
                                detail.style.opacity = '1';
                                detail.style.transform = 'translateY(0)';
                            }, 50);
                        }
                    });
                    
                    buttons.forEach(btn => {
                        if (isAllShown) {
                            btn.classList.remove('active');
                        } else {
                            btn.classList.add('active');
                        }
                    });
                    
                    if (showAllBtn) {
                        showAllBtn.textContent = isAllShown ? 'Show All' : 'Hide All';
                        showAllBtn.classList.toggle('active');
                    }
                } else {
                    const detail = card.querySelector(`.muscle-detail[data-type="${type}"]`);
                    const button = card.querySelector(`.muscle-btn.${type}`);
                    
                    if (detail && button) {
                        const isVisible = detail.style.display === 'block';
                        detail.style.display = isVisible ? 'none' : 'block';
                        button.classList.toggle('active');
                        
                        // Add smooth animation for showing
                        if (!isVisible) {
                            detail.style.opacity = '0';
                            detail.style.transform = 'translateY(-10px)';
                            setTimeout(() => {
                                detail.style.opacity = '1';
                                detail.style.transform = 'translateY(0)';
                            }, 50);
                        }
                    }
                }
                
                // Add expand effect if any details are shown
                const visibleDetails = card.querySelectorAll('.muscle-detail[style*="display: block"]');
                if (visibleDetails.length > 0) {
                    card.classList.add('expanded');
                } else {
                    card.classList.remove('expanded');
                }
            },
            
            setAnatomyType(type) {
                this.currentAnatomyType = type;
                
                // Update button states
                document.querySelectorAll('.anatomy-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-anatomy="${type}"]`).classList.add('active');
                
                // Update muscle display to show only this anatomy type
                this.displayMuscles(this.currentRegion);
            },

            // New function for independent quiz type toggling
            toggleQuizType(type) {
                console.log('🎯 Quiz toggle called for:', type);
                // Toggle the state
                this.activeQuizTypes[type] = !this.activeQuizTypes[type];
                
                // Update UI
                const option = document.querySelector(`[data-quiz-type="${type}"]`);
                const indicator = option.querySelector('.status-indicator');
                const text = option.querySelector('.status-text');
                
                if (this.activeQuizTypes[type]) {
                    option.classList.add('active');
                    indicator.classList.add('active');
                    text.textContent = 'Active';
                } else {
                    option.classList.remove('active');
                    indicator.classList.remove('active');
                    text.textContent = 'Inactive';
                }
                
                // Check if at least one type is active
                const hasActiveType = Object.values(this.activeQuizTypes).some(active => active);
                const startQuizBtn = document.querySelector('#start-quiz-btn');
                
                if (!hasActiveType && startQuizBtn) {
                    startQuizBtn.disabled = true;
                    startQuizBtn.textContent = 'Select at least one quiz type';
                } else if (startQuizBtn) {
                    startQuizBtn.disabled = false;
                    startQuizBtn.textContent = 'Start Quiz';
                }
                
                console.log('🎯 Quiz type toggled:', type, '→', this.activeQuizTypes[type]);
            },
            
            setQuizMode(mode) {
                this.quizMode = mode;
                
                // Update button states
                document.querySelectorAll('.mode-toggle-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
                
                console.log('🎯 Quiz mode changed to:', mode);
            },
            
            startInlineQuiz() {
                this.inlineQuizActive = true;
                
                // Show quiz area
                document.getElementById('inline-quiz-area').style.display = 'block';
                
                // Update buttons
                document.querySelector('.quiz-start-btn').style.display = 'none';
                document.querySelector('.quiz-stop-btn').style.display = 'block';
                
                // Generate first question
                this.generateInlineQuestion();
                
                console.log('🚀 Inline quiz started');
            },
            
            stopInlineQuiz() {
                this.inlineQuizActive = false;
                
                // Hide quiz area
                document.getElementById('inline-quiz-area').style.display = 'none';
                
                // Update buttons
                document.querySelector('.quiz-start-btn').style.display = 'block';
                document.querySelector('.quiz-stop-btn').style.display = 'none';
                
                console.log('⏹️ Inline quiz stopped');
            },
            
            generateInlineQuestion() {
                const muscles = Object.keys(this.muscleDatabase);
                const muscle = muscles[Math.floor(Math.random() * muscles.length)];
                const muscleData = this.muscleDatabase[muscle];
                
                const quizArea = document.getElementById('inline-quiz-area');
                
                if (this.quizMode === 'type') {
                    // Type-in answer mode
                    const questionType = this.getRandomActiveQuizType(muscle);
                    this.currentQuestionType = questionType;
                    this.currentQuestionMuscle = muscle;
                    
                    quizArea.innerHTML = `
                        <div class="quiz-question">
                            <h4>What is the ${this.getAnatomyLabel(questionType)} of ${muscle}?</h4>
                            <div class="quiz-answer-input">
                                <input type="text" id="quiz-answer" placeholder="Enter your answer..." />
                                <button onclick="MuscleAnatomy.checkInlineAnswer('${muscle}')" class="check-answer-btn">Check Answer</button>
                            </div>
                            <div id="quiz-feedback" class="quiz-feedback" style="display: none;"></div>
                        </div>
                    `;
                    
                    // Focus the input
                    setTimeout(() => {
                        document.getElementById('quiz-answer').focus();
                    }, 100);
                    
                } else {
                    // Multiple choice mode
                    const questionType = this.getRandomActiveQuizType(muscle);
                    const correctAnswer = this.getCorrectAnswer(muscle, questionType);
                    const options = this.generateQuizOptions(muscle, correctAnswer, questionType);
                    
                    // Store question type for answer checking
                    this.currentQuestionType = questionType;
                    this.currentQuestionMuscle = muscle;
                    
                    quizArea.innerHTML = `
                        <div class="quiz-question">
                            <h4>What is the ${this.getAnatomyLabel(questionType)} of ${muscle}?</h4>
                            <div class="quiz-options">
                                ${options.map((option, index) => `
                                    <div class="quiz-option" onclick="MuscleAnatomy.selectQuizOption('${option}', '${muscle}')">
                                        <input type="radio" name="quiz-choice" id="option-${index}" value="${option}">
                                        <label for="option-${index}">${option}</label>
                                    </div>
                                `).join('')}
                            </div>
                            <button onclick="MuscleAnatomy.checkInlineAnswer('${muscle}')" class="check-answer-btn" disabled id="check-multiple-btn">Check Answer</button>
                            <div id="quiz-feedback" class="quiz-feedback" style="display: none;"></div>
                        </div>
                    `;
                }
            },
            
            getCorrectAnswer(muscle, questionType = null) {
                const muscleData = this.muscleDatabase[muscle];
                const type = questionType || this.getRandomActiveQuizType();
                
                switch(type) {
                    case 'nerve': 
                        return muscleData.peripheralNerve;
                    case 'roots': 
                        return muscleData.roots.join(', ');
                    case 'cord': 
                        return muscleData.cord || 'Not applicable';
                    case 'trunk': 
                        return muscleData.trunk || 'Not applicable';
                    case 'actions': 
                        return muscleData.actions;
                    default: 
                        return muscleData.peripheralNerve;
                }
            },

            // Get a random active quiz type for question generation
            getRandomActiveQuizType(muscle = null) {
                let activeTypes = Object.keys(this.activeQuizTypes).filter(type => this.activeQuizTypes[type]);
                
                // If a muscle is specified, filter out inappropriate types
                if (muscle && this.muscleDatabase[muscle]) {
                    const muscleData = this.muscleDatabase[muscle];
                    activeTypes = activeTypes.filter(type => {
                        switch(type) {
                            case 'nerve': 
                                return muscleData.peripheralNerve && muscleData.peripheralNerve !== 'Not applicable';
                            case 'roots': 
                                return muscleData.roots && muscleData.roots.length > 0;
                            case 'cord': 
                                // Only allow cord questions for UE muscles (brachial plexus)
                                return muscleData.region === 'UE' && muscleData.cord && muscleData.cord !== 'Not applicable';
                            case 'trunk': 
                                // Only allow trunk questions for UE muscles (brachial plexus)
                                return muscleData.region === 'UE' && muscleData.trunk && muscleData.trunk !== 'Not applicable';
                            case 'actions': 
                                return muscleData.actions && muscleData.actions !== 'Not applicable';
                            default: 
                                return true;
                        }
                    });
                }
                
                if (activeTypes.length === 0) return 'nerve'; // fallback
                return activeTypes[Math.floor(Math.random() * activeTypes.length)];
            },

            // Advanced pathway-based answer generation
            generateIntelligentAnswerOptions(abnormalMuscles, normalMuscles) {
                console.log('🧠 Generating intelligent answers based on muscle patterns');
                console.log('Abnormal:', abnormalMuscles);
                console.log('Normal:', normalMuscles);

                const possibleLesions = new Set();

                // For each abnormal muscle, find all possible lesion sites along its pathway
                abnormalMuscles.forEach(muscle => {
                    const pathway = this.anatomicalPathways[muscle];
                    if (pathway) {
                        pathway.pathway.forEach(pathPoint => {
                            possibleLesions.add(pathPoint.location);
                        });
                    }
                });

                // Now eliminate lesion sites that would also affect normal muscles
                const validLesions = [];
                possibleLesions.forEach(lesionSite => {
                    let isValid = true;
                    
                    // Check if this lesion would spare the normal muscles
                    normalMuscles.forEach(normalMuscle => {
                        const normalPathway = this.anatomicalPathways[normalMuscle];
                        if (normalPathway) {
                            // If the normal muscle's pathway includes this lesion site, then this lesion site is invalid
                            const wouldAffectNormal = normalPathway.pathway.some(pathPoint => 
                                pathPoint.location === lesionSite
                            );
                            if (wouldAffectNormal) {
                                isValid = false;
                            }
                        }
                    });

                    if (isValid) {
                        validLesions.push(lesionSite);
                    }
                });

                // Also add some plausible distractors from the same anatomical region
                const distractors = [];
                abnormalMuscles.forEach(muscle => {
                    const pathway = this.anatomicalPathways[muscle];
                    if (pathway && pathway.normalIfLesionAt) {
                        Object.keys(pathway.normalIfLesionAt).forEach(distractor => {
                            if (!validLesions.includes(distractor) && !distractors.includes(distractor)) {
                                distractors.push(distractor);
                            }
                        });
                    }
                });

                // Combine valid lesions with some distractors
                const finalOptions = [
                    ...validLesions,
                    ...distractors.slice(0, Math.max(0, 8 - validLesions.length))
                ].slice(0, 8);

                console.log('🎯 Valid lesions based on muscle pattern:', validLesions);
                console.log('🎯 Final answer options:', finalOptions);

                return finalOptions.length > 0 ? finalOptions : ['Unable to localize with given pattern'];
            },

            // Enhanced EMG case generation with pathway understanding
            generatePathwayBasedCase() {
                // Select a random lesion site from our pathway database
                const allMuscles = Object.keys(this.anatomicalPathways);
                const randomMuscle = allMuscles[Math.floor(Math.random() * allMuscles.length)];
                const pathway = this.anatomicalPathways[randomMuscle];
                
                // Choose a random lesion site along this muscle's pathway
                const randomPathPoint = pathway.pathway[Math.floor(Math.random() * pathway.pathway.length)];
                const lesionSite = randomPathPoint.location;
                
                // Find all muscles that would be affected by this lesion
                const affectedMuscles = [];
                const normalMuscles = [];
                
                allMuscles.forEach(muscle => {
                    const musclePathway = this.anatomicalPathways[muscle];
                    if (musclePathway) {
                        const isAffected = musclePathway.pathway.some(pathPoint => 
                            pathPoint.location === lesionSite
                        );
                        
                        if (isAffected) {
                            affectedMuscles.push(muscle);
                        } else {
                            normalMuscles.push(muscle);
                        }
                    }
                });

                // Generate intelligent answer options
                const answerOptions = this.generateIntelligentAnswerOptions(
                    affectedMuscles.slice(0, 4), // Limit to 4 abnormal muscles for display
                    normalMuscles.slice(0, 4)    // Include 4 normal muscles
                );

                return {
                    lesionSite: lesionSite,
                    abnormalMuscles: affectedMuscles.slice(0, 4),
                    normalMuscles: normalMuscles.slice(0, 4),
                    answerOptions: answerOptions,
                    explanation: `This pattern localizes to ${lesionSite}. The affected muscles (${affectedMuscles.slice(0, 3).join(', ')}) all share this common pathway point, while the normal muscles (${normalMuscles.slice(0, 3).join(', ')}) are spared because their pathways bypass this lesion site.`
                };
            },
            
            generateQuizOptions(muscle, correctAnswer, questionType) {
                // Get the region of the target muscle
                const targetMuscleData = this.muscleDatabase[muscle];
                const targetRegion = targetMuscleData.region;
                
                // Filter muscles to same region only
                const sameFunctionMuscles = Object.keys(this.muscleDatabase).filter(m => 
                    this.muscleDatabase[m].region === targetRegion
                );
                
                const distractors = [];
                
                // Generate 3 distractors from other muscles of the SAME region and question type
                while (distractors.length < 3 && distractors.length < sameFunctionMuscles.length - 1) {
                    const randomMuscle = sameFunctionMuscles[Math.floor(Math.random() * sameFunctionMuscles.length)];
                    if (randomMuscle !== muscle) {
                        const distractorAnswer = this.getCorrectAnswer(randomMuscle, questionType);
                        // Only include valid, non-empty, non-"Not applicable" answers
                        if (distractorAnswer && 
                            distractorAnswer !== 'Not applicable' && 
                            distractorAnswer.trim() !== '' &&
                            !distractors.includes(distractorAnswer) && 
                            distractorAnswer !== correctAnswer) {
                            distractors.push(distractorAnswer);
                        }
                    }
                }
                
                // If we don't have enough distractors, add appropriate region-specific generic ones
                if (distractors.length < 3) {
                    const genericOptions = this.getGenericDistractors(questionType, correctAnswer, targetRegion);
                    genericOptions.forEach(option => {
                        if (distractors.length < 3 && !distractors.includes(option) && option !== correctAnswer) {
                            distractors.push(option);
                        }
                    });
                }
                
                // Combine and shuffle
                const options = [correctAnswer, ...distractors].sort(() => 0.5 - Math.random());
                return options;
            },

            // Get appropriate generic distractors based on question type and region
            getGenericDistractors(questionType, correctAnswer, region = 'UE') {
                switch(questionType) {
                    case 'nerve':
                        return region === 'UE' 
                            ? ['Median', 'Ulnar', 'Radial', 'Axillary', 'Musculocutaneous', 'Suprascapular']
                            : ['Femoral', 'Tibial', 'Peroneal', 'Obturator', 'Sciatic', 'Gluteal'];
                    case 'roots':
                        return region === 'UE' 
                            ? ['C5, C6', 'C6, C7', 'C7, C8', 'C8, T1', 'C5, C6, C7'] 
                            : ['L2, L3', 'L3, L4', 'L4, L5', 'L5, S1', 'S1, S2'];
                    case 'cord':
                        // Only UE has brachial plexus cords
                        return region === 'UE' 
                            ? ['Lateral cord', 'Posterior cord', 'Medial cord']
                            : [];
                    case 'trunk':
                        // Only UE has brachial plexus trunks
                        return region === 'UE' 
                            ? ['Upper trunk', 'Middle trunk', 'Lower trunk']
                            : [];
                    case 'actions':
                        return region === 'UE' 
                            ? ['Shoulder abduction', 'Elbow flexion', 'Wrist extension', 'Finger flexion', 'Thumb opposition']
                            : ['Hip flexion', 'Knee extension', 'Ankle dorsiflexion', 'Hip abduction', 'Ankle plantarflexion'];
                    default:
                        return [];
                }
            },
            
            selectQuizOption(answer, muscle) {
                // Update selected state
                document.querySelectorAll('.quiz-option').forEach(opt => opt.classList.remove('selected'));
                event.target.closest('.quiz-option').classList.add('selected');
                
                // Store selected answer
                this.selectedQuizAnswer = answer;
                
                // Enable check button
                document.getElementById('check-multiple-btn').disabled = false;
            },
            
            getAnatomyLabel(questionType = null) {
                const type = questionType || 'nerve'; // Use default instead of random when no type specified
                switch(type) {
                    case 'nerve': return 'peripheral nerve';
                    case 'roots': return 'nerve roots';
                    case 'cord': return 'brachial plexus cord';
                    case 'trunk': return 'brachial plexus trunk';
                    case 'actions': return 'primary actions';
                    default: return 'nerve supply';
                }
            },
            
            checkInlineAnswer(muscle) {
                const questionType = this.currentQuestionType || this.getRandomActiveQuizType();
                const correctAnswer = this.getCorrectAnswer(muscle, questionType);
                const feedbackEl = document.getElementById('quiz-feedback');
                let userAnswer, isCorrect;
                
                if (this.quizMode === 'type') {
                    userAnswer = document.getElementById('quiz-answer').value.trim();
                    isCorrect = userAnswer.toLowerCase().includes(correctAnswer.toLowerCase().split(' ')[0]);
                } else {
                    userAnswer = this.selectedQuizAnswer || 'No answer selected';
                    isCorrect = userAnswer === correctAnswer;
                }
                
                feedbackEl.innerHTML = `
                    <div class="feedback-result ${isCorrect ? 'correct' : 'incorrect'}">
                        <h5>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h5>
                        <p><strong>Your answer:</strong> ${userAnswer}</p>
                        <p><strong>Correct answer:</strong> ${correctAnswer}</p>
                        <button onclick="MuscleAnatomy.generateInlineQuestion()" class="next-question-btn">Next Question</button>
                    </div>
                `;
                feedbackEl.style.display = 'block';
                
                // Reset selected answer for multiple choice
                this.selectedQuizAnswer = null;
            },

            showAllDetails() {
                document.querySelectorAll('.muscle-detail').forEach(detail => {
                    detail.classList.add('show');
                });
            },

            hideAllDetails() {
                document.querySelectorAll('.muscle-detail').forEach(detail => {
                    detail.classList.remove('show');
                });
            },

            toggleNerves() {
                document.querySelectorAll('.muscle-detail.nerve').forEach(detail => {
                    detail.classList.toggle('show');
                });
            },

            toggleRoots() {
                document.querySelectorAll('.muscle-detail.roots').forEach(detail => {
                    detail.classList.toggle('show');
                });
            },

            toggleActions() {
                document.querySelectorAll('.muscle-detail.actions').forEach(detail => {
                    detail.classList.toggle('show');
                });
            },

            startMuscleTest() {
                // Scroll to top of page first for better visibility
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                this.testData.questionsAnswered = 0;
                this.testData.correctAnswers = 0;
                this.testData.missedQuestions = [];
                this.testData.usedMuscles = new Set();
                this.testData.isActive = true;

                const modal = document.getElementById('muscle-test-modal');
                if (modal) {
                    modal.style.display = 'flex';
                    document.getElementById('test-results').style.display = 'none';
                    document.getElementById('muscle-test-body').style.display = 'block';
                    document.getElementById('answer-feedback').style.display = 'none';
                    
                    this.updateTestStats();
                    this.generateNextQuestion();
                }
            },

            stopMuscleTest() {
                this.testData.isActive = false;
                const modal = document.getElementById('muscle-test-modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            },

            generateNextQuestion() {
                if (!this.testData.isActive) return;

                const muscles = Object.keys(this.muscleDatabase);
                let muscle;
                
                // Find an unused muscle
                const availableMuscles = muscles.filter(m => !this.testData.usedMuscles.has(m));
                if (availableMuscles.length === 0) {
                    this.testData.usedMuscles.clear();
                    muscle = muscles[Math.floor(Math.random() * muscles.length)];
                } else {
                    muscle = availableMuscles[Math.floor(Math.random() * availableMuscles.length)];
                }

                this.testData.usedMuscles.add(muscle);
                const muscleData = this.muscleDatabase[muscle];

                // Randomly choose question type
                const questionTypes = ['nerve', 'roots', 'peripheralNerve'];
                const questionType = questionTypes[Math.floor(Math.random() * questionTypes.length)];

                let question, correctAnswer, options;

                switch (questionType) {
                    case 'nerve':
                        question = `What nerve innervates the ${muscle}?`;
                        correctAnswer = muscleData.nerve;
                        options = this.generateNerveOptions(muscleData.nerve);
                        break;
                    case 'roots':
                        question = `What nerve roots innervate the ${muscle}?`;
                        correctAnswer = muscleData.roots.join(', ');
                        options = this.generateRootOptions(muscleData.roots);
                        break;
                    case 'peripheralNerve':
                        question = `What peripheral nerve innervates the ${muscle}?`;
                        correctAnswer = muscleData.peripheralNerve;
                        options = this.generatePeripheralNerveOptions(muscleData.peripheralNerve);
                        break;
                }

                this.currentQuestion = {
                    muscle,
                    question,
                    correctAnswer,
                    options,
                    type: questionType
                };

                this.displayQuestion();
            },

            generateNerveOptions(correctNerve) {
                const allNerves = [...new Set(Object.values(this.muscleDatabase).map(m => m.nerve))];
                const options = [correctNerve];
                
                while (options.length < 4) {
                    const randomNerve = allNerves[Math.floor(Math.random() * allNerves.length)];
                    if (!options.includes(randomNerve)) {
                        options.push(randomNerve);
                    }
                }
                
                return this.shuffleArray(options);
            },

            generateRootOptions(correctRoots) {
                const allRoots = ['C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8', 'T1', 'L1', 'L2', 'L3', 'L4', 'L5', 'S1', 'S2', 'S3'];
                const correctAnswer = correctRoots.join(', ');
                const options = [correctAnswer];
                
                while (options.length < 4) {
                    const numRoots = Math.min(correctRoots.length + Math.floor(Math.random() * 2), 3);
                    const fakeRoots = [];
                    const startIndex = allRoots.indexOf(correctRoots[0]) + Math.floor(Math.random() * 4) - 2;
                    
                    for (let i = 0; i < numRoots; i++) {
                        const index = Math.max(0, Math.min(allRoots.length - 1, startIndex + i));
                        if (allRoots[index] && !fakeRoots.includes(allRoots[index])) {
                            fakeRoots.push(allRoots[index]);
                        }
                    }
                    
                    const fakeAnswer = fakeRoots.join(', ');
                    if (!options.includes(fakeAnswer) && fakeAnswer !== correctAnswer) {
                        options.push(fakeAnswer);
                    }
                }
                
                return this.shuffleArray(options);
            },

            generatePeripheralNerveOptions(correctNerve) {
                const allNerves = [...new Set(Object.values(this.muscleDatabase).map(m => m.peripheralNerve))];
                const options = [correctNerve];
                
                while (options.length < 4) {
                    const randomNerve = allNerves[Math.floor(Math.random() * allNerves.length)];
                    if (!options.includes(randomNerve)) {
                        options.push(randomNerve);
                    }
                }
                
                return this.shuffleArray(options);
            },

            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            },

            displayQuestion() {
                const questionText = document.getElementById('question-text');
                const answerChoices = document.getElementById('answer-choices');
                
                if (questionText) questionText.textContent = this.currentQuestion.question;
                
                if (answerChoices) {
                    answerChoices.innerHTML = '';
                    this.currentQuestion.options.forEach((option, index) => {
                        const choice = document.createElement('div');
                        choice.className = 'answer-choice';
                        choice.textContent = option;
                        choice.onclick = () => this.selectAnswer(index);
                        answerChoices.appendChild(choice);
                    });
                }

                // Hide feedback and show question
                document.getElementById('answer-feedback').style.display = 'none';
            },

            selectAnswer(index) {
                const selectedAnswer = this.currentQuestion.options[index];
                const isCorrect = selectedAnswer === this.currentQuestion.correctAnswer;
                
                this.testData.questionsAnswered++;
                if (isCorrect) {
                    this.testData.correctAnswers++;
                } else {
                    this.testData.missedQuestions.push({
                        question: this.currentQuestion.question,
                        selectedAnswer,
                        correctAnswer: this.currentQuestion.correctAnswer,
                        muscle: this.currentQuestion.muscle
                    });
                }

                this.updateTestStats();
                this.showFeedback(isCorrect, selectedAnswer);
            },

            showFeedback(isCorrect, selectedAnswer) {
                const choices = document.querySelectorAll('.answer-choice');
                choices.forEach((choice, index) => {
                    if (choice.textContent === this.currentQuestion.correctAnswer) {
                        choice.classList.add('correct');
                    } else if (choice.textContent === selectedAnswer && !isCorrect) {
                        choice.classList.add('incorrect');
                    }
                    choice.onclick = null; // Disable further clicks
                });

                const feedback = document.getElementById('answer-feedback');
                const feedbackResult = document.getElementById('feedback-result');
                const feedbackExplanation = document.getElementById('feedback-explanation');

                if (feedbackResult) {
                    feedbackResult.innerHTML = isCorrect ? 
                        '<strong style="color: #28a745;">✅ Correct!</strong>' : 
                        '<strong style="color: #dc3545;">❌ Incorrect</strong>';
                }

                if (feedbackExplanation) {
                    const muscleData = this.muscleDatabase[this.currentQuestion.muscle];
                    feedbackExplanation.innerHTML = `
                        <p><strong>Muscle:</strong> ${this.currentQuestion.muscle}</p>
                        <p><strong>Correct Answer:</strong> ${this.currentQuestion.correctAnswer}</p>
                        <p><strong>Nerve:</strong> ${muscleData.nerve}</p>
                        <p><strong>Roots:</strong> ${muscleData.roots.join(', ')}</p>
                        <p><strong>Actions:</strong> ${muscleData.actions}</p>
                    `;
                }

                if (feedback) feedback.style.display = 'block';
            },

            nextQuestion() {
                this.generateNextQuestion();
            },

            updateTestStats() {
                const questionsElem = document.getElementById('questions-answered');
                const accuracyElem = document.getElementById('current-accuracy');
                
                if (questionsElem) questionsElem.textContent = `Questions: ${this.testData.questionsAnswered}`;
                
                if (accuracyElem) {
                    const accuracy = this.testData.questionsAnswered > 0 ? 
                        Math.round((this.testData.correctAnswers / this.testData.questionsAnswered) * 100) : 0;
                    accuracyElem.textContent = `Accuracy: ${accuracy}%`;
                }
            },

            reviewMissedQuestions() {
                // Implementation for reviewing missed questions
                console.log('Missed questions:', this.testData.missedQuestions);
            }
        };

        // EMG Clinical Localization Challenge System
        const EMGChallenge = {
            currentCase: null,
            selectedAnswer: null,
            activeQuestionTypes: {
                root: true,
                trunk: true,
                cord: true,
                peripheral: true
            },
            
            // Common lesion sites with clinical relevance
            lesionSites: {
                UE: {
                    'C5 nerve root': { type: 'root', muscles: ['Deltoid', 'Biceps brachii', 'Supraspinatus', 'Infraspinatus'] },
                    'C6 nerve root': { type: 'root', muscles: ['Biceps brachii', 'Brachioradialis', 'Extensor carpi radialis'] },
                    'C7 nerve root': { type: 'root', muscles: ['Triceps brachii', 'Extensor digitorum', 'Flexor carpi radialis'] },
                    'C8 nerve root': { type: 'root', muscles: ['First dorsal interosseous', 'Abductor pollicis brevis', 'Flexor carpi ulnaris'] },
                    'T1 nerve root': { type: 'root', muscles: ['First dorsal interosseous', 'Abductor pollicis brevis', 'Abductor digiti minimi'] },
                    'Upper trunk (C5-C6)': { type: 'trunk', muscles: ['Deltoid', 'Biceps brachii', 'Supraspinatus', 'Brachioradialis'] },
                    'Middle trunk (C7)': { type: 'trunk', muscles: ['Triceps brachii', 'Extensor digitorum', 'Flexor carpi radialis'] },
                    'Lower trunk (C8-T1)': { type: 'trunk', muscles: ['First dorsal interosseous', 'Abductor pollicis brevis', 'Flexor carpi ulnaris', 'Abductor digiti minimi'] },
                    'Posterior cord': { type: 'cord', muscles: ['Deltoid', 'Triceps brachii', 'Extensor digitorum', 'Brachioradialis'] },
                    'Medial cord': { type: 'cord', muscles: ['First dorsal interosseous', 'Abductor pollicis brevis', 'Flexor carpi ulnaris'] },
                    'Lateral cord': { type: 'cord', muscles: ['Biceps brachii', 'Brachialis', 'Pronator teres'] },
                    'Median nerve at wrist (carpal tunnel)': { type: 'peripheral', muscles: ['Abductor pollicis brevis', 'Opponens pollicis'] },
                    'Median nerve at forearm': { type: 'peripheral', muscles: ['Abductor pollicis brevis', 'Flexor pollicis longus', 'Pronator teres', 'Flexor carpi radialis'] },
                    'Ulnar nerve at wrist (Guyon canal)': { type: 'peripheral', muscles: ['First dorsal interosseous', 'Abductor digiti minimi', 'Adductor pollicis'] },
                    'Ulnar nerve at elbow': { type: 'peripheral', muscles: ['First dorsal interosseous', 'Flexor carpi ulnaris', 'Abductor digiti minimi'] },
                    'Radial nerve in spiral groove': { type: 'peripheral', muscles: ['Triceps brachii', 'Brachioradialis', 'Extensor digitorum'] },
                    'Posterior interosseous nerve': { type: 'peripheral', muscles: ['Extensor digitorum', 'Extensor pollicis longus'] },
                    'Axillary nerve': { type: 'peripheral', muscles: ['Deltoid', 'Teres minor'] },
                    'Suprascapular nerve': { type: 'peripheral', muscles: ['Supraspinatus', 'Infraspinatus'] }
                },
                LE: {
                    'L2 nerve root': { type: 'root', muscles: ['Iliopsoas (psoas major)', 'Adductor longus', 'Sartorius'] },
                    'L3 nerve root': { type: 'root', muscles: ['Rectus femoris', 'Vastus medialis', 'Adductor longus'] },
                    'L4 nerve root': { type: 'root', muscles: ['Tibialis anterior', 'Rectus femoris', 'Vastus medialis'] },
                    'L5 nerve root': { type: 'root', muscles: ['Extensor hallucis longus', 'Tibialis anterior', 'Gluteus medius', 'Biceps femoris (short head)'] },
                    'S1 nerve root': { type: 'root', muscles: ['Gastrocnemius', 'Gluteus maximus', 'Biceps femoris (long head)'] },
                    'Femoral nerve': { type: 'peripheral', muscles: ['Rectus femoris', 'Vastus medialis', 'Vastus lateralis', 'Sartorius'] },
                    'Peroneal nerve at fibular head': { type: 'peripheral', muscles: ['Tibialis anterior', 'Extensor hallucis longus', 'Fibularis longus'] },
                    'Deep peroneal nerve': { type: 'peripheral', muscles: ['Tibialis anterior', 'Extensor hallucis longus', 'Extensor digitorum brevis'] },
                    'Sciatic nerve': { type: 'peripheral', muscles: ['Biceps femoris (long head)', 'Semitendinosus', 'Gastrocnemius'] },
                    'Tibial nerve': { type: 'peripheral', muscles: ['Gastrocnemius', 'Soleus', 'Flexor hallucis longus'] },
                    'Superior gluteal nerve': { type: 'peripheral', muscles: ['Gluteus medius', 'Gluteus minimus', 'Tensor fasciae latae'] },
                    'Inferior gluteal nerve': { type: 'peripheral', muscles: ['Gluteus maximus'] }
                }
            },

            // Clinical scenarios for different lesion types
            scenarios: {
                'C5 nerve root': 'A 45-year-old construction worker develops shoulder weakness after a fall from scaffolding.',
                'C6 nerve root': 'A 28-year-old motorcycle accident victim presents with weakness in elbow flexion and wrist extension.',
                'C7 nerve root': 'A 35-year-old presents with difficulty extending the elbow and fingers after a neck injury.',
                'C8 nerve root': 'A 55-year-old office worker has hand weakness and numbness in the ring and little fingers.',
                'T1 nerve root': 'A newborn presents with a claw hand deformity and Horners syndrome.',
                'Upper trunk (C5-C6)': 'A football player sustains a "stinger" injury with shoulder weakness and numbness.',
                'Lower trunk (C8-T1)': 'A patient presents with weakness of intrinsic hand muscles after a difficult delivery.',
                'Posterior cord': 'A patient has combined radial and axillary nerve deficits after posterior shoulder dislocation.',
                'Medial cord': 'A patient presents with combined ulnar and median nerve symptoms after brachial plexus trauma.',
                'Lateral cord': 'A patient has weakness of elbow flexion and forearm pronation after lateral brachial plexus injury.',
                'Median nerve at wrist (carpal tunnel)': 'A 45-year-old office worker has numbness in thumb, index, and middle fingers, worse at night.',
                'Median nerve at forearm': 'A patient has weakness of thumb flexion and thenar muscle atrophy after a forearm fracture.',
                'Ulnar nerve at wrist (Guyon canal)': 'A cyclist develops hand weakness after long-distance riding, sparing FCU.',
                'Ulnar nerve at elbow': 'A patient has progressive hand weakness and numbness affecting the ring and little fingers.',
                'Radial nerve in spiral groove': 'A patient awakens with wrist drop after sleeping with arm over chair ("Saturday night palsy").',
                'Posterior interosseous nerve': 'A patient has finger extension weakness but normal wrist extension after elbow trauma.',
                'Axillary nerve': 'A patient develops shoulder weakness and numbness after shoulder dislocation.',
                'Suprascapular nerve': 'A volleyball player has shoulder pain and weakness with overhead activities.',
                'L4 nerve root': 'A patient has knee weakness and medial leg numbness after lumbar spine injury.',
                'L5 nerve root': 'A patient cannot dorsiflex the foot or extend the great toe after lumbar disc herniation.',
                'S1 nerve root': 'A patient has difficulty with plantarflexion and experiences posterior leg pain.',
                'Femoral nerve': 'A patient develops quadriceps weakness after hip surgery or trauma.',
                'Peroneal nerve at fibular head': 'A patient develops foot drop after crossing legs for prolonged periods.',
                'Deep peroneal nerve': 'A patient has weakness dorsiflexing toes with preserved ankle dorsiflexion.',
                'Sciatic nerve': 'A patient has weakness in knee flexion and all ankle movements after hip surgery.',
                'Superior gluteal nerve': 'A patient has a Trendelenburg gait and difficulty with hip abduction.',
                'Inferior gluteal nerve': 'A patient cannot rise from a seated position due to hip extension weakness.'
            },

            startChallenge() {
                const setupDiv = document.getElementById('emg-challenge-setup');
                const activeDiv = document.getElementById('emg-challenge-active');
                
                if (setupDiv) setupDiv.style.display = 'none';
                if (activeDiv) activeDiv.style.display = 'block';
                
                this.generateCase();
            },

            generateCase() {
                // Get filtered lesions based on active question types
                const filteredLesions = window.EMGChallenge.getFilteredLesions();
                
                // Randomly choose between UE and LE (only if both have active lesions)
                let availableRegions = [];
                if (Object.keys(filteredLesions.UE).length > 0) availableRegions.push('UE');
                if (Object.keys(filteredLesions.LE).length > 0) availableRegions.push('LE');
                
                if (availableRegions.length === 0) {
                    console.error('No active question types available');
                    return;
                }
                
                const region = availableRegions[Math.floor(Math.random() * availableRegions.length)];
                const lesionSites = Object.keys(filteredLesions[region]);
                const selectedLesion = lesionSites[Math.floor(Math.random() * lesionSites.length)];
                
                const lesionData = this.lesionSites[region][selectedLesion];
                const scenario = this.scenarios[selectedLesion];
                
                // Get affected muscles for this lesion
                const affectedMuscles = lesionData.muscles.filter(muscle => 
                    MuscleAnatomy.muscleDatabase[muscle] && 
                    MuscleAnatomy.muscleDatabase[muscle].region === region
                );
                
                // Get normal muscles (not affected by this lesion) from same region
                const allMusclesInRegion = Object.keys(MuscleAnatomy.muscleDatabase).filter(muscle => 
                    MuscleAnatomy.muscleDatabase[muscle].region === region
                );
                
                const normalMuscles = allMusclesInRegion.filter(muscle => 
                    !affectedMuscles.includes(muscle)
                ).slice(0, 6); // Limit to 6 normal muscles for readability
                
                // Generate answer options (correct + 3 distractors from same region)
                const allLesionSites = Object.keys(this.lesionSites[region]);
                const distractors = allLesionSites.filter(site => site !== selectedLesion)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 3);
                
                const answerOptions = [selectedLesion, ...distractors].sort(() => 0.5 - Math.random());
                
                this.currentCase = {
                    lesionSite: selectedLesion,
                    region: region,
                    scenario: scenario,
                    abnormalMuscles: affectedMuscles,  // Use consistent property name
                    normalMuscles: normalMuscles,
                    options: answerOptions,  // Use consistent property name
                    correctAnswer: selectedLesion
                };
                
                this.displayCase();
            },

            displayCase() {
                const case_data = this.currentCase;
                
                // Update scenario
                const scenarioText = document.getElementById('challenge-scenario-text');
                if (scenarioText) {
                    scenarioText.textContent = case_data.scenario;
                }
                
                // Update abnormal muscles
                const abnormalList = document.getElementById('challenge-abnormal-muscles');
                if (abnormalList && case_data.abnormalMuscles) {
                    abnormalList.innerHTML = '';
                    case_data.abnormalMuscles.forEach(muscle => {
                        const li = document.createElement('li');
                        li.textContent = muscle;
                        abnormalList.appendChild(li);
                    });
                }
                
                // Update normal muscles
                const normalList = document.getElementById('challenge-normal-muscles');
                if (normalList) {
                    normalList.innerHTML = '';
                    case_data.normalMuscles.forEach(muscle => {
                        const li = document.createElement('li');
                        li.textContent = muscle;
                        normalList.appendChild(li);
                    });
                }
                
                // Update answer options
                const optionsContainer = document.getElementById('challenge-answer-options');
                if (optionsContainer && case_data.options) {
                    optionsContainer.innerHTML = '';
                    case_data.options.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.className = 'answer-option-challenge';
                        button.textContent = option;
                        button.onclick = () => this.selectAnswer(option);
                        optionsContainer.appendChild(button);
                    });
                }
                
                // Reset UI state
                this.selectedAnswer = null;
                const submitBtn = document.getElementById('challenge-submit-btn');
                const nextBtn = document.getElementById('challenge-next-btn');
                const feedback = document.getElementById('challenge-feedback');
                
                if (submitBtn) submitBtn.disabled = true;
                if (nextBtn) nextBtn.style.display = 'none';
                if (feedback) feedback.style.display = 'none';
                
                // Clear previous selections
                document.querySelectorAll('.answer-option-challenge').forEach(btn => {
                    btn.classList.remove('selected');
                });
            },

            selectAnswer(answer) {
                this.selectedAnswer = answer;
                
                // Update UI
                document.querySelectorAll('.answer-option-challenge').forEach(btn => {
                    btn.classList.remove('selected');
                    if (btn.textContent.includes(answer)) {
                        btn.classList.add('selected');
                    }
                });
                
                const submitBtn = document.getElementById('challenge-submit-btn');
                if (submitBtn) submitBtn.disabled = false;
            },

            submitAnswer() {
                if (!this.selectedAnswer) return;
                
                const isCorrect = this.selectedAnswer === this.currentCase.correctAnswer;
                
                // Update answer options to show correct/incorrect
                document.querySelectorAll('.answer-option-challenge').forEach(btn => {
                    if (btn.textContent.includes(this.currentCase.correctAnswer)) {
                        btn.classList.add('correct');
                    } else if (btn.textContent.includes(this.selectedAnswer) && !isCorrect) {
                        btn.classList.add('incorrect');
                    }
                    btn.onclick = null; // Disable further clicks
                });
                
                this.showFeedback(isCorrect);
            },

            showFeedback(isCorrect) {
                const feedbackDiv = document.getElementById('challenge-feedback');
                if (!feedbackDiv) return;
                
                const case_data = this.currentCase;
                const selectedAnswer = this.selectedAnswer;
                
                feedbackDiv.innerHTML = `
                    <div class="challenge-feedback-card ${isCorrect ? 'correct' : 'incorrect'}">
                        <h4>${isCorrect ? '🎯 Excellent Analysis!' : '🔍 Learning Opportunity'}</h4>
                        <div class="feedback-content">
                            <p><strong>Your answer:</strong> ${selectedAnswer}</p>
                            <p><strong>Correct answer:</strong> ${case_data.correctAnswer}</p>
                            <div class="feedback-explanation">
                                <p><strong>Clinical Reasoning:</strong></p>
                                <p>The pattern of denervation in <strong>${case_data.affectedMuscles.join(', ')}</strong> with normal 
                                <strong>${case_data.normalMuscles.slice(0,3).join(', ')}</strong> is characteristic of ${case_data.correctAnswer}.</p>
                                ${isCorrect ? 
                                    '<p style="color: #28a745;">✅ Your localization skills are excellent!</p>' : 
                                    '<p style="color: #dc3545;">Review the innervation patterns and try to identify the common pathway affected.</p>'
                                }
                            </div>
                        </div>
                    </div>
                `;
                
                feedbackDiv.style.display = 'block';
                
                // Show next case button
                const nextBtn = document.getElementById('challenge-next-btn');
                if (nextBtn) nextBtn.style.display = 'inline-block';
                
                // Hide submit button
                const submitBtn = document.getElementById('challenge-submit-btn');
                if (submitBtn) submitBtn.style.display = 'none';
            },
            
            nextCase() {
                this.generateCase();
                
                // Reset buttons
                const submitBtn = document.getElementById('challenge-submit-btn');
                const nextBtn = document.getElementById('challenge-next-btn');
                
                if (submitBtn) {
                    submitBtn.style.display = 'inline-block';
                    submitBtn.disabled = true;
                }
                if (nextBtn) nextBtn.style.display = 'none';
            }
        };
    </script>
</body>
</html>